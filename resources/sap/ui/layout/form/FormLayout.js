/*!
 * OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/Control","sap/ui/layout/library","./FormLayoutRenderer","sap/ui/thirdparty/jquery","sap/ui/dom/jquery/Selectors","sap/ui/dom/jquery/control"],function(e,t,r,n){"use strict";var i=t.BackgroundDesign;var o=e.extend("sap.ui.layout.form.FormLayout",{metadata:{library:"sap.ui.layout",properties:{backgroundDesign:{type:"sap.ui.layout.BackgroundDesign",group:"Appearance",defaultValue:i.Translucent}}}});o.prototype.contentOnAfterRendering=function(e,r){if(t.form.FormHelper.bArrowKeySupport){n(r.getFocusDomRef()).data("sap.InNavArea",true)}if(r.getWidth&&(!r.getWidth()||r.getWidth()=="auto")&&(!r.getFormDoNotAdjustWidth||!r.getFormDoNotAdjustWidth())){r.$().css("width","100%")}};o.prototype.toggleContainerExpanded=function(e){var t=e.getExpanded();if(this.getDomRef()){if(t){e.$("content").css("display","")}else{e.$("content").css("display","none")}}};o.prototype.getLayoutDataForElement=function(e,t){var r=e.getLayoutData();if(!r){return undefined}else if(r.isA(t)){return r}else if(r.isA("sap.ui.core.VariantLayoutData")){var n=r.getMultipleLayoutData();for(var i=0;i<n.length;i++){var o=n[i];if(o.isA(t)){return o}}}};o.prototype.onsapright=function(e){if(t.form.FormHelper.bArrowKeySupport){var r=sap.ui.getCore().getConfiguration().getRTL();if(!r){this.navigateForward(e)}else{this.navigateBack(e)}}};o.prototype.onsapleft=function(e){if(t.form.FormHelper.bArrowKeySupport){var r=sap.ui.getCore().getConfiguration().getRTL();if(!r){this.navigateBack(e)}else{this.navigateForward(e)}}};o.prototype.onsapdown=function(e){if(t.form.FormHelper.bArrowKeySupport){var r=e.srcControl;var n;var i=this.findElement(r);var o=i.element;r=i.rootControl;if(o&&o.isA("sap.ui.layout.form.FormElement")){n=this.findFieldBelow(r,o)}else if(o&&o.isA("sap.ui.layout.form.FormContainer")){n=this.findFirstFieldOfNextElement(o,0)}if(n){n.focus();e.preventDefault()}}};o.prototype.onsapup=function(e){if(t.form.FormHelper.bArrowKeySupport){var r=e.srcControl;var n=0;var i;var o=this.findElement(r);var a=o.element;r=o.rootControl;if(a&&a.isA("sap.ui.layout.form.FormElement")){i=this.findFieldAbove(r,a)}else if(a&&a.isA("sap.ui.layout.form.FormContainer")){var f=a.getParent();n=f.indexOfFormContainer(a);i=this.findLastFieldOfLastElementInPrevContainer(f,n-1)}if(i){i.focus();e.preventDefault()}}};o.prototype.onsaphome=function(e){if(t.form.FormHelper.bArrowKeySupport){var r=e.srcControl;var n=0;var i;var o=this.findElement(r);var a=o.element;var f=a.getParent();var l=f.getParent();n=l.indexOfFormContainer(f);i=this.findFirstFieldOfFirstElementInNextContainer(l,n);if(i){i.focus();e.preventDefault()}}};o.prototype.onsaptop=function(e){if(t.form.FormHelper.bArrowKeySupport){var r=e.srcControl;var n=this.findElement(r);var i=n.element;var o;var a;if(i&&i.isA("sap.ui.layout.form.FormElement")){a=i.getParent()}else if(i&&i.isA("sap.ui.layout.form.FormContainer")){a=i}var f=a.getParent();o=this.findFirstFieldOfForm(f);if(o){o.focus();e.preventDefault()}}};o.prototype.onsapend=function(e){if(t.form.FormHelper.bArrowKeySupport){var r=e.srcControl;var n=0;var i;var o=this.findElement(r);var a=o.element;var f=a.getParent();var l=f.getParent();n=l.indexOfFormContainer(f);i=this.findLastFieldOfLastElementInPrevContainer(l,n);if(i){i.focus();e.preventDefault()}}};o.prototype.onsapbottom=function(e){if(t.form.FormHelper.bArrowKeySupport){var r=e.srcControl;var n=this.findElement(r);var i=n.element;var o;var a;if(i&&i.isA("sap.ui.layout.form.FormElement")){a=i.getParent()}else if(i&&i.isA("sap.ui.layout.form.FormContainer")){a=i}var f=a.getParent();var l=f.getFormContainers();var s=l.length;o=this.findLastFieldOfLastElementInPrevContainer(f,s-1);if(o){o.focus();e.preventDefault()}}};o.prototype.onsapexpand=function(e){var t=e.srcControl;var r=this.findElement(t);var n=r.element;var i;if(n.isA("sap.ui.layout.form.FormContainer")){i=n}else{i=n.getParent()}if(i.getExpandable()&&t===i._oExpandButton){i.setExpanded(true)}};o.prototype.onsapcollapse=function(e){var t=e.srcControl;var r=this.findElement(t);var n=r.element;var i;if(n.isA("sap.ui.layout.form.FormContainer")){i=n}else{i=n.getParent()}if(i.getExpandable()&&t===i._oExpandButton){i.setExpanded(false)}};o.prototype.onsapskipforward=function(e){var t=e.srcControl;var r=this.findElement(t);var n=r.element;t=r.rootControl;var i;var o;if(n&&n.isA("sap.ui.layout.form.FormElement")){o=n.getParent()}else if(n&&n.isA("sap.ui.layout.form.FormContainer")){o=n}var a=o.getParent();var f=a.indexOfFormContainer(o);i=this.findFirstFieldOfFirstElementInNextContainer(a,f+1);if(i){i.focus();e.preventDefault()}};o.prototype.onsapskipback=function(e){var t=e.srcControl;var r=this.findElement(t);var n=r.element;t=r.rootControl;var i;var o;if(n&&n.isA("sap.ui.layout.form.FormElement")){o=n.getParent()}else if(n&&n.isA("sap.ui.layout.form.FormContainer")){o=n}var a=o.getParent();var f=a.getFormContainers();var l=a.indexOfFormContainer(o);while(!i&&l>0){var s=f[l-1];if(!s.getExpandable()||s.getExpanded()){i=this.findFirstFieldOfFirstElementInPrevContainer(a,l-1)}l=l-1}if(i&&i!==t.getFocusDomRef()){i.focus();e.preventDefault()}};o.prototype.onBeforeFastNavigationFocus=function(e){if(n.contains(this.getDomRef(),e.source)){e.srcControl=n(e.source).control(0);if(e.forward){this.onsapskipforward(e)}else{this.onsapskipback(e)}}else{var t=e.forward?this.findFirstFieldOfForm(this.getParent()):this.findFirstFieldOfLastContainerOfForm(this.getParent());if(t){t.focus();e.preventDefault()}}};o.prototype.findElement=function(e){var t=e.getParent();var r=e;while(t&&!t.isA("sap.ui.layout.form.FormElement")&&!t.isA("sap.ui.layout.form.FormContainer")&&!t.isA("sap.ui.layout.form.Form")){r=t;t=t.getParent()}return{rootControl:r,element:t}};o.prototype.navigateForward=function(e){var t=e.srcControl;var r=0;var n;var i=this.findElement(t);var o=i.element;t=i.rootControl;if(o&&o.isA("sap.ui.layout.form.FormElement")){if(t==o.getLabelControl()){r=-1}else{r=o.indexOfField(t)}n=this.findNextFieldOfElement(o,r+1);if(!n){var a=o.getParent();r=a.indexOfFormElement(o);n=this.findFirstFieldOfNextElement(a,r+1);if(!n){var f=a.getParent();r=f.indexOfFormContainer(a);n=this.findFirstFieldOfFirstElementInNextContainer(f,r+1)}}}else if(o&&o.isA("sap.ui.layout.form.FormContainer")){n=this.findFirstFieldOfNextElement(o,0)}if(n){n.focus();e.preventDefault()}};o.prototype.tabForward=function(e){var t;var r=e.srcControl;var n=0;var i;var o=this.findElement(r);var a=o.element;r=o.rootControl;if(a&&a.isA("sap.ui.layout.form.FormElement")){if(r==a.getLabelControl()){n=-1}else{n=a.indexOfField(r)}i=this.findNextFieldOfElement(a,n+1,true);if(!i){var f=a.getParent();n=f.indexOfFormElement(a);i=this.findFirstFieldOfNextElement(f,n+1,true);if(!i){t=f.getParent();n=t.indexOfFormContainer(f);i=this.findFirstFieldOfFirstElementInNextContainer(t,n+1,true)}}}else if(a&&a.isA("sap.ui.layout.form.FormContainer")){i=this.findFirstFieldOfNextElement(a,0,true);if(!i){t=a.getParent();n=t.indexOfFormContainer(a);i=this.findFirstFieldOfFirstElementInNextContainer(t,n+1,true)}}if(i){i.focus();e.preventDefault()}};o.prototype.findNextFieldOfElement=function(e,t,r){var n=e.getFields();var i=n.length;var o;for(var a=t;a<i;a++){var f=n[a];var l=this._getDomRef(f);if(r==true){if((!f.getEditable||f.getEditable())&&(!f.getEnabled||f.getEnabled())&&l){o=l;break}}else{if((!f.getEnabled||f.getEnabled())&&l){o=l;break}}}return o};o.prototype.findFirstFieldOfNextElement=function(e,t,r){var n=e.getFormElements();var i=n.length;var o;var a=t;while(!o&&a<i){var f=n[a];if(r==true){o=this.findNextFieldOfElement(f,0,true)}else{o=this.findNextFieldOfElement(f,0)}a++}return o};o.prototype.findFirstFieldOfForm=function(e){var t=this.findFirstFieldOfFirstElementInNextContainer(e,0);return t};o.prototype.findFirstFieldOfLastContainerOfForm=function(e){var t;var r=e.getFormContainers();var n=r.length;while(!t&&n>0){var i=r[n-1];if(!i.getExpandable()||i.getExpanded()){t=this.findFirstFieldOfFirstElementInPrevContainer(e,n-1)}n=n-1}return t};o.prototype.findFirstFieldOfFirstElementInNextContainer=function(e,t,r){var n=e.getFormContainers();var i=n.length;var o;var a=t;while(!o&&a<i){var f=n[a];if(f.getExpandable()&&r){o=f._oExpandButton.getFocusDomRef();if(o){break}}if(!f.getExpandable()||f.getExpanded()){if(r==true){o=this.findFirstFieldOfNextElement(f,0,true)}else{o=this.findFirstFieldOfNextElement(f,0)}}a++}return o};o.prototype.findFirstFieldOfFirstElementInPrevContainer=function(e,t){var r=e.getFormContainers();var n=r.length;var i;var o=t;while(!i&&o<n&&o>=0){var a=r[o];if(!a.getExpandable()||a.getExpanded()){i=this.findFirstFieldOfNextElement(a,0)}o++}return i};o.prototype.navigateBack=function(e){var t;var r=e.srcControl;var n=0;var i;var o=this.findElement(r);var a=o.element;r=o.rootControl;if(a&&a.isA("sap.ui.layout.form.FormElement")){if(r==a.getLabelControl()){n=0}else{n=a.indexOfField(r)}i=this.findPrevFieldOfElement(a,n-1);if(!i){var f=a.getParent();n=f.indexOfFormElement(a);i=this.findLastFieldOfPrevElement(f,n-1);if(!i){t=f.getParent();n=t.indexOfFormContainer(f);i=this.findLastFieldOfLastElementInPrevContainer(t,n-1)}}}else if(a&&a.isA("sap.ui.layout.form.FormContainer")){t=a.getParent();n=t.indexOfFormContainer(a);i=this.findLastFieldOfLastElementInPrevContainer(t,n-1)}if(i){i.focus();e.preventDefault()}};o.prototype.tabBack=function(e){var t;var r=e.srcControl;var n=0;var i;var o=this.findElement(r);var a=o.element;r=o.rootControl;if(a&&a.isA("sap.ui.layout.form.FormElement")){if(r==a.getLabelControl()){n=0}else{n=a.indexOfField(r)}i=this.findPrevFieldOfElement(a,n-1,true);if(!i){var f=a.getParent();n=f.indexOfFormElement(a);i=this.findLastFieldOfPrevElement(f,n-1,true);if(!i){t=f.getParent();n=t.indexOfFormContainer(f);if(f.getExpandable()){i=f._oExpandButton.getFocusDomRef()}if(!i){i=this.findLastFieldOfLastElementInPrevContainer(t,n-1,true)}}}}else if(a&&a.isA("sap.ui.layout.form.FormContainer")){t=a.getParent();n=t.indexOfFormContainer(a);i=this.findLastFieldOfLastElementInPrevContainer(t,n-1,true)}if(i){i.focus();e.preventDefault()}};o.prototype.findPrevFieldOfElement=function(e,t,r){var n=e.getFields();var i;for(var o=t;o>=0;o--){var a=n[o];var f=this._getDomRef(a);if(r==true){if((!a.getEditable||a.getEditable())&&(!a.getEnabled||a.getEnabled())&&f){i=f;break}}else{if((!a.getEnabled||a.getEnabled())&&f){i=f;break}}}return i};o.prototype.findLastFieldOfPrevElement=function(e,t,r){var n=e.getFormElements();var i;var o=t;while(!i&&o>=0){var a=n[o];var f=a.getFields().length;if(r==true){i=this.findPrevFieldOfElement(a,f-1,true)}else{i=this.findPrevFieldOfElement(a,f-1)}o--}return i};o.prototype.findLastFieldOfLastElementInPrevContainer=function(e,t,r){var n=e.getFormContainers();var i;var o=t;while(!i&&o>=0){var a=n[o];if(a.getExpandable()&&!a.getExpanded()&&r){i=a._oExpandButton.getFocusDomRef();if(i){break}}if(!a.getExpandable()||a.getExpanded()){var f=a.getFormElements().length;if(r==true){i=this.findLastFieldOfPrevElement(a,f-1,true)}else{i=this.findLastFieldOfPrevElement(a,f-1,0)}}o--}return i};o.prototype.findFieldBelow=function(e,t){var r=t.getParent();var n=r.indexOfFormElement(t);var i=this.findFirstFieldOfNextElement(r,n+1);if(!i){var o=r.getParent();n=o.indexOfFormContainer(r);i=this.findFirstFieldOfFirstElementInNextContainer(o,n+1)}return i};o.prototype.findFieldAbove=function(e,t){var r=t.getParent();var n=r.indexOfFormElement(t);var i=r.getFormElements();var o;var a=n-1;while(!o&&a>=0){var f=i[a];o=this.findPrevFieldOfElement(f,0);a--}if(!o){var l=r.getParent();n=l.indexOfFormContainer(r);o=this.findLastFieldOfLastElementInPrevContainer(l,n-1)}return o};o.prototype._getDomRef=function(e){var t=e.getFocusDomRef();if(!n(t).is(":sapFocusable")){t=undefined}return t};o.prototype.getContainerRenderedDomRef=function(e){if(this.getDomRef()){return e.getId()?window.document.getElementById(e.getId()):null}else{return null}};o.prototype.getElementRenderedDomRef=function(e){if(this.getDomRef()){return e.getId()?window.document.getElementById(e.getId()):null}else{return null}};return o});