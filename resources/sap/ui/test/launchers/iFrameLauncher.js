/*!
 * OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/thirdparty/URI","sap/ui/Device","sap/ui/test/_LogCollector","sap/base/Log","sap/ui/thirdparty/jquery","sap/base/util/ObjectPath"],function(e,t,r,n,i,a){"use strict";var s=1280;var o=1024;var u=null,c=null,l=null,h=null,f=null,d=null,p=false,g=false,y=null,w=null,m;function v(){u=c[0].contentWindow;b();L()}function H(e,t){if(e){c.css("width",e);l.css("padding-left",e)}else{c.css("width",s);c.addClass("default-scale-x")}if(t){c.css("height",t)}else{c.css("height",o);c.addClass("default-scale-y")}if(!e&&!t){c.addClass("default-scale-both")}}function b(){var e=u.onerror;u.onerror=function(t,r,n,i,a){var s=false;if(e){s=e.apply(this,arguments)}setTimeout(function(){var e=i?"\ncolumn: "+i:"";var s=a&&"\niFrame error: "+(a.stack?a.message+"\n"+a.stack:a)||"";throw new Error("Error in launched application iFrame: "+t+"\nurl: "+r+"\nline: "+n+e+s)},0);return s}}function L(){if(g){return true}if(u&&u.sap&&u.sap.ui&&u.sap.ui.getCore){if(!p){u.sap.ui.getCore().attachInit(F)}p=true}return g}function C(e){u.sap.ui.require(["sap/ui/thirdparty/sinon"],function(t){if(!t){setTimeout(function(){C(e)},50)}else{e()}})}function F(){P();if(t.browser.firefox){C(U)}else{U()}}function I(){d.sap.log.addLogListener(r.getInstance()._oListener);g=true}function P(){d=u.jQuery;q("sap/ui/test");q("sap/ui/qunit");q("sap/ui/thirdparty")}function E(e,t,r){var i=new r,a=new t(i),s=e.setHash,o=e.getHash,c,l=false,h=u.history.go;e.replaceHash=function(e){l=true;var t=this.getHash();c=e;i.fireEvent("hashReplaced",{sHash:e});this.changed.dispatch(e,t)};e.setHash=function(e){l=true;var t=o.call(this);c=e;i.fireEvent("hashSet",{sHash:e});s.apply(this,arguments);if(t===this.getHash()){this.changed.dispatch(t,a.aHistory[a.iHistoryPosition])}};e.getHash=function(){if(c===undefined){return o.apply(this,arguments)}return c};e.changed.add(function(e){if(!l){i.fireEvent("hashSet",{sHash:e});c=e}l=false});i.init();function f(){l=true;var t=a.aHistory[a.iHistoryPosition],r=a.getPreviousHash();c=r;e.changed.dispatch(r,t)}function d(){l=true;var t=a.aHistory[a.iHistoryPosition+1],r=a.aHistory[a.iHistoryPosition];if(t===undefined){n.error("Could not navigate forwards, there is no history entry in the forwards direction",this);return}c=t;e.changed.dispatch(t,r)}u.history.back=f;u.history.forward=d;u.history.go=function(e){if(e===-1){f();return}else if(e===1){d();return}n.error("Using history.go with a number greater than 1 is not supported by OPA5",this);return h.apply(u.history,arguments)}}function U(){u.sap.ui.require(["sap/ui/test/OpaPlugin","sap/ui/test/autowaiter/_autoWaiter","sap/ui/test/_OpaLogger","sap/ui/qunit/QUnitUtils","sap/ui/thirdparty/hasher","sap/ui/core/routing/History","sap/ui/core/routing/HashChanger"],function(e,t,r,n,i,a,s){r.setLevel(m);h=new e;y=t;f=n;E(i,a,s);w=s;I()})}function q(t){var r=sap.ui.require.toUrl(t);var n=new e(r).absoluteTo(document.baseURI).search("").toString();var i=a.get("sap.ui._ui5loader.config",u)||a.get("sap.ui.loader.config",u);if(i){var s={};s[t]=n;i({paths:s})}else if(d&&d.sap&&d.sap.registerResourcePath){d.sap.registerResourcePath(t,n)}else{throw new Error("iFrameLauncher.js: UI5 module system not found.")}}function W(){if(!u){throw new Error("sap.ui.test.launchers.iFrameLauncher: Teardown was called before launch. No iFrame was loaded.")}u.onerror=i.noop;for(var e=0;e<c.length;e++){c[0].src="about:blank";c[0].contentWindow.document.write("");c[0].contentWindow.close()}if(typeof CollectGarbage=="function"){CollectGarbage()}c.remove();l.remove();d=null;h=null;f=null;u=null;g=false;p=false;y=null;w=null}return{launch:function(e){if(u){throw new Error("sap.ui.test.launchers.iFrameLauncher: Launch was called twice without teardown. Only one iFrame may be loaded at a time.")}c=i("#"+e.frameId);if(!c.length){if(!e.source){n.error("No source was given to launch the IFrame",this)}l=i("<div class='opaFrameContainer'></div>");c=i('<IFrame id="'+e.frameId+'" class="opaFrame" src="'+e.source+'"></IFrame>');l.append(c);i("body").append(l);H(e.width,e.height)}if(c[0].contentDocument&&c[0].contentDocument.readyState==="complete"){v()}else{c.on("load",v)}m=e.opaLogLevel;return L()},hasLaunched:function(){L();return g},teardown:function(){W()},getHashChanger:function(){if(!w){return null}return w.getInstance()},getPlugin:function(){return h},getJQuery:function(){return d},getUtils:function(){return f},getWindow:function(){return u},_getAutoWaiter:function(){return y}}},true);