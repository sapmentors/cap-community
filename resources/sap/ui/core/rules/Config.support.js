/*!
 * OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","sap/ui/support/library","sap/ui/core/mvc/XMLView"],function(e,t,a){"use strict";var o=t.Categories;var i=t.Severity;var n=t.Audiences;var r={id:"preloadAsyncCheck",audiences:[n.Application],categories:[o.Performance],enabled:true,minversion:"1.58",title:"Preload Configuration",description:"Checks whether the preload configuration was set correctly to async",resolution:"Please execute this rule to get a specific solution based on the application's preload mode configuration.",resolutionurls:[{text:"Performance: Speed Up Your App",href:"https://sapui5.hana.ondemand.com/#/topic/408b40efed3c416681e1bd8cdd8910d4"},{text:"Best Practices for Loading Modules Asynchronously",href:"https://openui5.hana.ondemand.com/#/topic/00737d6c1b864dc3ab72ef56611491c4.html#loio00737d6c1b864dc3ab72ef56611491c4"},{text:"Is Your Application Ready for Asynchronous Loading?",href:"https://sapui5.hana.ondemand.com/#/topic/493a15aa978d4fe9a67ea9407166eb01.html"}]};r.check=function(e,t){var a=sap.ui.getCore().getConfiguration().getDebug();if(a){return}var o=sap.ui.getCore().getLoadedLibraries()["sap.ushell"];if(o){return}var n=sap.ui.getCore().getConfiguration().getPreload(),s=sap.ui.loader.config().async;var c="It is recommended to use the configuration option "+"'data-sap-ui-async=\"true\"' instead of 'data-sap-ui-preload=\"async\"'. "+"With this option single modules and preload files will be loaded asynchronously. "+"Note: Enabling this behaviour requires intensive testing of the application.";if(n==="async"&&!s){r.resolution="Please replace 'data-sap-ui-preload=\"async\"' with 'data-sap-ui-async=\"true\"' "+"in the bootstrap script, as it implicitly sets the loading behaviour of preload files to be asynchronous.";e.addIssue({severity:i.High,details:c,context:{id:"WEBPAGE"}})}else if(n!=="async"&&!s){r.resolution="Please configure 'data-sap-ui-async=\"true\"' in the bootstrap script, "+"as it implicitly sets the loading behaviour of preload files to be asynchronous. "+"In case you have already configured the 'data-sap-ui-preload' option, you should remove it.";e.addIssue({severity:i.High,details:c,context:{id:"WEBPAGE"}})}};var s={id:"cacheBusterToken",audiences:[n.Application],categories:[o.Performance],enabled:true,minversion:"1.28",title:"Application Resource Caching",description:"Checks whether the application uses cache buster tokens in its requests for static resources from SAPUI5 repositories",resolution:"Change the application\n"+"Note: Not using cache buster tokens has a negative impact on performance.\n"+"For more information, see the SAPUI5 developer guide.",resolutionurls:[{text:"Documentation: Cache Buster for SAPUI5 Application Resources",href:"https://sapui5.hana.ondemand.com/#docs/guide/4cfe7eff3001447a9d4b0abeaba95166.html"}],check:function(t,a,o){var n="/sap/bc/ui5_ui5/";var r=[];var s;var c=e.sap.measure.getRequestTimings();for(var d=0;d<c.length;d++){var u=c[d].name;if(u.indexOf(n)>0){if(!u.match(/\/~[A-Z0-9]*~/g)){if(u.indexOf("/sap-ui-cachebuster/sap-ui-core.js")<0&&u.indexOf("sap-ui-cachebuster-info.json")<0){var p=u.split(n);p=p[1].split("/");s=p[0]==="sap"?p[1]:"/"+p[0]+"/"+p[1];if(r.indexOf(s)<0){r.push(s)}}}}}for(var d=0;d<r.length;d++){s=r[d];var l=n+(s.charAt(0)==="/"?s.substr(1):"sap/"+s);t.addIssue({severity:i.Medium,details:"Application '"+s+"' has no cache buster tokens in some or all of its requests.\n "+"For more information about the URLs affected under application '"+s+"' please check the network trace for URLs starting with '"+l+"'",context:{id:"WEBPAGE"}})}}};var c={id:"libraryUsage",audiences:[n.Application],categories:[o.Performance],enabled:true,minversion:"1.34",title:"Library Usage",description:"Checks whether there are unused loaded libraries. This rule only works on global execution scope.",resolution:"Adapt your application descriptor and your application coding to improve the performance",resolutionurls:[{text:"Documentation: Descriptor Dependencies to Libraries and Components",href:"https://openui5.hana.ondemand.com/#/topic/8521ad1955f340f9a6207d615c88d7fd"}],check:function(t,a,o){if(o.getType()==="global"){var n=sap.ui.getCore().getLoadedLibraries();o.getElements().forEach(function(e){var t=e.getMetadata().getLibraryName();if(n[t]){delete n[t]}});var r=sap.ui.require("sap/base/util/LoaderExtensions");var s;if(r){s=r.getAllRequiredModules()}else{s=e.sap.getAllDeclaredModules()}Object.keys(n).forEach(function(e){var t=e+".";for(var a=0;a<s.length;a++){var o=s[a];if(o.indexOf(t)===0&&n[e].types.indexOf(o)===-1&&o.lastIndexOf(".library")!==o.length-".library".length&&o.lastIndexOf(".library-preload")!==o.length-".library-preload".length&&o.lastIndexOf(".flexibility")!==o.length-".flexibility".length&&o.lastIndexOf(".support")!==o.length-".support".length){delete n[e];break}}});var c=Object.keys(n);Object.keys(n).forEach(function(e){n[e].dependencies.forEach(function(e){var t=c.indexOf(e);if(t>-1){c.splice(t,1)}})});c.forEach(function(e){if(e){t.addIssue({severity:i.Medium,details:"The library '"+e+"' has been loaded, but not used so far in the analyzed scope of the application. There are two options to solve this issue: \n"+"1. If the library is needed at later state in your application, you can make use of lazy library loading (see resolution section)."+" Please be aware that if this lazy flag isn't used correctly this might lead to a performance decrease. \n"+"2. If the library has been loaded by accident and is never used in the application, you should remove the library from the bootstrap or application descriptor.",context:{id:"WEBPAGE"}})}})}}};var d={id:"lazyComponents",audiences:[n.Application],categories:[o.Performance],enabled:true,minversion:"1.48",title:"Lazy loading of components",description:"Checks whether lazy loading of components is used",resolution:"Adapt your application descriptor and your application coding to improve the performance",resolutionurls:[{text:"Documentation: Descriptor Dependencies to Libraries and Components",href:"https://openui5.hana.ondemand.com/#/topic/8521ad1955f340f9a6207d615c88d7fd"}],check:function(e,t,a){var o=t.getComponents();var n={};var r=false;Object.keys(o).forEach(function(e){var t=o[e].getManifest();if(t&&t["sap.ui5"]&&t["sap.ui5"].dependencies){var a=t["sap.ui5"].dependencies.components;if(a&&Object.keys(a).length>0){n[e]=true;Object.keys(a).forEach(function(e){if(a[e].lazy!==undefined){r=true}})}}});if(Object.keys(n).length>0&&!r){Object.keys(n).forEach(function(t){e.addIssue({severity:i.Medium,details:"No lazy Component loading detected. Define lazy components in your application descriptor, if this feature can be used in the application.",context:{id:t}})})}}};var u={id:"reuseComponents",audiences:[n.Application],categories:[o.Performance],enabled:true,minversion:"1.48",title:"Components reusage via componentUsages",description:"Components are more performant and flexible, if defined via componentUsages",resolution:"Adapt your application descriptor and your application coding to improve the performance",resolutionurls:[{text:"Documentation: Using and Nesting Components",href:"https://openui5.hana.ondemand.com/#/topic/346599f0890d4dfaaa11c6b4ffa96312"}],check:function(e,t,a){var o=t.getComponents();var n={};var r=false;Object.keys(o).forEach(function(e){var t=o[e].getManifest();var a=t["sap.ui5"];if(a&&a.dependencies&&a.dependencies["components"]&&Object.keys(a.dependencies["components"]).length>0){n[e]=true}if(a&&a.componentUsages!==undefined){r=true}});if(Object.keys(n).length>0&&!r){Object.keys(n).forEach(function(t){e.addIssue({severity:i.Medium,details:"There are defined reuse components in the application descriptor. Please check the documentation,"+" whether you can define your components via componentUsage.",context:{id:t}})})}}};var p={id:"modelPreloading",audiences:[n.Application],categories:[o.Performance],enabled:true,minversion:"1.38",title:"Model preloading",description:"Preloaded models, which load their data from external locations, can load data earlier",resolution:"Adapt your application descriptor and your application coding to improve the performance",resolutionurls:[{text:"Documentation: Manifest Model Preload",href:"https://openui5.hana.ondemand.com/#/topic/26ba6a5c1e5c417f8b21cce1411dba2c"}],check:function(e,t,a){var o=t.getComponents();var n={};var r=false;Object.keys(o).forEach(function(e){var t=o[e].getManifest();var a=t["sap.ui5"].models||{};var i=t["sap.app"].dataSources;Object.keys(a).forEach(function(t){var o=a[t];var s;if(o.dataSource){s=i[o.dataSource]}if(o.type==="sap.ui.model.odata.v2.ODataModel"||o.type==="sap.ui.model.odata.v4.ODataModel"||s&&s.type==="OData"){n[e]=true;if(o.preload!==undefined){r=true}}})});if(!r){Object.keys(n).forEach(function(t){e.addIssue({severity:i.High,details:"The used OData models don't make use of the preloading feature.",context:{id:t}})})}}};var l={id:"asynchronousXMLViews",audiences:[n.Application],categories:[o.Performance],enabled:true,minversion:"1.34",title:"Asynchronous XML views",description:"Asynchronous XML views leads to smoother view transitions, doesn't block the UI and allows for more efficient SAPUI5 flexibility services",resolution:"Adapt your application descriptor and your application coding to improve the performance and efficiency",resolutionurls:[{text:"Documentation: Routing Configuration",href:"https://openui5.hana.ondemand.com/#/topic/902313063d6f45aeaa3388cc4c13c34e"},{text:"Documentation: Instantiating Views",href:"https://openui5.hana.ondemand.com/#/topic/68d0e58857a647d49470d9f92dd859bd"},{text:"Documentation: UI Adaptation at Runtime: Enable Your App",href:"https://sapui5.hana.ondemand.com/#docs/guide/f1430c0337534d469da3a56307ff76af.html"}],check:function(e,t,o){var n=t.getComponents();var r={};var s=o.getElementsByClassName(a).filter(function(e){return e.oAsyncState===undefined});Object.keys(n).forEach(function(e){var t=n[e].getRouter&&n[e].getRouter();if(t&&t._oConfig){if(t._oConfig._async!==true){r[e]=[];if(n[e].getTargets()&&n[e].getTargets()._oViews&&n[e].getTargets()._oViews._oViews){var a=n[e].getTargets()._oViews._oViews;Object.keys(a).forEach(function(t){var o=a[t].getViewName().split(".").pop();r[e].push(o);s=s.filter(function(e){return a[t]!==e})})}}}});Object.keys(r).forEach(function(t){e.addIssue({severity:i.High,details:"Routing between views ("+r[t].join(", ")+") is used, but configured to be synchronous."+" Please take a look at the resolution 'Routing Configuration'.",context:{id:t}})});s.forEach(function(t){var a=t.getId();var o=t.getViewName().split(".").pop();e.addIssue({severity:i.Medium,details:"The XML view '"+o+" is loaded synchronous. Please take a look at the resolution 'Instantiating Views'.",context:{id:a}})})}};return[r,s,c,d,u,p,l]},true);