/*!
 * OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/test/_OpaLogger","sap/ui/test/_ParameterValidator","sap/ui/test/autowaiter/_autoWaiter","sap/ui/test/_LogCollector","sap/ui/thirdparty/jquery"],function(e,t,n,i,a){"use strict";var r=e.getLogger("sap.ui.test.autowaiter._autoWaiterAsync");var o=i.getInstance("^sap.ui.test.autowaiter.*#hasPending$");var s=new t({errorPrefix:"sap.ui.test.autowaiter._autoWaiterAsync#extendConfig"});var u;var l;var g={interval:400,timeout:15e3};function c(e){f(e);a.extend(g,e);n.extendConfig(g)}function d(e){if(u){a({error:"waitAsync is already running and cannot be called again at this moment"});return}var t=Date.now();u=true;r.debug("Start polling to check for pending asynchronous work");o.start();i();function i(){var e=Date.now()-t;if(e<=g.timeout){setTimeout(function(){if(n.hasToWait()){l=o.getAndClearLog();i()}else{a({log:"Polling finished successfully. There is no more pending asynchronous work for the moment"});u=false}},g.interval)}else{a({error:"Polling stopped because the timeout of "+g.timeout+" milliseconds has been reached but there is still pending asynchronous work.\n"+"This is the last log of pending work:\n"+l});u=false}}function a(t){if(e){e(t.error)}r.debug(t.error||t.log);o.destroy()}}function f(e){s.validate({inputToValidate:e,validationInfo:{interval:"numeric",timeout:"numeric"}});if(e.timeout<=0||e.interval<=0){throw new Error("Invalid polling config: Timeout and interval should be greater than 0")}}return{extendConfig:c,waitAsync:d}},true);