/*!
 * OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/Device","sap/ui/core/ElementMetadata","../Plugin","sap/base/util/LoaderExtensions","sap/base/util/ObjectPath","sap/ui/thirdparty/jquery"],function(t,e,a,i,n,r){"use strict";var s=a.extend("sap.ui.core.support.plugins.Breakpoint",{constructor:function(t){a.apply(this,["sapUiSupportBreakpoint","",t]);this._oStub=t;this._methodType={clazz:1,proto:2};this._mBreakpointData={classes:{},instances:{}};this._idPrefix="id_";this._methodPrefix="method_";this._classPrefix="class_";this._bAlertNoDebugger=false;this._aEventIds=[this.getId()+"RequestInstanceMethods",this.getId()+"ChangeInstanceBreakpoint",this.getId()+"RequestClasses",this.getId()+"RequestClassMethods",this.getId()+"ChangeClassBreakpoint",this.getId()+"RemoveAllClassBreakpoints"]}});s.prototype.isToolPlugin=function(){return false};s.prototype.isAppPlugin=function(){return true};s.prototype.init=function(t){a.prototype.init.apply(this,arguments);window.bp=this;this.requestClasses("sapUiSupportDebuggingReceiveClasses")};s.prototype.onsapUiSupportBreakpointRequestInstanceMethods=function(t){var e=t.getParameter("callback"),a=t.getParameter("controlId");var i=this.getInstanceMethods(a);this._oStub.sendEvent(e,{methods:JSON.stringify(i),breakpointCount:JSON.stringify({active:i.filter(function(t,e){return t.active}).length,all:i.length}),controlId:a})};s.prototype.onsapUiSupportBreakpointChangeInstanceBreakpoint=function(t){var e={controlId:t.getParameter("controlId"),methodName:t.getParameter("methodName"),active:t.getParameter("active")},a=t.getParameter("callback");this.changeInstanceBreakpoint(e.controlId,e.methodName,e.active);var i=this.getInstanceMethods(e.controlId);e.breakpointCount=JSON.stringify({active:i.filter(function(t){return t.active}).length,all:i.length});e.methods=JSON.stringify(i);this._oStub.sendEvent(a,e)};s.prototype.requestClasses=function(t){this._oStub.sendEvent(t,{classes:JSON.stringify(this.getClasses())})};s.prototype.onsapUiSupportBreakpointRequestClasses=function(t){this.requestClasses(t.getParameter("callback"))};s.prototype.onsapUiSupportBreakpointRequestClassMethods=function(t){var e=t.getParameter("callback"),a=t.getParameter("className");var i=this.getClassMethods(a);this._oStub.sendEvent(e,{methods:JSON.stringify(i),breakpointCount:JSON.stringify({active:i.filter(function(t,e){return t.active}).length,all:i.length}),className:a})};s.prototype.onsapUiSupportBreakpointChangeClassBreakpoint=function(t){var e={className:t.getParameter("className"),methodName:t.getParameter("methodName"),active:t.getParameter("active"),type:t.getParameter("type")},a=t.getParameter("callback");this.changeClassBreakpoint(e.className,e.methodName,e.active,e.type);var i=this.getClassMethods(e.className);e.breakpointCount=JSON.stringify({active:i.filter(function(t,e){return t.active}).length,all:i.length});e.methods=JSON.stringify(i);this._oStub.sendEvent(a,e)};s.prototype.onsapUiSupportBreakpointRemoveAllClassBreakpoints=function(t){var e=t.getParameter("className");var a=this._mBreakpointData.classes[this._classPrefix+e];for(var i in a){this.changeClassBreakpoint(e,i.replace(this._methodPrefix,""),false)}};s.prototype.getInstanceMethods=function(t){var e=sap.ui.getCore().byId(t),a=[];if(!e){return a}for(var i in e){if(!r.isFunction(e[i])){continue}a.push({name:i,active:this.isInstanceBreakpointActive(e,i)})}return a.sort(function(t,e){if(t.name<e.name){return-1}else if(t.name>e.name){return 1}else{return 0}})};s.prototype.getClassMethods=function(t){var e=n.get(t);var a=[],i;if(!e){return a}for(i in e){if(!r.isFunction(e[i])){continue}a.push({name:i,type:this._methodType.clazz,active:this.isClassBreakpointActive(t,i)})}function s(t){return a.some(function(e){return e.name===t})}for(i in e.prototype){if(!r.isFunction(e.prototype[i])){continue}if(s(i)){continue}a.push({name:i,type:this._methodType.proto,active:this.isClassBreakpointActive(t,i)})}return a.sort(function(t,e){if(t.name<e.name){return-1}else if(t.name>e.name){return 1}else{return 0}})};s.prototype.getClasses=function(){function t(){var t=[];var a=i.getAllRequiredModules();for(var r=0;r<a.length;r++){if(t.indexOf(a[r])>-1){continue}var s=n.get(a[r]);if(typeof s==="undefined"||s===null){continue}if(typeof s.getMetadata==="function"&&s.getMetadata()instanceof e){t.push(s.getMetadata().getName())}}return t}return t().sort()};s.prototype.changeInstanceBreakpoint=function(t,e,a){var i=sap.ui.getCore().byId(t);if(!i||!e||!i[e]){return}if(this.isInstanceBreakpointActive(i,e)===a){return}if(a){this.applyInstanceMethodHook(t,i,e)}else{this.removeInstanceMethodHook(t,i,e)}};s.prototype.changeClassBreakpoint=function(t,e,a,i){var r=n.get(t);if(!r||!e){return}if(this.isClassBreakpointActive(t,e)===a){return}if(a){this.applyClassMethodHook(t,r,e,i)}else{this.removeClassMethodHook(t,r,e)}};s.prototype.getInstanceBreakpointData=function(t,e){if(typeof e==="undefined"){e=false}var a=this._mBreakpointData.instances[this._classPrefix+t.getMetadata().getName()];if(!a){if(e){this._mBreakpointData.instances[this._classPrefix+t.getMetadata().getName()]=a={}}else{return null}}var i=a[this._idPrefix+t.getId()];if(!i){if(e){a[this._idPrefix+t.getId()]=i={}}else{return null}}return i};s.prototype.getClassBreakpointData=function(t,e){if(typeof e==="undefined"){e=false}var a=this._mBreakpointData.classes[this._classPrefix+t];if(!a){if(e){this._mBreakpointData.classes[this._classPrefix+t]=a={}}else{return null}}return a};s.prototype.isInstanceBreakpointActive=function(t,e){var a=this.getInstanceBreakpointData(t);if(!a){return false}var i=a[this._methodPrefix+e];if(!i){return false}return i.active};s.prototype.isClassBreakpointActive=function(t,e){var a=this.getClassBreakpointData(t);if(!a){return false}var i=a[this._methodPrefix+e];if(!i){return false}return i.active};s.prototype.applyInstanceMethodHook=function(t,e,a){var i=this.getInstanceBreakpointData(e,true),n=i[this._methodPrefix+a]||(i[this._methodPrefix+a]={});n.originalMethod=e[a];n.active=true;e[a]=this.methodHook(n.originalMethod)};s.prototype.removeInstanceMethodHook=function(t,e,a){var i=this.getInstanceBreakpointData(e,true),n=i[this._methodPrefix+a];e[a]=n.originalMethod;delete n.originalMethod;n.active=false};s.prototype.applyClassMethodHook=function(t,e,a,i){var n=this.getClassBreakpointData(t,true),r=n[this._methodPrefix+a]||(n[this._methodPrefix+a]={});if(i===this._methodType.clazz){r.originalMethod=e[a];e[a]=this.methodHook(r.originalMethod)}else{r.originalMethod=e.prototype[a];e.prototype[a]=this.methodHook(r.originalMethod)}r.type=i;r.active=true};s.prototype.removeClassMethodHook=function(t,e,a){var i=this.getClassBreakpointData(t,true),n=i[this._methodPrefix+a];if(n.type===this._methodType.clazz){e[a]=n.originalMethod}else{e.prototype[a]=n.originalMethod}delete n.originalMethod;n.active=false};s.prototype.methodHook=function(t){var e=this;return function(){var a=(new Date).getTime();debugger;if((new Date).getTime()-a<50){e._alertNoDebugger()}return t.apply(this,arguments)}};s.prototype._alertNoDebugger=function(){if(this._bAlertNoDebugger){return}var e=null;if(t.browser.chrome){e="Please open your debugger by pressing CTRL + SHIFT + I."}if(t.browser.msie){e="Please open your debugger using F12, go to the 'Script' tab and attach it by pressing F5."}if(e==null){e="Please open your debugger."}this._bAlertNoDebugger=true;alert("There is no debugger attached.\n\n"+e)};return s});