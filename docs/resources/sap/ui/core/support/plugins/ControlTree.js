/*!
 * OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/support/Plugin","sap/ui/core/util/serializer/ViewSerializer","sap/ui/core/util/File","sap/ui/thirdparty/jszip","sap/ui/base/DataType","sap/ui/core/Element","sap/ui/core/ElementMetadata","sap/ui/core/UIArea","sap/ui/core/mvc/View","sap/ui/core/mvc/Controller","sap/ui/model/Binding","sap/ui/model/CompositeBinding","sap/base/util/ObjectPath","sap/ui/thirdparty/jquery","sap/ui/events/KeyCodes","sap/base/security/encodeXML"],function(t,e,i,r,o,a,n,s,p,l,d,c,u,g,h,f){"use strict";var v=jQuery;var b=t.extend("sap.ui.core.support.plugins.ControlTree",{constructor:function(e){t.apply(this,["sapUiSupportControlTree","Control Tree",e]);this._oStub=e;if(this.runsAsToolPlugin()){this._aEventIds=["sapUiSupportSelectorSelect",this.getId()+"ReceiveControlTree",this.getId()+"ReceiveControlTreeExport",this.getId()+"ReceiveControlTreeExportError",this.getId()+"TriggerRequestProperties",this.getId()+"ReceiveProperties",this.getId()+"ReceiveBindingInfos",this.getId()+"ReceiveMethods",this.getId()+"ReceivePropertiesMethods"];this._breakpointId="sapUiSupportBreakpoint";this._tab={properties:"Properties",bindinginfos:"BindingInfos",breakpoints:"Breakpoints",exports:"Export"};this._currentTab=this._tab.properties}else{this._aEventIds=[this.getId()+"RequestControlTree",this.getId()+"RequestControlTreeSerialize",this.getId()+"RequestProperties",this.getId()+"RequestBindingInfos",this.getId()+"ChangeProperty",this.getId()+"RefreshBinding"];var i=this;sap.ui.getCore().registerPlugin({startPlugin:function(t){i.oCore=t},stopPlugin:function(){i.oCore=undefined}})}}});b.prototype.init=function(e){t.prototype.init.apply(this,arguments);if(this.runsAsToolPlugin()){C.call(this,e)}else{y.call(this,e)}};function C(t){v(document).on("click","li img.sapUiControlTreeIcon",v.proxy(this._onIconClick,this)).on("click","li.sapUiControlTreeElement div",v.proxy(this._onNodeClick,this)).on("click","li.sapUiControlTreeLink div",v.proxy(this._onControlTreeLinkClick,this)).on("click","#sapUiSupportControlTabProperties",v.proxy(this._onPropertiesTab,this)).on("click","#sapUiSupportControlTabBindingInfos",v.proxy(this._onBindingInfosTab,this)).on("click","#sapUiSupportControlTabBreakpoints",v.proxy(this._onMethodsTab,this)).on("click","#sapUiSupportControlTabExport",v.proxy(this._onExportTab,this)).on("change","[data-sap-ui-name]",v.proxy(this._onPropertyChange,this)).on("change","[data-sap-ui-method]",v.proxy(this._onPropertyBreakpointChange,this)).on("keyup",'.sapUiSupportControlMethods input[type="text"]',v.proxy(this._autoComplete,this)).on("blur",'.sapUiSupportControlMethods input[type="text"]',v.proxy(this._updateSelectOptions,this)).on("change",".sapUiSupportControlMethods select",v.proxy(this._selectOptionsChanged,this)).on("click","#sapUiSupportControlAddBreakPoint",v.proxy(this._onAddBreakpointClicked,this)).on("click","#sapUiSupportControlExportToXml",v.proxy(this._onExportToXmlClicked,this)).on("click","#sapUiSupportControlExportToHtml",v.proxy(this._onExportToHtmlClicked,this)).on("click","#sapUiSupportControlActiveBreakpoints img.remove-breakpoint",v.proxy(this._onRemoveBreakpointClicked,this)).on("click","#sapUiSupportControlPropertiesArea a.control-tree",v.proxy(this._onNavToControl,this)).on("click","#sapUiSupportControlPropertiesArea img.sapUiSupportRefreshBinding",v.proxy(this._onRefreshBinding,this));this.renderContentAreas()}b.prototype.exit=function(e){t.prototype.exit.apply(this,arguments);if(this.runsAsToolPlugin()){v(document).off("click","li img.sapUiControlTreeIcon").off("click","li div").off("click","li.sapUiControlTreeLink").off("click","#sapUiSupportControlTabProperties").off("click","#sapUiSupportControlTabBindings").off("click","#sapUiSupportControlTabBreakpoints").off("click","#sapUiSupportControlTabExport").off("change","[data-sap-ui-name]").off("change","[data-sap-ui-method]").off("keyup",'.sapUiSupportControlMethods input[type="text"]').off("blur",".sapUiSupportControlMethods select").off("change",".sapUiSupportControlMethods select").off("click","#sapUiSupportControlAddBreakPoint").off("click","#sapUiSupportControlExportToXml").off("click","#sapUiSupportControlExportToHtml").off("click","#sapUiSupportControlActiveBreakpoints img.remove-breakpoint").off("click","#sapUiSupportControlPropertiesArea a.control-tree").off("click","#sapUiSupportControlPropertiesArea img.sapUiSupportRefreshBinding")}};function w(t){if(t==null){return""}t=String(t);return t.slice(1+t.lastIndexOf("."))}function m(t){return t==null?"":f(String(t))}b.prototype.renderContentAreas=function(){var t=sap.ui.getCore().createRenderManager();t.write('<div style="padding: 0.5rem">You can find a control in this tree by clicking it in the application UI while pressing the Ctrl+Alt+Shift keys.</div>');t.write('<div id="sapUiSupportControlTreeArea"><ul class="sapUiSupportControlTreeList"></ul></div>');t.write('<div id="sapUiSupportControlTabs" style="visibility:hidden">');t.write('<button id="sapUiSupportControlTabProperties" class="sapUiSupportBtn sapUiSupportTab sapUiSupportTabLeft">Properties</button>');t.write('<button id="sapUiSupportControlTabBindingInfos" class="sapUiSupportBtn sapUiSupportTab">Binding Infos</button>');t.write('<button id="sapUiSupportControlTabBreakpoints" class="sapUiSupportBtn sapUiSupportTab">Breakpoints</button>');t.write('<button id="sapUiSupportControlTabExport" class="sapUiSupportBtn sapUiSupportTab sapUiSupportTabRight">Export</button>');t.write("</div>");t.write('<div id="sapUiSupportControlPropertiesArea"></div>');t.flush(this.$().get(0));t.destroy()};b.prototype.renderControlTree=function(t){var e=sap.ui.getCore().createRenderManager();function i(t,r){var o=r.aggregation.length>0||r.association.length>0;e.write('<li id="sap-debug-controltree-'+m(r.id)+'" class="sapUiControlTreeElement">');var a=o?"minus":"space";e.write('<img class="sapUiControlTreeIcon" style="height: 12px; width: 12px;" src="../../debug/images/'+a+'.gif" />');if(r.isAssociation){e.write('<img title="Association" class="sapUiControlTreeIcon" style="height: 12px; width: 12px;" src="../../debug/images/link.gif" />')}var n=w(r.type);e.write("<div>");e.write('<span class="name" title="'+m(r.type)+'">'+m(n)+" - "+m(r.id)+"</span>");e.write('<span class="sapUiSupportControlTreeBreakpointCount" title="Number of active breakpoints / methods" style="display:none;"></span>');e.write("</div>");if(r.aggregation.length>0){e.write("<ul>");v.each(r.aggregation,i);e.write("</ul>")}if(r.association.length>0){e.write("<ul>");v.each(r.association,function(t,r){if(r.isAssociationLink){var o=w(r.type);e.write('<li data-sap-ui-controlid="'+m(r.id)+'" class="sapUiControlTreeLink">');e.write('<img class="sapUiControlTreeIcon" style="height: 12px; width: 12px;" align="middle" src="../../debug/images/space.gif" />');e.write('<img class="sapUiControlTreeIcon" style="height: 12px; width: 12px;" align="middle" src="../../debug/images/link.gif" />');e.write("<div><span title=\"Association '"+m(r.name)+"' to '"+m(r.id)+"' with type '"+m(r.type)+"'\">"+m(o)+" - "+m(r.id)+" ("+m(r.name)+")</span></div>");e.write("</li>")}else{i(0,r)}});e.write("</ul>")}e.write("</li>")}v.each(t,i);e.flush(this.$().find("#sapUiSupportControlTreeArea > ul.sapUiSupportControlTreeList").get(0));e.destroy()};b.prototype.renderPropertiesTab=function(t,e){var i=sap.ui.getCore().createRenderManager();i.write('<ul class="sapUiSupportControlTreeList" data-sap-ui-controlid="'+m(e)+'">');v.each(t,function(t,e){i.write("<li>");i.write("<span><label class='sapUiSupportLabel'>BaseType:</label> <code>"+m(e.control)+"</code></span>");if(e.properties.length>0||e.aggregations.length>0){i.write('<div class="get" title="Activate debugger for get-method">G</div><div class="set" title="Activate debugger for set-method">S</div>');i.write('<div class="sapUiSupportControlProperties"><table><colgroup><col width="50%"/><col width="50%"/></colgroup>');v.each(e.properties,function(t,e){i.write("<tr><td>");i.write("<label class='sapUiSupportLabel'>"+m(e.name)+(e.isBound?'<img title="Value is bound (see Binding Infos)" src="../../debug/images/link.gif" style="vertical-align:middle;margin-left:3px">':"")+"</label>");i.write("</td><td>");if(e.type==="boolean"){i.write("<input type='checkbox' ");i.write("data-sap-ui-name='"+m(e.name)+"' ");if(e.value==true){i.write("checked='checked'")}i.write("/>")}else if(e.enumValues){i.write("<div><select ");i.write("data-sap-ui-name='"+m(e.name)+"'>");v.each(e.enumValues,function(t,r){i.write("<option");if(t===e.value){i.write(" selected")}i.write(">");i.writeEscaped(""+t);i.write("</option>")});i.write("</select></div>")}else{i.write("<div><input type='text' ");i.write("data-sap-ui-name='"+m(e.name)+"' ");if(e.value){i.write("value='");i.writeEscaped(""+e.value);i.write("'")}i.write("/></div>")}i.write("</td>");i.write('<td><input type="checkbox" data-sap-ui-method="'+m(e._sGetter)+'" title="Activate debugger for '+m(e._sGetter)+'"');if(e.bp_sGetter){i.write("checked='checked'")}i.write("/></td>");i.write('<td><input type="checkbox" data-sap-ui-method="'+m(e._sMutator)+'" title="Activate debugger for '+m(e._sMutator)+'"');if(e.bp_sMutator){i.write("checked='checked'")}i.write("/></td>");i.write("</tr>")});v.each(e.aggregations,function(t,e){i.write("<tr><td>");i.write("<label class='sapUiSupportLabel'>"+m(e.name)+"</label>");i.write("</td><td>");i.write(m(e.value));i.write("</td>");i.write('<td><input type="checkbox" data-sap-ui-method="'+m(e._sGetter)+'" title="Activate debugger for '+m(e._sGetter)+'"');if(e.bp_sGetter){i.write("checked='checked'")}i.write("/></td>");i.write('<td><input type="checkbox" data-sap-ui-method="'+m(e._sMutator)+'" title="Activate debugger for '+m(e._sMutator)+'"');if(e.bp_sMutator){i.write("checked='checked'")}i.write("/></td>");i.write("</tr>")});i.write("</table></div>")}i.write("</li>")});i.write("</ul>");i.flush(this.$().find("#sapUiSupportControlPropertiesArea").get(0));i.destroy();this.$().find("#sapUiSupportControlTabs").css("visibility","");this.selectTab(this._tab.properties)};b.prototype.renderBindingsTab=function(t,e){var i=sap.ui.getCore().createRenderManager();if(t.contexts.length>0){i.write('<h2 style="padding-left:5px">Contexts</h2>');i.write('<ul class="sapUiSupportControlTreeList" data-sap-ui-controlid="'+m(e)+'">');v.each(t.contexts,function(t,e){i.write("<li>");i.write('<span><label class="sapUiSupportLabel">Model Name: '+m(e.modelName)+"</label></span>");i.write('<div class="sapUiSupportControlProperties">');i.write('<table><colgroup><col width="15%"><col width="35%"><col width="50%"></colgroup>');i.write("<tbody>");i.write('<tr><td colspan="2">');i.write('<label class="sapUiSupportLabel">Path</label>');i.write("</td><td>");i.write("<div><span");if(e.invalidPath){i.write(' style="color:red"')}else if(e.unverifiedPath){i.write(' style="color:orange"')}i.write(">"+m(e.path));if(e.invalidPath){i.write(" (invalid)")}else if(e.unverifiedPath){i.write(" (unverified)")}i.write("</span></div>");i.write("</td></tr>");if(e.location){i.write('<tr><td colspan="2">');i.write('<label class="sapUiSupportLabel">Inherited from</label>');i.write("</td><td>");i.write('<div><a class="control-tree sapUiSupportLink" title="'+m(e.location.name)+'" data-sap-ui-control-id="'+m(e.location.id)+'" href="#">'+m(w(e.location.name))+" ("+m(e.location.id)+")</a></div>");i.write("</td></tr>")}i.write("</tbody></table></div></li>")});i.write("</ul>")}if(t.bindings.length>0){i.write('<h2 style="padding-left:5px">Bindings</h2>');i.write('<ul class="sapUiSupportControlTreeList" data-sap-ui-controlid="'+m(e)+'">');v.each(t.bindings,function(t,e){i.write('<li data-sap-ui-binding-name="'+m(e.name)+'">');i.write("<span>");i.write('<label class="sapUiSupportLabel" style="vertical-align: middle">'+m(e.name)+"</label>");i.write('<img class="sapUiSupportRefreshBinding" title="Refresh Binding" '+'src="../../debug/images/refresh.gif" style="cursor:pointer;margin-left:5px;vertical-align:middle">');i.write("</span>");v.each(e.bindings,function(t,r){i.write('<div class="sapUiSupportControlProperties">');i.write('<table><colgroup><col width="15%"><col width="35%"><col width="50%"></colgroup>');i.write("<tbody>");i.write('<tr><td colspan="2">');i.write('<label class="sapUiSupportLabel">Path</label>');i.write("</td><td>");i.write("<div><span");if(r.invalidPath){i.write(' style="color:red"')}else if(r.unverifiedPath){i.write(' style="color:orange"')}i.write(">"+m(r.path));if(r.invalidPath){i.write(" (invalid)")}else if(r.unverifiedPath){i.write(" (unverified)")}i.write("</span></div>");i.write("</td></tr>");i.write('<tr><td colspan="2">');i.write('<label class="sapUiSupportLabel">Absolute Path</label>');i.write("</td><td>");if(typeof r.absolutePath!=="undefined"){i.write("<div>"+m(r.absolutePath)+"</div>")}else{i.write("<div>No binding</div>")}i.write("</td></tr>");i.write('<tr><td colspan="2">');i.write('<label class="sapUiSupportLabel">Relative</label>');i.write("</td><td>");if(typeof r.isRelative!=="undefined"){i.write("<div>"+m(r.isRelative)+"</div>")}else{i.write("<div>No binding</div>")}i.write("</td></tr>");i.write('<tr><td colspan="2">');i.write('<label class="sapUiSupportLabel">Binding Type</label>');i.write("</td><td>");if(!e.type){i.write("<div>No binding</div>")}else{i.write('<div title="'+m(e.type)+'">'+m(w(e.type))+"</div>")}i.write("</td></tr>");if(r.mode){i.write('<tr><td colspan="2">');i.write('<label class="sapUiSupportLabel">Binding Mode</label>');i.write("</td><td>");i.write("<div>"+m(r.mode)+"</div>");i.write("</td></tr>")}i.write("<tr><td>");i.write('<label class="sapUiSupportLabel">Model</label>');i.write("</td><td>");i.write('<label class="sapUiSupportLabel">Name</label>');i.write("</td><td>");if(r.model&&r.model.name){i.write("<div>"+m(r.model.name)+"</div>")}else{i.write("<div>No binding</div>")}i.write("</td></tr>");i.write("<tr><td>");i.write("</td><td>");i.write('<label class="sapUiSupportLabel">Type</label>');i.write("</td><td>");if(r.model&&r.model.type){i.write('<div><span title="'+m(r.model.type)+'">'+m(w(r.model.type))+"</span></div>")}else{i.write("<div><span>No binding</span></div>")}i.write("</td></tr>");i.write("<tr><td>");i.write("</td><td>");i.write('<label class="sapUiSupportLabel">Default Binding Mode</label>');i.write("</td><td>");if(r.model&&r.model.bindingMode){i.write("<div><span>"+m(r.model.bindingMode)+"</span></div>")}else{i.write("<div><span>No binding</span></div>")}i.write("</td></tr>");i.write("<tr><td>");i.write("</td><td>");i.write('<label class="sapUiSupportLabel">Location</label>');i.write("</td><td>");if(r.model&&r.model.location&&r.model.location.type){if(r.model.location.type==="control"){i.write('<div><a class="control-tree sapUiSupportLink" title="'+m(r.model.location.name)+'" data-sap-ui-control-id="'+m(r.model.location.id)+'" href="#">'+m(w(r.model.location.name))+" ("+m(r.model.location.id)+")</a></div>")}else{i.write('<div><span title="sap.ui.getCore()">Core</span></div>')}}else{i.write("<div><span>No binding</span></div>")}i.write("</td></tr>");i.write("</tbody></table></div>")});i.write("</li>")});i.write("</ul>")}i.flush(this.$().find("#sapUiSupportControlPropertiesArea").get(0));i.destroy()};b.prototype.renderBreakpointsTab=function(t,e){var i=sap.ui.getCore().createRenderManager();i.write('<div class="sapUiSupportControlMethods" data-sap-ui-controlid="'+m(e)+'">');i.write('<select id="sapUiSupportControlMethodsSelect" class="sapUiSupportAutocomplete sapUiSupportSelect"><option></option>');v.each(t,function(t,e){if(!e.active){i.write("<option>"+m(e.name)+"</option>")}});i.write("</select>");i.write('<input class="sapUiSupportControlBreakpointInput sapUiSupportAutocomplete" type="text"/>');i.write('<button id="sapUiSupportControlAddBreakPoint" class="sapUiSupportRoundedButton ">Add breakpoint</button>');i.write('<hr class="no-border"/><ul id="sapUiSupportControlActiveBreakpoints" class="sapUiSupportList sapUiSupportBreakpointList">');v.each(t,function(t,e){if(!e.active){return}i.write("<li><span>"+m(e.name)+"</span>"+'<img class="remove-breakpoint" style="cursor:pointer;margin-left:5px" '+'src="../../debug/images/delete.gif"></li>')});i.write("</ul></div>");i.flush(this.$().find("#sapUiSupportControlPropertiesArea").get(0));i.destroy();this.selectTab(this._tab.breakpoints);this.$().find(".sapUiSupportControlBreakpointInput").focus()};b.prototype.renderExportTab=function(){var t=sap.ui.getCore().createRenderManager();t.write('<button id="sapUiSupportControlExportToXml" class="sapUiSupportRoundedButton sapUiSupportExportButton">Export To XML</button>');t.write("<br><br>");t.write('<button id="sapUiSupportControlExportToHtml" class="sapUiSupportRoundedButton sapUiSupportExportButton">Export To HTML</button>');t.flush(this.$().find("#sapUiSupportControlPropertiesArea").get(0));t.destroy();this.selectTab(this._tab.exports)};b.prototype.requestProperties=function(t){this._oStub.sendEvent(this._breakpointId+"RequestInstanceMethods",{controlId:t,callback:this.getId()+"ReceivePropertiesMethods"})};b.prototype.updateBreakpointCount=function(t,e){var i=v("#sap-debug-controltree-"+t+" > div span.sapUiSupportControlTreeBreakpointCount");if(e.active>0){i.text(e.active+" / "+e.all).show()}else{i.text("").hide()}};b.prototype.onsapUiSupportControlTreeTriggerRequestProperties=function(t){this.requestProperties(t.getParameter("controlId"))};b.prototype.onsapUiSupportControlTreeReceivePropertiesMethods=function(t){var e=t.getParameter("controlId");this._oStub.sendEvent(this.getId()+"RequestProperties",{id:e,breakpointMethods:t.getParameter("methods")});this.updateBreakpointCount(e,JSON.parse(t.getParameter("breakpointCount")))};b.prototype.onsapUiSupportControlTreeReceiveControlTree=function(t){this.renderControlTree(JSON.parse(t.getParameter("controlTree")))};b.prototype.onsapUiSupportControlTreeReceiveControlTreeExportError=function(t){var e=t.getParameter("errorMessage");this._drawAlert(e)};b.prototype._drawAlert=function(t){alert("ERROR: The selected element cannot not be exported.\nPlease choose an other one.\n\nReason:\n"+t)};b.prototype.onsapUiSupportControlTreeReceiveControlTreeExport=function(t){var e;var o=JSON.parse(t.getParameter("serializedViews"));var a=t.getParameter("sType");if(!v.isEmptyObject(o)){e=new r;for(var n in o){var s=o[n];e.file(n.replace(/\./g,"/")+".view."+a.toLowerCase(),s)}}if(e){var p=e.generate({type:"blob"});i.save(p,a.toUpperCase()+"Export","zip","application/zip")}};b.prototype.onsapUiSupportSelectorSelect=function(t){this.selectControl(t.getParameter("id"))};b.prototype.onsapUiSupportControlTreeReceiveProperties=function(t){this.renderPropertiesTab(JSON.parse(t.getParameter("properties")),t.getParameter("id"))};b.prototype.onsapUiSupportControlTreeReceiveBindingInfos=function(t){this.renderBindingsTab(JSON.parse(t.getParameter("bindinginfos")),t.getParameter("id"))};b.prototype.onsapUiSupportControlTreeReceiveMethods=function(t){var e=t.getParameter("controlId");this.renderBreakpointsTab(JSON.parse(t.getParameter("methods")),e);this.updateBreakpointCount(e,JSON.parse(t.getParameter("breakpointCount")))};b.prototype._onNodeClick=function(t){var e=v(t.target);var i=e.closest("li");if(i.hasClass("sapUiControlTreeElement")){v(".sapUiControlTreeElement > div").removeClass("sapUiSupportControlTreeSelected");i.children("div").addClass("sapUiSupportControlTreeSelected");this._oStub.sendEvent("sapUiSupportSelectorHighlight",{id:i.attr("id").substring("sap-debug-controltree-".length)});var r=i.attr("id").substring("sap-debug-controltree-".length);if(e.hasClass("sapUiSupportControlTreeBreakpointCount")){this._currentTab=this._tab.breakpoints}this.onAfterControlSelected(r)}t.stopPropagation()};b.prototype._onIconClick=function(t){var e=v(t.target);if(e.parent().attr("data-sap-ui-collapsed")){e.attr("src",e.attr("src").replace("plus","minus")).parent().removeAttr("data-sap-ui-collapsed");e.siblings("ul").show()}else{e.attr("src",e.attr("src").replace("minus","plus")).parent().attr("data-sap-ui-collapsed","true");e.siblings("ul").hide()}if(t.stopPropagation){t.stopPropagation()}};b.prototype._onControlTreeLinkClick=function(t){this.selectControl(v(t.target).closest("li").attr("data-sap-ui-controlid"))};b.prototype._onPropertiesTab=function(t){if(this.selectTab(this._tab.properties)){this.requestProperties(this.getSelectedControlId())}};b.prototype._onBindingInfosTab=function(t){if(this.selectTab(this._tab.bindinginfos)){this._oStub.sendEvent(this.getId()+"RequestBindingInfos",{id:this.getSelectedControlId()})}};b.prototype._onMethodsTab=function(t){if(this.selectTab(this._tab.breakpoints)){this._oStub.sendEvent(this._breakpointId+"RequestInstanceMethods",{controlId:this.getSelectedControlId(),callback:this.getId()+"ReceiveMethods"})}};b.prototype._onExportTab=function(t){if(this.selectTab(this._tab.exports)){this.renderExportTab()}};b.prototype._autoComplete=function(t){if(t.keyCode==h.ENTER){this._updateSelectOptions(t);this._onAddBreakpointClicked()}if(t.keyCode>=h.ARROW_LEFT&&t.keyCode<=h.ARROW_DOWN){return}var e=v(t.target),i=e.prev("select"),r=e.val();if(r==""){return}var o=i.find("option").map(function(){return v(this).val()}).get();var a;for(var n=0;n<o.length;n++){a=o[n];if(a.toUpperCase().indexOf(r.toUpperCase())==0){var s=e.cursorPos();if(t.keyCode==h.BACKSPACE){s--}e.val(a);e.selectText(s,a.length);break}}return};b.prototype._updateSelectOptions=function(t){var e=t.target;if(e.tagName=="INPUT"){var i=e.value;e=e.previousSibling;var r=e.options;for(var o=0;o<r.length;o++){var a=r[o].value||r[o].text;if(a.toUpperCase()==i.toUpperCase()){e.selectedIndex=o;break}}}var n=e.selectedIndex;var s=e.options[n].value||e.options[n].text;if(e.nextSibling&&e.nextSibling.tagName=="INPUT"){e.nextSibling.value=s}};b.prototype._onAddBreakpointClicked=function(t){var e=this.$().find("#sapUiSupportControlMethodsSelect");this._oStub.sendEvent(this._breakpointId+"ChangeInstanceBreakpoint",{controlId:e.closest("[data-sap-ui-controlid]").attr("data-sap-ui-controlid"),methodName:e.val(),active:true,callback:this.getId()+"ReceiveMethods"})};b.prototype._onExportToXmlClicked=function(t){this._startSerializing("XML")};b.prototype._onExportToHtmlClicked=function(t){this._startSerializing("HTML")};b.prototype._startSerializing=function(t){var e=this.getSelectedControlId();if(e){this._oStub.sendEvent(this.getId()+"RequestControlTreeSerialize",{controlID:e,sType:t})}else{this._drawAlert("Nothing to export. Please select an item in the control tree.")}};b.prototype._onRemoveBreakpointClicked=function(t){var e=v(t.target);this._oStub.sendEvent(this._breakpointId+"ChangeInstanceBreakpoint",{controlId:e.closest("[data-sap-ui-controlid]").attr("data-sap-ui-controlid"),methodName:e.siblings("span").text(),active:false,callback:this.getId()+"ReceiveMethods"})};b.prototype._selectOptionsChanged=function(t){var e=t.target;var i=e.nextSibling;i.value=e.options[e.selectedIndex].value};b.prototype._onPropertyChange=function(t){var e=t.target;var i=v(e);var r=i.closest("[data-sap-ui-controlid]").attr("data-sap-ui-controlid");var o=i.val();if(i.attr("type")==="checkbox"){o=""+i.is(":checked")}this._oStub.sendEvent(this.getId()+"ChangeProperty",{id:r,name:i.attr("data-sap-ui-name"),value:o})};b.prototype._onPropertyBreakpointChange=function(t){var e=v(t.target);this._oStub.sendEvent(this._breakpointId+"ChangeInstanceBreakpoint",{controlId:e.closest("[data-sap-ui-controlid]").attr("data-sap-ui-controlid"),methodName:e.attr("data-sap-ui-method"),active:e.is(":checked"),callback:this.getId()+"TriggerRequestProperties"})};b.prototype._onNavToControl=function(t){var e=v(t.target);var i=e.attr("data-sap-ui-control-id");if(i!==this.getSelectedControlId()){this.selectControl(i)}};b.prototype._onRefreshBinding=function(t){var e=v(t.target);var i=e.closest("[data-sap-ui-controlid]").attr("data-sap-ui-controlid");var r=e.closest("[data-sap-ui-binding-name]").attr("data-sap-ui-binding-name");this._oStub.sendEvent(this.getId()+"RefreshBinding",{id:i,name:r})};b.prototype.selectTab=function(t){var e=this.$().find("#sapUiSupportControlTab"+t);if(e.hasClass("active")){return false}this.$().find("#sapUiSupportControlTabs button").removeClass("active");e.addClass("active");this._currentTab=t;return true};b.prototype.getSelectedControlId=function(){var t=this.$().find(".sapUiSupportControlTreeSelected");if(t.length===0){return undefined}else{return t.parent().attr("id").substring("sap-debug-controltree-".length)}};b.prototype.selectControl=function(t){if(!t){return}v(".sapUiControlTreeElement > div").removeClass("sapUiSupportControlTreeSelected");var e=this;g(document.getElementById("sap-debug-controltree-"+t)).parents("[data-sap-ui-collapsed]").each(function(t,i){e._onIconClick({target:v(i).find("img:first").get(0)})});var i=g(document.getElementById("sap-debug-controltree-"+t)).children("div").addClass("sapUiSupportControlTreeSelected").position();var r=this.$().find("#sapUiSupportControlTreeArea").scrollTop();this.$().find("#sapUiSupportControlTreeArea").scrollTop(r+i.top);this.onAfterControlSelected(t)};b.prototype.onAfterControlSelected=function(t){if(this._currentTab==this._tab.properties){this.requestProperties(t)}else if(this._currentTab==this._tab.breakpoints){this._oStub.sendEvent(this._breakpointId+"RequestInstanceMethods",{controlId:t,callback:this.getId()+"ReceiveMethods"})}else if(this._currentTab==this._tab.bindinginfos){this._oStub.sendEvent(this.getId()+"RequestBindingInfos",{id:this.getSelectedControlId()})}};function y(t){this.onsapUiSupportControlTreeRequestControlTree()}b.prototype.onsapUiSupportControlTreeRequestControlTree=function(t){this._oStub.sendEvent(this.getId()+"ReceiveControlTree",{controlTree:JSON.stringify(this.getControlTree())})};b.prototype.onsapUiSupportControlTreeRequestControlTreeSerialize=function(t){var i=this.oCore.byId(t.getParameter("controlID"));var r=t.getParameter("sType");var o;var a;sap.ui.controller(r+"ViewController",{});sap.ui.jsview(r+"ViewExported",{getControllerName:function(){return r+"ViewController"},createContent:function(t){}});sap.ui.controller(r+"ViewController",{});sap.ui.jsview(r+"ViewExported",{getControllerName:function(){return r+"ViewController"},createContent:function(t){}});try{if(i){if(i instanceof p){o=new e(i,window,"sap.m")}else{var n=sap.ui.jsview(r+"ViewExported");n.addContent(i.clone());o=new e(n,window,"sap.m")}a=r&&r!=="XML"?o.serializeToHTML():o.serializeToXML()}else{var s=this.oCore.getUIArea(t.getParameter("controlID"));var n=sap.ui.jsview(r+"ViewExported");var l=s.getContent();for(var d=0;d<l.length;d++){n.addContent(l[d])}o=new e(n,window,"sap.m");a=r&&r!=="XML"?o.serializeToHTML():o.serializeToXML();for(var d=0;d<l.length;d++){s.addContent(l[d])}}if(o){this._oStub.sendEvent(this.getId()+"ReceiveControlTreeExport",{serializedViews:JSON.stringify(a),sType:r})}}catch(t){this._oStub.sendEvent(this.getId()+"ReceiveControlTreeExportError",{errorMessage:t.message})}};b.prototype.onsapUiSupportControlTreeRequestProperties=function(t){var e=JSON.parse(t.getParameter("breakpointMethods"));var i=this.getControlProperties(t.getParameter("id"),e);this._oStub.sendEvent(this.getId()+"ReceiveProperties",{id:t.getParameter("id"),properties:JSON.stringify(i)})};b.prototype.onsapUiSupportControlTreeChangeProperty=function(t){var e=t.getParameter("id");var i=this.oCore.byId(e);if(i){var r=t.getParameter("name");var a=t.getParameter("value");var n=i.getMetadata().getProperty(r);if(n&&n.type){var s=o.getType(n.type);if(s instanceof o){var p=s.parseValue(a);if(s.isValid(p)&&p!=="(null)"){i[n._sMutator](p)}}else if(s){if(s[a]){i[n._sMutator](a)}}}}};b.prototype.onsapUiSupportControlTreeRequestBindingInfos=function(t){var e=t.getParameter("id");this._oStub.sendEvent(this.getId()+"ReceiveBindingInfos",{id:e,bindinginfos:JSON.stringify(this.getControlBindingInfos(e))})};b.prototype.onsapUiSupportControlTreeRefreshBinding=function(t){var e=t.getParameter("id");var i=t.getParameter("name");this.refreshBinding(e,i);this._oStub.sendEvent(this.getId()+"ReceiveBindingInfos",{id:e,bindinginfos:JSON.stringify(this.getControlBindingInfos(e))})};b.prototype.getControlTree=function(){var t=this.oCore,e=[],i={};function r(t){var e={id:t.getId(),type:"",aggregation:[],association:[]};i[e.id]=e.id;if(t instanceof s){e.library="sap.ui.core";e.type="sap.ui.core.UIArea";v.each(t.getContent(),function(t,i){var o=r(i);e.aggregation.push(o)})}else{e.library=t.getMetadata().getLibraryName();e.type=t.getMetadata().getName();if(t.mAggregations){for(var o in t.mAggregations){var n=t.mAggregations[o];if(n){var p=v.isArray(n)?n:[n];v.each(p,function(t,i){if(i instanceof a){var o=r(i);e.aggregation.push(o)}})}}}if(t.mAssociations){var l=t.getMetadata().getAllAssociations();for(var d in t.mAssociations){var c=t.mAssociations[d];var u=l[d]?l[d].type:null;if(c&&u){var g=v.isArray(c)?c:[c];v.each(g,function(t,i){e.association.push({id:i,type:u,name:d,isAssociationLink:true})})}}}}return e}v.each(t.mUIAreas,function(t,i){var o=r(i);e.push(o)});function o(e,a){for(var n=0;n<a.association.length;n++){var s=a.association[n];if(!i[s.id]){var p=u.get(s.type||"");if(!(typeof p==="function")){continue}var l=p.getMetadata().getStereotype(),d=null;switch(l){case"element":case"control":d=t.byId(s.id);break;case"component":d=t.getComponent(s.id);break;case"template":d=t.getTemplate(s.id);break;default:break}if(!d){continue}a.association[n]=r(d);a.association[n].isAssociation=true;o(0,a.association[n])}}v.each(a.aggregation,o)}v.each(e,o);return e};b.prototype.getControlProperties=function(t,e){var i=/^((boolean|string|int|float)(\[\])?)$/;var r=[];var a=this.oCore.byId(t);if(!a&&this.oCore.getUIArea(t)){r.push({control:"sap.ui.core.UIArea",properties:[],aggregations:[]})}else if(a){var s=a.getMetadata();while(s instanceof n){var p={control:s.getName(),properties:[],aggregations:[]};var l=s.getProperties();v.each(l,function(t,i){var r={};v.each(i,function(t,a){if(t.substring(0,1)!=="_"||(t=="_sGetter"||t=="_sMutator")){r[t]=a}if(t=="_sGetter"||t=="_sMutator"){r["bp"+t]=e.filter(function(t){return t.name===a&&t.active}).length===1}var n=o.getType(i.type);if(n&&!(n instanceof o)){r["enumValues"]=n}});r.value=a.getProperty(t);r.isBound=!!a.mBindingInfos[t];p.properties.push(r)});var d=s.getAggregations();v.each(d,function(t,r){if(r.altTypes&&r.altTypes[0]&&i.test(r.altTypes[0])&&typeof a.getAggregation(t)!=="object"){var o={};v.each(r,function(t,i){if(t.substring(0,1)!=="_"||(t=="_sGetter"||t=="_sMutator")){o[t]=i}if(t=="_sGetter"||t=="_sMutator"){o["bp"+t]=e.filter(function(t){return t.name===i&&t.active}).length===1}});o.value=a.getAggregation(t);p.aggregations.push(o)}});r.push(p);s=s.getParent()}}return r};b.prototype.getControlBindingInfos=function(t){var e={bindings:[],contexts:[]};var i=this.oCore.byId(t);if(!i){return e}var r=i.mBindingInfos;var o=this;for(var a in r){if(r.hasOwnProperty(a)){var n=r[a];var s=[];var p,l=[];if(v.isArray(n.parts)){p=n.parts}else{p=[n]}if(n.binding instanceof c){l=n.binding.getBindings()}else if(n.binding instanceof d){l=[n.binding]}v.each(p,function(t,e){var r={};r.invalidPath=true;r.path=e.path;r.mode=e.mode;r.model={name:e.model};if(l.length>t&&l[t]){var a=l[t],n=a.getModel(),p=a.getPath(),d;if(n){d=n.resolve(p,a.getContext());if(n.isA("sap.ui.model.odata.v4.ODataModel")){r.unverifiedPath=true;r.invalidPath=false}else{if(n.getProperty(d)!==undefined){r.invalidPath=false}else if(n.getProperty(p)!==undefined){r.invalidPath=false;d=p}}}r.absolutePath=typeof d==="undefined"?"Unresolvable":d;r.isRelative=a.isRelative();r.model=o.getBindingModelInfo(a,i)}s.push(r)});e.bindings.push({name:a,type:n.binding?n.binding.getMetadata().getName():undefined,bindings:s})}}function u(t,e){var i={modelName:e==="undefined"?"none (default)":e,path:t.getPath()};if(t.getModel().isA("sap.ui.model.odata.v4.ODataModel")){i.unverifiedPath=true}else{if(!t.getObject()==null){i.invalidPath=true}}return i}var g=i.oBindingContexts;for(var h in g){if(g.hasOwnProperty(h)){e.contexts.push(u(g[h],h))}}var g=i.oPropagatedProperties.oBindingContexts;for(var h in g){if(g.hasOwnProperty(h)&&!i.oBindingContexts[h]){var f=u(g[h],h);var b=i;do{if(b.oBindingContexts[h]==g[h]){f.location={id:b.getId(),name:b.getMetadata().getName()};break}}while(b=b.getParent());e.contexts.push(f)}}return e};b.prototype.getBindingModelInfo=function(t,e){var i={};var r=t.getModel();function o(t){for(var e in t){if(t.hasOwnProperty(e)){if(t[e]===r){return e}}}return null}i.name=o(e.oModels)||o(e.oPropagatedProperties.oModels);if(i.name){var a=e;do{if(a.oModels[i.name]===r){i.location={type:"control",id:a.getId(),name:a.getMetadata().getName()};break}}while(a=a.getParent());if(!i.location){var n=null;if(i.name==="undefined"){n=this.oCore.getModel()}else{n=this.oCore.getModel(i.name)}if(n){i.location={type:"core"}}}}i.type=r.getMetadata().getName();i.bindingMode=r.getDefaultBindingMode();i.name=i.name==="undefined"?"none (default)":i.name;return i};b.prototype.refreshBinding=function(t,e){var i=this.oCore.byId(t);var r=i.mBindingInfos[e];if(!i||!r){return}var o=r.binding;if(!o){return}if(o instanceof c){var a=o.getBindings();for(var n=0;n<a.length;n++){a[n].refresh()}}else{o.refresh()}};return b});