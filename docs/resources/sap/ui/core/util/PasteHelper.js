/*!
 * OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/Core","sap/ui/model/ParseException","sap/ui/model/ValidateException","sap/base/Log"],function(e,r,n,a){"use strict";var t={};t.getPastedDataAs2DArray=function(e){var r=e.clipboardData;if(!r){r=window.clipboardData}var n=/sapui5Placeholder4MultiLine/g;var a=n.source;var t=/""/g;var i,o,s,l=[];if(r){i=r.getData("Text");var p=[];var u=false;var f=i.indexOf('"'),c=-1;var h,v;while(f>-1){v=i.charAt(f-1);if(f===0||v==="\n"||v==="\t"||v==="\r"){c=i.indexOf('"',f+1);if(c>-1){h=i.charAt(c+1);while(c>-1&&h==='"'){c=i.indexOf('"',c+2);h=i.charAt(c+1)}if(h==="\n"||h==="\t"||h===""||h==="\r"){var g=i.substring(f+1,c);i=i.replace('"'+g+'"',a);g=g.replace(t,'"');p.push(g);f=i.indexOf('"',f+a.length+1);u=true}}}if(!u){f=i.indexOf('"',f+1)}u=false}o=i.split(/\r\n|\r|\n/);var m=0;var d=function(){return p[m++]};for(var y=0;y<o.length;y++){s=o[y];if(p.length>0){s=s.replace(n,d)}if(s.length||y<o.length-1){l.push(s.split("\t"))}}}return l};t.parse=function(r,n){var a={parsedData:null,errors:null};if(!r){throw new Error("Parameter aData is not specified")}if(n){for(var i=0;i<n.length;i++){var o=n[i];if(o.ignore){continue}if(o.property){if(o.type){var s=o.type;if(s.isA&&s.isA("sap.ui.model.SimpleType")){o.typeInstance=s}else{throw new Error("Data type "+o.type+" is not an instance of any data type")}}else if(o.customParseFunction==undefined){throw new Error("Missing ColumnInfo.type or custom type parse function for column "+(i+1)+". Check the application calling PasteHelper.parse(aData, aColumnInfo) and specify the missing type in the parameter aColumnInfo.")}}else{throw new Error("Missing ColumnInfo.property for column "+(i+1)+". Check the application calling PasteHelper.parse(aData, aColumnInfo) and specify the missing property in the parameter aColumnInfo.")}}}else{throw new Error("Missing parameter aColumnInfo")}var l=[],p=[],u=e.getLibraryResourceBundle();var f=function(e,r){return r.parseValue(e,"string")};var c=function(e,r){return r.validateValue(e)};for(var i=0;i<r.length;i++){var h=r[i];var v=t._parseRow(h,n,i,f,c,u,l);p.push(v)}return Promise.all(p).then(function(e){if(l.length>0){a.parsedData=null;a.errors=l}else{if(e){a.parsedData=e}a.errors=null}return a})};t._parseRow=function(e,r,n,a,i,o,s){var l=[],p={};for(var u=0;u<r.length&&u<e.length;u++){var f=r[u];if(f.ignore){continue}var c=e[u];if(!f.typeInstance){a=f.customParseFunction;i=function(){}}var h=t._parseCell(u,c,f,n,a,i,o,p,s);l.push(h)}return Promise.all(l).then(function(){return p})};t._parseCell=function(e,t,i,o,s,l,p,u,f){return Promise.resolve(t).then(function(e){return s(e,i.typeInstance)}).then(function(e){return Promise.all([e,l(e,i.typeInstance)])}).then(function(e){u[i.property]=e[0]}).catch(function(s){if(s instanceof r||s instanceof n){var l={row:o+1,column:e+1,property:i.property,value:t,type:i.type,message:p.getText("PasteHelper.ErrorMessage",[t,o+1,e+1])+" "+s.message+"\n"};f.push(l);t=null}else{a.error(s)}})};return t});