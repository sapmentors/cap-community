/*!
 * OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/Control","sap/ui/core/DeclarativeSupport","sap/ui/core/library","sap/ui/core/UIArea","./DOMElement","./Template","./TemplateControlRenderer","sap/base/strings/capitalize","sap/base/strings/hyphenate","sap/base/Log","sap/ui/thirdparty/jquery"],function(t,e,n,i,r,o,a,p,s,l,c){"use strict";var d=t.extend("sap.ui.core.tmpl.TemplateControl",{metadata:{library:"sap.ui.core",properties:{context:{type:"object",group:"Data",defaultValue:null}},aggregations:{controls:{type:"sap.ui.core.Control",multiple:true,singularName:"control",visibility:"hidden"}},associations:{template:{type:"sap.ui.core.tmpl.Template",multiple:false}},events:{afterRendering:{},beforeRendering:{}}}});d.prototype.init=function(){this._aBindingInfos=[]};d.prototype.isInline=function(){var t=false,e=this.getParent();if(e instanceof i&&c(e.getRootNode()).attr("id")===this.getId()){t=true}return t};d.prototype.placeAt=function(e,n){var i=this.isInline();var r=this.$(),o=this.getUIArea();t.prototype.placeAt.apply(this,arguments);if(i&&r.length===1){r.remove();o.destroyContent()}};d.prototype.getTemplateRenderer=function(){return this.fnRenderer};d.prototype.setTemplateRenderer=function(t){this.fnRenderer=t;return this};d.prototype._cleanup=function(){this.destroyAggregation("controls");this._aBindingInfos.forEach(function(t){var e=t.binding;if(e){e.detachChange(t.changeHandler);e.destroy()}});this._aBindingInfos=[]};d.prototype._compile=function(){var t=sap.ui.getCore().byId(this.getTemplate()),n=t&&t.getDeclarativeSupport();if(n){var i=this;setTimeout(function(){e.compile(i.getDomRef())})}};d.prototype.exit=function(){this._cleanup()};d.prototype.onBeforeRendering=function(){this.fireBeforeRendering();this._cleanup()};d.prototype.onAfterRendering=function(){this.fireAfterRendering()};d.prototype.clone=function(){var e=t.prototype.clone.apply(this,arguments);e.fnRenderer=this.fnRenderer;return e};d.prototype.updateBindings=function(e,n){t.prototype.updateBindings.apply(this,arguments);if(this.getDomRef()){this.invalidate()}};d.prototype.bind=function(t,e){var n=o.parsePath(t),i=this.getModel(n.model),t=n.path,r=e?"bind"+p(e):"bindProperty",a=i&&i[r](t),s={binding:a,path:n.path,model:n.model};if(a){s.changeHandler=function(){l.debug("TemplateControl#"+this.getId()+": "+e+' binding changed for path "'+t+'"');this.invalidate()}.bind(this);a.attachChange(s.changeHandler)}this._aBindingInfos.push(s);return a};d.prototype.calculatePath=function(t,e){var n=this.getBindingContext(),i=n&&n.getPath();if(t&&i&&!t.startsWith("/")){if(!i.endsWith("/")){i+="/"}t=i+t}return t};d.prototype.bindProp=function(t){var e=this.bind(this.calculatePath(t),"property");return e&&e.getExternalValue()};d.prototype.bindList=function(t){var e=this.bind(this.calculatePath(t),"list"),n=e&&e.getModel(),t=e&&e.getPath();return e&&n.getProperty(t)};d.prototype.createDOMElement=function(t,e,n){var i=new r(t);if(e){i.bindObject(e)}if(!n){this.addAggregation("controls",i)}return i};d.prototype.createControl=function(t,n,i,r){var o={};c.each(t,function(t,e){o["data-"+s(t)]=e});var a=c("<div/>",o);var p=e._createControl(a.get(0),r);if(n){p.bindObject(n)}if(!i){this.addAggregation("controls",p)}return p};return d});