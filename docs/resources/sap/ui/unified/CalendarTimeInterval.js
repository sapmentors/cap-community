/*!
 * OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/Control","sap/ui/core/LocaleData","sap/ui/unified/calendar/CalendarUtils","./calendar/Header","./calendar/TimesRow","./calendar/DatesRow","./calendar/MonthPicker","./calendar/YearPicker","sap/ui/core/date/UniversalDate","./library","sap/ui/core/format/DateFormat","sap/ui/Device","sap/ui/core/Locale","sap/ui/core/library","./CalendarTimeIntervalRenderer","sap/ui/dom/containsOrEquals","sap/base/util/deepEqual","sap/ui/core/Popup","sap/base/Log","sap/ui/thirdparty/jquery","sap/ui/unified/DateRange","sap/ui/unified/Calendar"],function(e,t,a,i,s,o,r,n,g,h,l,c,u,D,d,f,_,p,v,m,T,C){"use strict";var M=e.extend("sap.ui.unified.CalendarTimeInterval",{metadata:{library:"sap.ui.unified",properties:{width:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:null},startDate:{type:"object",group:"Data"},intervalSelection:{type:"boolean",group:"Behavior",defaultValue:false},singleSelection:{type:"boolean",group:"Behavior",defaultValue:true},items:{type:"int",group:"Appearance",defaultValue:12},intervalMinutes:{type:"int",group:"Appearance",defaultValue:60},pickerPopup:{type:"boolean",group:"Appearance",defaultValue:false},minDate:{type:"object",group:"Misc",defaultValue:null},maxDate:{type:"object",group:"Misc",defaultValue:null}},aggregations:{selectedDates:{type:"sap.ui.unified.DateRange",multiple:true,singularName:"selectedDate"},specialDates:{type:"sap.ui.unified.DateTypeRange",multiple:true,singularName:"specialDate"},header:{type:"sap.ui.unified.calendar.Header",multiple:false,visibility:"hidden"},timesRow:{type:"sap.ui.unified.calendar.TimesRow",multiple:false,visibility:"hidden"},datesRow:{type:"sap.ui.unified.calendar.Month",multiple:false,visibility:"hidden"},monthPicker:{type:"sap.ui.unified.calendar.MonthPicker",multiple:false,visibility:"hidden"},yearPicker:{type:"sap.ui.unified.calendar.YearPicker",multiple:false,visibility:"hidden"},calendarPicker:{type:"sap.ui.unified.Calendar",multiple:false,visibility:"hidden"}},associations:{ariaLabelledBy:{type:"sap.ui.core.Control",multiple:true,singularName:"ariaLabelledBy"},legend:{type:"sap.ui.unified.CalendarLegend",multiple:false}},events:{select:{},cancel:{},startDateChange:{}}}});M.prototype.init=function(){this._iMode=0;this._oYearFormat=l.getDateInstance({format:"y"});this.data("sap-ui-fastnavgroup","true",true);this._oMinDate=new g(new Date(Date.UTC(1,0,1)));this._oMinDate.getJSDate().setUTCFullYear(1);this._oMaxDate=new g(new Date(Date.UTC(9999,11,31,23,59,59)));this._initializeHeader();this._initializeTimesRow();this._initilizeMonthPicker();this._initilizeYearPicker();this.setPickerPopup(false);this._iItemsHead=15};M.prototype._initializeHeader=function(){var e=new i(this.getId()+"--Head");e.attachEvent("pressPrevious",this._handlePrevious,this);e.attachEvent("pressNext",this._handleNext,this);this.setAggregation("header",e)};M.prototype._initializeTimesRow=function(){var e=new s(this.getId()+"--TimesRow");e.attachEvent("focus",$,this);e.attachEvent("select",H,this);e._bNoThemeChange=true;this.setAggregation("timesRow",e)};M.prototype._initilizeMonthPicker=function(){this.setAggregation("monthPicker",this._createMonthPicker())};M.prototype._initilizeYearPicker=function(){this.setAggregation("yearPicker",this._createYearPicker())};M.prototype._createDatesRow=function(){var e=new o(this.getId()+"--DatesRow",{days:18,selectedDates:[new T(this.getId()+"--Range")]});e.attachEvent("focus",q,this);e.attachEvent("select",j,this);e._bNoThemeChange=true;e.getIntervalSelection=function(){return this.getProperty("intervalSelection")};e.getSingleSelection=function(){return this.getProperty("singleSelection")};e.getSelectedDates=function(){return this.getAggregation("selectedDates",[])};e.getSpecialDates=function(){return this.getAggregation("specialDates",[])};e.getAriaLabelledBy=function(){return this.getAssociation("ariaLabelledBy",[])};return e};M.prototype._createMonthPicker=function(){var e=new r(this.getId()+"--MP",{columns:0,months:6});e.attachEvent("select",G,this);e._bNoThemeChange=true;e.attachEvent("pageChange",ae,this);return e};M.prototype._createYearPicker=function(){var e=new n(this.getId()+"--YP",{columns:0,years:6});e.attachEvent("select",K,this);e.attachEvent("pageChange",ie,this);e._oMinDate.setYear(this._oMinDate.getUTCFullYear());e._oMaxDate.setYear(this._oMaxDate.getUTCFullYear());return e};M.prototype.exit=function(){if(this._sInvalidateContent){clearTimeout(this._sInvalidateContent)}};M.prototype.onBeforeRendering=function(){var e=this.getAggregation("timesRow");var t=this._getFocusedDate();S.call(this);e.displayDate(a._createLocalDate(t,true))};M.prototype._setAriaRole=function(e){var t=this.getAggregation("timesRow");t._setAriaRole(e);t.invalidate();return this};M.prototype._getCalendarPicker=function(){var e=this.getAggregation("calendarPicker");if(!e){e=new C(this.getId()+"--Cal",{});e.setPopupMode(true);e.attachEvent("select",z,this);e.attachEvent("cancel",function(e){this._oPopup.close();var t=this.getAggregation("header").getDomRef("B1");if(t){t.focus()}},this);this.setAggregation("calendarPicker",e)}return e};M.prototype.setStartDate=function(e){a._checkJSDateObject(e);if(_(this.getStartDate(),e)){return this}var t=e.getFullYear();a._checkYearInValidRange(t);var i=this.getMinDate();if(i&&e.getTime()<i.getTime()){v.warning("startDate < minDate -> minDate as startDate set",this);e=new Date(i)}var s=this.getMaxDate();if(s&&e.getTime()>s.getTime()){v.warning("startDate > maxDate -> maxDate as startDate set",this);e=new Date(s)}this.setProperty("startDate",e,true);var o=this.getAggregation("timesRow");o.setStartDate(e);this._oUTCStartDate=new g(o._getStartDate().getTime());S.call(this);var r=a._createLocalDate(this._getFocusedDate(),true);if(!o.checkDateFocusable(r)){this._setFocusedDate(this._oUTCStartDate);o.displayDate(e)}return this};M.prototype.invalidate=function(t){if(!this._bDateRangeChanged&&(!t||!(t instanceof T))){if(!t||!(t instanceof o||t instanceof r||t instanceof n||t instanceof i)){e.prototype.invalidate.apply(this,arguments)}}else if(this.getDomRef()&&this._iMode==0&&!this._sInvalidateContent){this._sInvalidateContent=setTimeout(Q.bind(this),0)}};M.prototype.removeAllSelectedDates=function(){this._bDateRangeChanged=true;var e=this.removeAllAggregation("selectedDates");return e};M.prototype.destroySelectedDates=function(){this._bDateRangeChanged=true;var e=this.destroyAggregation("selectedDates");return e};M.prototype.removeAllSpecialDates=function(){this._bDateRangeChanged=true;var e=this.removeAllAggregation("specialDates");return e};M.prototype.destroySpecialDates=function(){this._bDateRangeChanged=true;var e=this.destroyAggregation("specialDates");return e};M.prototype.setIntervalMinutes=function(e){if(e>=720){throw new Error("Only intervals < 720 minutes are allowed; "+this)}if(1440%e>0){throw new Error("A day must be divisible by the interval size; "+this)}this.setProperty("intervalMinutes",e,false);var t=this.getAggregation("timesRow");var i=a._createLocalDate(this._getFocusedDate(),true);if(!t.checkDateFocusable(i)){var s=P.call(this);this._setFocusedDate(s);t.setDate(a._createLocalDate(s,true))}return this};M.prototype.setLocale=function(e){if(this._sLocale!=e){this._sLocale=e;this._oLocaleData=undefined;this.invalidate()}return this};M.prototype.getLocale=function(){if(!this._sLocale){this._sLocale=sap.ui.getCore().getConfiguration().getFormatSettings().getFormatLocale().toString()}return this._sLocale};M.prototype._getFocusedDate=function(){if(!this._oFocusedDate){I.call(this)}return this._oFocusedDate};M.prototype._setFocusedDate=function(e){if(!(e instanceof g)){throw new Error("Date must be a UniversalDate object "+this)}this._oFocusedDate=new g(e.getTime())};M.prototype.focusDate=function(e){var t=false;var i=this.getAggregation("timesRow");if(!i.checkDateFocusable(e)){var s=a._createUniversalUTCDate(e,undefined,true);W.call(this,s);t=true}E.call(this,e,false);if(t){this.fireStartDateChange()}return this};M.prototype.displayDate=function(e){E.call(this,e,true);return this};M.prototype.setItems=function(e){this.setProperty("items",e,true);e=this._getItems();var t=this.getAggregation("timesRow");t.setItems(e);var i=a._createLocalDate(this._getFocusedDate(),true);if(!t.checkDateFocusable(i)){var s=P.call(this);this._setFocusedDate(s);t.setDate(a._createLocalDate(s,true))}if(!this.getPickerPopup()){var o=this.getAggregation("datesRow");var r=Math.floor(e*1.5);if(r>31){r=31}o.setDays(r);var n=this.getAggregation("monthPicker");var g=Math.floor(e/2);if(g>12){g=12}n.setMonths(g);var h=this.getAggregation("yearPicker");var l=Math.floor(e/2);if(l>20){l=20}h.setYears(l)}S.call(this);if(this.getDomRef()){if(this._getShowItemHeader()){this.$().addClass("sapUiCalIntHead")}else{this.$().removeClass("sapUiCalIntHead")}}return this};M.prototype._getItems=function(){var e=this.getItems();if(c.system.phone&&e>6){return 6}else{return e}};M.prototype._getLocaleData=function(){if(!this._oLocaleData){var e=this.getLocale();var a=new u(e);this._oLocaleData=t.getInstance(a)}return this._oLocaleData};M.prototype.setPickerPopup=function(e){var t=this.getAggregation("header"),a,i,s;this.setProperty("pickerPopup",e,true);if(a){a.destroy()}if(e){t.setVisibleButton0(false);t.setVisibleButton1(true);t.setVisibleButton2(false);t.detachEvent("pressButton1",O,this);t.attachEvent("pressButton1",O,this);if(this.getAggregation("datesRow")){this.getAggregation("datesRow").destroy()}if(this.getAggregation("monthPicker")){this.getAggregation("monthPicker").destroy()}if(this.getAggregation("yearPicker")){this.getAggregation("yearPicker").destroy()}}else{t.setVisibleButton0(true);t.setVisibleButton1(true);t.setVisibleButton2(true);t.detachEvent("pressButton0",J,this);t.attachEvent("pressButton0",J,this);t.detachEvent("pressButton1",O,this);t.attachEvent("pressButton1",O,this);t.detachEvent("pressButton2",V,this);t.attachEvent("pressButton2",V,this);if(!this.getAggregation("datesRow")){this.setAggregation("datesRow",this._createDatesRow())}if(!this.getAggregation("yearPicker")){this.setAggregation("yearPicker",this._createYearPicker())}if(!this.getAggregation("monthPicker")){this.setAggregation("monthPicker",this._createMonthPicker())}i=this.getAggregation("monthPicker");s=this.getAggregation("yearPicker");i.setColumns(0);i.setMonths(6);s.setColumns(0);s.setYears(6)}return this};M.prototype.setMinDate=function(e){var t,i,s,o;if(_(e,this.getMinDate())){return this}if(!e){a._updateUTCDate(this._oMinDate.getJSDate(),1,0,1,0,0,0,0)}else{a._checkJSDateObject(e);this._oMinDate=a._createUniversalUTCDate(e,undefined,true);t=this.getAggregation("timesRow");this._oMinDate=t._getIntervalStart(this._oMinDate);i=this._oMinDate.getUTCFullYear();a._checkYearInValidRange(i);if(this._oMaxDate.getTime()<this._oMinDate.getTime()){v.warning("minDate > maxDate -> maxDate set to end of the month",this);this._oMaxDate=a._createUniversalUTCDate(e,undefined,true);a._updateUTCDate(this._oMaxDate,null,this._oMaxDate.getUTCMonth()+1,0,23,59,59,0);this.setProperty("maxDate",a._createLocalDate(this._oMaxDate,true),true)}if(this._oFocusedDate){if(this._oFocusedDate.getTime()<this._oMinDate.getTime()){v.warning("focused date < minDate -> minDate focused",this);this.focusDate(e)}}if(this._oUTCStartDate&&this._oUTCStartDate.getTime()<this._oMinDate.getTime()){v.warning("start date < minDate -> minDate set as start date",this);U.call(this,new g(this._oMinDate.getTime()),true,true)}}this.setProperty("minDate",e,false);if(this.getPickerPopup()){o=this._getCalendarPicker();o.setMinDate(e)}else{s=this.getAggregation("yearPicker");s._oMinDate.setYear(this._oMinDate.getUTCFullYear())}return this};M.prototype.setMaxDate=function(e){var t,i,s,o,r,n;if(_(e,this.getMaxDate())){return this}if(!e){a._updateUTCDate(this._oMaxDate.getJSDate(),9999,11,31,23,59,59,0)}else{a._checkJSDateObject(e);this._oMaxDate=a._createUniversalUTCDate(e,undefined,true);t=this.getAggregation("timesRow");this._oMaxDate=t._getIntervalStart(this._oMaxDate);this._oMaxDate.setUTCMinutes(this._oMaxDate.getUTCMinutes()+this.getIntervalMinutes());this._oMaxDate.setUTCMilliseconds(-1);i=this._oMaxDate.getUTCFullYear();a._checkYearInValidRange(i);if(this._oMinDate.getTime()>this._oMaxDate.getTime()){v.warning("maxDate < minDate -> minDate set to begin of the month",this);this._oMinDate=a._createUniversalUTCDate(e,undefined,true);a._updateUTCDate(this._oMinDate,null,null,1,0,0,0,0);this.setProperty("minDate",a._createLocalDate(this._oMinDate,true),true)}if(this._oFocusedDate){if(this._oFocusedDate.getTime()>this._oMaxDate.getTime()){v.warning("focused date > maxDate -> maxDate focused",this);this.focusDate(e)}}if(this._oUTCStartDate){s=new g(this._oUTCStartDate.getTime());s.setUTCMinutes(s.getUTCMinutes()+this.getIntervalMinutes()*(this._getItems()-1));if(s.getTime()>this._oMaxDate.getTime()){o=new g(this._oMaxDate.getTime());o.setUTCMinutes(o.getUTCMinutes()-this.getIntervalMinutes()*(this._getItems()-1));if(o.getTime()>=this._oMinDate.getTime()){v.warning("end date > maxDate -> maxDate set as end date",this);U.call(this,o,true,true)}}}}this.setProperty("maxDate",e,false);if(this.getPickerPopup()){n=this._getCalendarPicker();n.setMaxDate(e)}else{r=this.getAggregation("yearPicker");r._oMaxDate.setYear(this._oMaxDate.getUTCFullYear())}return this};M.prototype.onclick=function(e){if(e.isMarked("delayedMouseEvent")){return}if(e.target.id==this.getId()+"-cancel"){this.onsapescape(e)}};M.prototype.onmousedown=function(e){e.preventDefault();e.setMark("cancelAutoClose")};M.prototype.onsapescape=function(e){if(this.getPickerPopup()){k.call(this);this.fireCancel()}else{switch(this._iMode){case 0:this.fireCancel();break;case 1:b.call(this);break;case 2:x.call(this);break;case 3:A.call(this);break}}};M.prototype.onsaptabnext=function(e){var t=this.getAggregation("header"),a,i,s;if(f(this.getDomRef("content"),e.target)){if(this.getPickerPopup()&&t.getDomRef("B1")){t.getDomRef("B1").focus()}else if(!this.getPickerPopup()&&t.getDomRef("B0")){t.getDomRef("B0").focus()}if(!this._bPoupupMode){s=this.getAggregation("timesRow");m(s._oItemNavigation.getItemDomRefs()[s._oItemNavigation.getFocusedIndex()]).attr("tabindex","-1");if(!this.getPickerPopup()){a=this.getAggregation("monthPicker");i=this.getAggregation("yearPicker");if(a.getDomRef()){m(a._oItemNavigation.getItemDomRefs()[a._oItemNavigation.getFocusedIndex()]).attr("tabindex","-1")}if(i.getDomRef()){m(i._oItemNavigation.getItemDomRefs()[i._oItemNavigation.getFocusedIndex()]).attr("tabindex","-1")}}}e.preventDefault()}else if(e.target.id==t.getId()+"-B0"){if(t.getDomRef("B1")){t.getDomRef("B1").focus()}e.preventDefault()}else if(!this.getPickerPopup()&&e.target.id==t.getId()+"-B1"){if(t.getDomRef("B2")){t.getDomRef("B2").focus()}e.preventDefault()}};M.prototype.onsaptabprevious=function(e){var t=this.getAggregation("header"),a,i,s;if(f(this.getDomRef("content"),e.target)){if(this._bPoupupMode){if(t.getDomRef("B2")){t.getDomRef("B2").focus()}e.preventDefault()}}else if(e.target.id==t.getId()+"-B0"){s=this.getAggregation("timesRow");switch(this._iMode){case 0:s._oItemNavigation.focusItem(s._oItemNavigation.getFocusedIndex());break;case 2:if(!this.getPickerPopup()){a=this.getAggregation("monthPicker");a._oItemNavigation.focusItem(a._oItemNavigation.getFocusedIndex())}break;case 3:if(!this.getPickerPopup()){i=this.getAggregation("yearPicker");i._oItemNavigation.focusItem(i._oItemNavigation.getFocusedIndex())}break}e.preventDefault()}else if(e.target.id==t.getId()+"-B2"){if(t.getDomRef("B1")){t.getDomRef("B1").focus()}e.preventDefault()}else if(e.target.id==t.getId()+"-B1"){if(!this.getPickerPopup()){if(t.getDomRef("B0")){t.getDomRef("B0").focus()}}else{s=this.getAggregation("timesRow");s._oItemNavigation.focusItem(s._oItemNavigation.getFocusedIndex())}e.preventDefault()}};M.prototype.onfocusin=function(e){if(e.target.id==this.getId()+"-end"){var t=this.getAggregation("header"),a,i,s;if(this.getPickerPopup()&&t.getDomRef("B1")){t.getDomRef("B1").focus()}else if(!this.getPickerPopup()&&t.getDomRef("B2")){t.getDomRef("B2").focus()}if(!this._bPoupupMode){a=this.getAggregation("timesRow");m(a._oItemNavigation.getItemDomRefs()[a._oItemNavigation.getFocusedIndex()]).attr("tabindex","-1");if(!this.getPickerPopup()){i=this.getAggregation("monthPicker");s=this.getAggregation("yearPicker");if(i.getDomRef()){m(i._oItemNavigation.getItemDomRefs()[i._oItemNavigation.getFocusedIndex()]).attr("tabindex","-1")}if(s.getDomRef()){m(s._oItemNavigation.getItemDomRefs()[s._oItemNavigation.getFocusedIndex()]).attr("tabindex","-1")}}}}this.$("end").attr("tabindex","-1")};M.prototype.onsapfocusleave=function(e){if(!e.relatedControlId||!f(this.getDomRef(),sap.ui.getCore().byId(e.relatedControlId).getFocusDomRef())){this.$("end").attr("tabindex","0");if(!this._bPoupupMode){var t,a,i;switch(this._iMode){case 0:t=this.getAggregation("timesRow");m(t._oItemNavigation.getItemDomRefs()[t._oItemNavigation.getFocusedIndex()]).attr("tabindex","0");break;case 2:if(!this.getPickerPopup()){a=this.getAggregation("monthPicker");m(a._oItemNavigation.getItemDomRefs()[a._oItemNavigation.getFocusedIndex()]).attr("tabindex","0")}break;case 3:if(!this.getPickerPopup()){i=this.getAggregation("yearPicker");m(i._oItemNavigation.getItemDomRefs()[i._oItemNavigation.getFocusedIndex()]).attr("tabindex","0")}break}}}};M.prototype._handlePrevious=function(e){var t=this._getFocusedDate(),i,s,o,r,n,h,l,c;switch(this._iMode){case 0:i=this._getItems();s=new g(P.call(this).getTime());o=this.getIntervalMinutes();s.setUTCMinutes(s.getUTCMinutes()-i*o);t.setUTCMinutes(t.getUTCMinutes()-i*o);this._setFocusedDate(t);U.call(this,s,true);break;case 1:if(!this.getPickerPopup()){r=this.getAggregation("datesRow");n=a._createUniversalUTCDate(r.getDate());h=r.getDays();if(n.getUTCDate()<=h){n.setUTCDate(1)}else{n.setUTCDate(n.getUTCDate()-h)}X.call(this,n)}break;case 2:if(!this.getPickerPopup()){l=this.getAggregation("monthPicker");if(l.getMonths()<12){l.previousPage();N.call(this)}else{t.setUTCFullYear(t.getUTCFullYear()-1);W.call(this,t);this._setFocusedDate(t);S.call(this);te.call(this,t.getUTCFullYear(),l);this.fireStartDateChange()}}break;case 3:if(!this.getPickerPopup()){c=this.getAggregation("yearPicker");c.previousPage();Y.call(this)}break}};M.prototype._handleNext=function(e){var t=this._getFocusedDate();switch(this._iMode){case 0:var i=this._getItems();var s=new g(P.call(this).getTime());var o=this.getIntervalMinutes();s.setUTCMinutes(s.getUTCMinutes()+i*o);t.setUTCMinutes(t.getUTCMinutes()+i*o);this._setFocusedDate(t);U.call(this,s,true);break;case 1:if(!this.getPickerPopup()){var r=this.getAggregation("datesRow");var n=a._createUniversalUTCDate(r.getDate());var h=new g(n.getTime());h.setUTCDate(1);h.setUTCMonth(h.getUTCMonth()+1);h.setUTCDate(0);var l=r.getDays();if(n.getUTCDate()+l>h.getUTCDate()){n.setUTCDate(h.getUTCDate())}else{n.setUTCDate(n.getUTCDate()+l)}X.call(this,n)}break;case 2:if(!this.getPickerPopup()){var c=this.getAggregation("monthPicker");if(c.getMonths()<12){c.nextPage();N.call(this)}else{t.setUTCFullYear(t.getUTCFullYear()+1);W.call(this,t);this._setFocusedDate(t);S.call(this);te.call(this,t.getUTCFullYear(),c);this.fireStartDateChange()}}break;case 3:if(!this.getPickerPopup()){var u=this.getAggregation("yearPicker");u.nextPage();Y.call(this)}break}};M.prototype._getShowItemHeader=function(){var e=this.getItems();if(e>this._iItemsHead){return true}else{return false}};function U(e,t,i){var s=new g(this._oMaxDate.getTime());s.setUTCMinutes(s.getUTCMinutes()-this.getIntervalMinutes()*(this._getItems()-1));if(s.getTime()<this._oMinDate.getTime()){s=new g(this._oMinDate.getTime());s.setUTCMinutes(s.getUTCMinutes()+this.getIntervalMinutes()*(this._getItems()-1))}if(e.getTime()<this._oMinDate.getTime()){e=new g(this._oMinDate.getTime())}else if(e.getTime()>s.getTime()){e=s}var o=this.getAggregation("timesRow");var r=a._createLocalDate(e,true);o.setStartDate(r);this._oUTCStartDate=new g(o._getStartDate().getTime());r=a._createLocalDate(this._oUTCStartDate,true);this.setProperty("startDate",r,true);S.call(this);if(t){var n=a._createLocalDate(this._getFocusedDate(),true);if(!o.checkDateFocusable(n)){this._setFocusedDate(e);o.setDate(r)}else{o.setDate(n)}}if(!i){this.fireStartDateChange()}}function P(){if(!this._oUTCStartDate){var e=this.getAggregation("timesRow");e.setStartDate(a._createLocalDate(this._getFocusedDate(),true));this._oUTCStartDate=new g(e._getStartDate().getTime());this._setFocusedDate(this._oUTCStartDate)}return this._oUTCStartDate}function y(e){var t=this._getFocusedDate();var i=this.getAggregation("timesRow");if(!e){i.setDate(a._createLocalDate(t,true))}else{i.displayDate(a._createLocalDate(t,true))}S.call(this)}function I(){var e=this.getSelectedDates();if(e&&e[0]&&e[0].getStartDate()){this._oFocusedDate=a._createUniversalUTCDate(e[0].getStartDate(),undefined,true)}else{var t=new Date;this._oFocusedDate=a._createUniversalUTCDate(t,undefined,true)}if(this._oFocusedDate.getTime()<this._oMinDate.getTime()){this._oFocusedDate=new g(this._oMinDate.getTime())}else if(this._oFocusedDate.getTime()>this._oMaxDate.getTime()){this._oFocusedDate=new g(this._oMaxDate.getTime())}}M.prototype._showCalendarPicker=function(){var e=a._createLocalDate(this._getFocusedDate(),true);var t=this._getCalendarPicker();var i=new T({startDate:e});t.displayDate(e,false);t.removeAllSelectedDates();t.addSelectedDate(i);t.setMinDate(this.getMinDate());t.setMaxDate(this.getMaxDate());Z.call(this,t);this._showOverlay()};M.prototype._showOverlay=function(){this.$("contentOver").css("display","")};M.prototype._hideOverlay=function(){this.$("contentOver").css("display","none")};function k(e){if(this._oPopup&&this._oPopup.isOpen()){this._oPopup.close()}this._hideOverlay();if(!e){y.call(this);var t=this.getAggregation("timesRow");m(t._oItemNavigation.getItemDomRefs()[t._oItemNavigation.getFocusedIndex()]).attr("tabindex","0")}this.getAggregation("calendarPicker")._closedPickers()}function w(){if(this._iMode==3){A.call(this,true)}else if(this._iMode==2){x.call(this,true)}var e=this._getFocusedDate();var t=this._getItems();var i=this.getAggregation("datesRow");var s=i.getSelectedDates()[0];s.setStartDate(a._createLocalDate(e,true));var o=new g(e.getTime());o.setUTCDate(1);o.setUTCMonth(o.getUTCMonth()+1);o.setUTCDate(0);var r=o.getUTCDate();var n=Math.floor(t*1.5);if(n>r){n=r}i.setDays(n);if(i.getDomRef()){i.$().css("display","")}else{var h=sap.ui.getCore().createRenderManager();var l=this.$("content");h.renderControl(i);h.flush(l[0],false,true);h.destroy()}this._showOverlay();X.call(this,e);if(this._iMode==0){var c=this.getAggregation("timesRow");m(c._oItemNavigation.getItemDomRefs()[c._oItemNavigation.getFocusedIndex()]).attr("tabindex","-1")}this._iMode=1}function b(e){this._iMode=0;var t=this.getAggregation("datesRow");t.$().css("display","none");this._hideOverlay();if(!e){y.call(this);var a=this.getAggregation("timesRow");m(a._oItemNavigation.getItemDomRefs()[a._oItemNavigation.getFocusedIndex()]).attr("tabindex","0")}}function R(){if(this._iMode==1){b.call(this,true)}else if(this._iMode==3){A.call(this,true)}var e=this._getFocusedDate();var t=this.getAggregation("monthPicker");if(t.getDomRef()){t.$().css("display","")}else{var a=sap.ui.getCore().createRenderManager();var i=this.$("content");a.renderControl(t);a.flush(i[0],false,true);a.destroy()}this._showOverlay();t.setMonth(e.getUTCMonth());te.call(this,e.getUTCFullYear(),t);if(this._iMode==0){var s=this.getAggregation("timesRow");m(s._oItemNavigation.getItemDomRefs()[s._oItemNavigation.getFocusedIndex()]).attr("tabindex","-1")}this._iMode=2;N.call(this)}function x(e){this._iMode=0;var t=this.getAggregation("monthPicker");t.$().css("display","none");this._hideOverlay();if(!e){y.call(this);var a=this.getAggregation("timesRow");m(a._oItemNavigation.getItemDomRefs()[a._oItemNavigation.getFocusedIndex()]).attr("tabindex","0")}}function F(){if(this._iMode==1){b.call(this,true)}else if(this._iMode==2){x.call(this,true)}var e=this._getFocusedDate();var t=this.getAggregation("yearPicker");if(t.getDomRef()){t.$().css("display","")}else{var a=sap.ui.getCore().createRenderManager();var i=this.$("content");a.renderControl(t);a.flush(i[0],false,true);a.destroy()}this._showOverlay();t.setDate(e.getJSDate());if(this._iMode==0){var s=this.getAggregation("timesRow");m(s._oItemNavigation.getItemDomRefs()[s._oItemNavigation.getFocusedIndex()]).attr("tabindex","-1")}Y.call(this);this._iMode=3}function A(e){this._iMode=0;var t=this.getAggregation("yearPicker");t.$().css("display","none");this._hideOverlay();if(!e){y.call(this);var a=this.getAggregation("timesRow");m(a._oItemNavigation.getItemDomRefs()[a._oItemNavigation.getFocusedIndex()]).attr("tabindex","0")}}function S(){L.call(this);N.call(this,true)}function N(e){var t=new g(P.call(this).getTime());var a=this._getItems();var i=t.getJSDate().getUTCFullYear();var s=this._oMaxDate.getJSDate().getUTCFullYear();var o=this._oMinDate.getJSDate().getUTCFullYear();var r=t.getJSDate().getUTCMonth();var n=this._oMaxDate.getJSDate().getUTCMonth();var h=this._oMinDate.getJSDate().getUTCMonth();var l=t.getJSDate().getUTCDate();var c=this._oMaxDate.getJSDate().getUTCDate();var u=this._oMinDate.getJSDate().getUTCDate();var D=t.getJSDate().getUTCHours();var d=this._oMaxDate.getJSDate().getUTCHours();var f=this._oMinDate.getJSDate().getUTCHours();var _=t.getJSDate().getUTCMinutes();var p=this._oMaxDate.getJSDate().getUTCMinutes();var v=this._oMinDate.getJSDate().getUTCMinutes();var m=this.getAggregation("header");if(this._iMode==2&&!e){var T=this.getAggregation("monthPicker");var C=T.getMonths();var M=T.getStartMonth();var U=M+C-1;if(M==0||i==o&&M<=h){m.setEnabledPrevious(false)}else{m.setEnabledPrevious(true)}if(U>10||i==s&&U>=n){m.setEnabledNext(false)}else{m.setEnabledNext(true)}return}if(i<o||i==o&&(!e||(r<h||r==h&&(l<u||l==u&&(D<f||D==f&&_<=v))))||(this._iMode==1||this._iMode==2)&&this.getPickerPopup()){m.setEnabledPrevious(false)}else{m.setEnabledPrevious(true)}t.setUTCMinutes(t.getUTCMinutes()+a*this.getIntervalMinutes()-1);i=t.getJSDate().getUTCFullYear();r=t.getJSDate().getUTCMonth();l=t.getJSDate().getUTCDate();D=t.getJSDate().getUTCHours();_=t.getJSDate().getUTCMinutes();if(i>s||i==s&&(!e||(r>n||r==n&&(l>c||l==c&&(D>d||D==d&&_>=p))))||(this._iMode==1||this._iMode==2)&&this.getPickerPopup()){m.setEnabledNext(false)}else{m.setEnabledNext(true)}}function Y(){var e=this.getAggregation("yearPicker");var t=e.getYears();var i=a._createUniversalUTCDate(e.getFirstRenderedDate());i.setUTCFullYear(i.getUTCFullYear()+Math.floor(t/2));var s=this.getAggregation("header");var o=new g(this._oMaxDate);o.setUTCFullYear(o.getUTCFullYear()-Math.ceil(t/2));o.setUTCMonth(11,31);var r=new g(this._oMinDate);r.setUTCFullYear(r.getUTCFullYear()+Math.floor(t/2)+1);r.setUTCMonth(0,1);if(i.getTime()>o.getTime()){s.setEnabledNext(false)}else{s.setEnabledNext(true)}if(i.getTime()<r.getTime()){s.setEnabledPrevious(false)}else{s.setEnabledPrevious(true)}}function L(){var e=this.getAggregation("header");var t;var i=P.call(this);var s;var o=this._getLocaleData();var r=[];var n=[];var g;var h=false;var c;var u=false;if(o.oLocale.sLanguage.toLowerCase()==="ja"||o.oLocale.sLanguage.toLowerCase()==="zh"){c=l.getDateInstance({format:"d"}).format(i,true)}else{c=i.getUTCDate().toString()}if(this._bLongMonth||!this._bNamesLengthChecked){r=o.getMonthsStandAlone("wide")}else{h=true;r=o.getMonthsStandAlone("abbreviated");n=o.getMonthsStandAlone("wide")}var D=i.getUTCMonth();t=r[D];if(h){g=n[r[D]]}if(!this.getPickerPopup()){e.setTextButton0(c);e.setTextButton1(t);e.setTextButton2(this._oYearFormat.format(i,true))}else{s=l.getInstance({style:"long",strictParsing:true,relative:u},o.oLocale);g=c=s.format(a._createLocalDate(i,true));e.setTextButton1(c)}if(h){e.setAriaLabelButton1(g)}}function B(e,t){var a;var i=false;if(e.getTime()<this._oMinDate.getTime()){a=this._oMinDate;i=true}else if(e.getTime()>this._oMaxDate.getTime()){a=this._oMaxDate;i=true}else{a=e}this._setFocusedDate(a);if(i||t){W.call(this,a);y.call(this,false);this.fireStartDateChange()}}function E(e,t){if(e&&(!this._oFocusedDate||this._oFocusedDate.getTime()!=e.getTime())){a._checkJSDateObject(e);e=a._createUniversalUTCDate(e,undefined,true);var i=e.getUTCFullYear();a._checkYearInValidRange(i);if(e.getTime()<this._oMinDate.getTime()||e.getTime()>this._oMaxDate.getTime()){throw new Error("Date must not be in valid range (minDate and maxDate); "+this)}this._setFocusedDate(e);if(this.getDomRef()&&this._iMode==0){y.call(this,t)}}}function J(e){if(this._iMode!=1){w.call(this)}else{b.call(this)}}function O(e){if(this.getPickerPopup()){this._showCalendarPicker()}else{if(this._iMode!=2){R.call(this)}else{x.call(this)}}}function V(e){if(this._iMode!=3){F.call(this)}else{A.call(this)}}function H(e){this.fireSelect()}function $(e){var t=a._createUniversalUTCDate(e.getParameter("date"),undefined,true);var i=e.getParameter("notVisible");B.call(this,t,i)}function z(e){var t=e.getSource(),i=t.getSelectedDates()[0].getStartDate();var s=new g(this._getFocusedDate().getTime());var o=a._createUniversalUTCDate(i);s.setUTCFullYear(o.getUTCFullYear());s.setUTCMonth(o.getUTCMonth(),o.getUTCDate());B.call(this,s,true);k.call(this)}function j(e){var t=new g(this._getFocusedDate().getTime());var i=e.oSource;var s=i.getSelectedDates()[0];var o=a._createUniversalUTCDate(s.getStartDate());if(!this.getPickerPopup()||o.getUTCMonth()==t.getUTCMonth()){t.setUTCDate(o.getUTCDate());t.setUTCMonth(o.getUTCMonth());t.setUTCFullYear(o.getUTCFullYear());B.call(this,t,true);b.call(this)}}function q(e){var t=new g(this._getFocusedDate().getTime());var i=a._createUniversalUTCDate(e.getParameter("date"),undefined,true);var s=e.getParameter("otherMonth");if(s&&i.getUTCMonth()==t.getUTCMonth()&&i.getUTCFullYear()==t.getUTCFullYear()){X.call(this,i)}}function G(e){var t=new g(this._getFocusedDate().getTime());var a=this.getAggregation("monthPicker");var i=a.getMonth();t.setUTCMonth(i);if(i!=t.getUTCMonth()){t.setUTCDate(0)}B.call(this,t,true);x.call(this)}function K(e){var t=new g(this._getFocusedDate().getTime());var i=this.getAggregation("yearPicker");var s=a._createUniversalUTCDate(i.getDate());var o=t.getUTCMonth();s.setUTCMonth(t.getUTCMonth(),t.getUTCDate());s.setUTCHours(t.getUTCHours());s.setUTCMinutes(t.getUTCMinutes());t=s;if(o!=t.getUTCMonth()){t.setUTCDate(0)}B.call(this,t,true);A.call(this)}function Q(){this._sInvalidateContent=undefined;var e=this.getAggregation("timesRow");e._bDateRangeChanged=true;e._bInvalidateSync=true;e.invalidate();e._bInvalidateSync=undefined;this._bDateRangeChanged=undefined}function W(e){var t=this.getAggregation("timesRow");var a=P.call(this);var i=t._oItemNavigation.getFocusedIndex();a=new g(e.getTime());a.setUTCMinutes(a.getUTCMinutes()-i*this.getIntervalMinutes());U.call(this,a,false,true)}function X(e){var t=this.getAggregation("datesRow");var i=this.getAggregation("header");if(!this.getPickerPopup()){var s=new g(e.getTime());s.setUTCDate(1);s.setUTCMonth(s.getUTCMonth()+1);s.setUTCDate(0);var o=t.getDays();var r=new g(e.getTime());r.setUTCDate(1+(Math.ceil(e.getUTCDate()/o)-1)*o);if(s.getUTCDate()-r.getUTCDate()<o){r.setUTCDate(s.getUTCDate()-o+1)}t.setStartDate(a._createLocalDate(r,true));var n=r.getJSDate().getUTCFullYear();var h=this._oMaxDate.getJSDate().getUTCFullYear();var l=this._oMinDate.getJSDate().getUTCFullYear();var c=r.getJSDate().getUTCMonth();var u=this._oMaxDate.getJSDate().getUTCMonth();var D=this._oMinDate.getJSDate().getUTCMonth();var d=r.getJSDate().getUTCDate();var f=this._oMaxDate.getJSDate().getUTCDate();var _=this._oMinDate.getJSDate().getUTCDate();if(d<=1||n==l&&c==D&&d<=_){i.setEnabledPrevious(false)}else{i.setEnabledPrevious(true)}if(d+o>=s.getUTCDate()||n==h&&c==u&&d>=f){i.setEnabledNext(false)}else{i.setEnabledNext(true)}}else{i.setEnabledPrevious(false);i.setEnabledNext(false)}t.setDate(a._createLocalDate(e,true))}function Z(e){if(!this._oPopup){this._oPopup=new p;this._oPopup.setAutoClose(true);this._oPopup.setAutoCloseAreas([this.getDomRef()]);this._oPopup.setDurations(0,0);this._oPopup._oCalendar=this;this._oPopup.attachClosed(ee,this);this._oPopup.onsapescape=function(e){this._oCalendar.onsapescape(e)}}this._oPopup.setContent(e);var t=this.getAggregation("header");var a=p.Dock;this._oPopup.open(0,a.CenterTop,a.CenterTop,t,null,"flipfit",true)}function ee(e){k.call(this)}function te(e,t){var a=0;var i=11;if(e==this._oMinDate.getUTCFullYear()){a=this._oMinDate.getUTCMonth()}if(e==this._oMaxDate.getUTCFullYear()){i=this._oMaxDate.getUTCMonth()}t.setMinMax(a,i)}function ae(e){N.call(this)}function ie(e){Y.call(this)}return M});