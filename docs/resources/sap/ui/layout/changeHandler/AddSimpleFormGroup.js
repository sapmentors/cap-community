/*!
 * OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/fl/changeHandler/Base","sap/ui/fl/changeHandler/JsControlTreeModifier","sap/base/Log"],function(e,t,r){"use strict";var n={};n.CONTENT_AGGREGATION="content";var o=function(e,t,r){for(var n=0;n<r.length;n++){var o=e.getControlType(r[n]);if(t.indexOf(o)===-1){if(e.getVisible(r[n])){return true}}else{return false}}};var i=function(e,t,r,n){var i;var a=-1;if(n===0){return n}if(o(e,t,r)){a++}for(var l=0;l<r.length;l++){var u=e.getControlType(r[l]);if(t.indexOf(u)>-1){a++;if(a===n){i=r[l];return r.indexOf(i)}}}return r.length};n.applyChange=function(t,o,a){var l=a.modifier;var u=a.view;var f=a.appComponent,g;var p=t.getDefinition();if(p.texts&&p.texts.groupLabel&&p.texts.groupLabel.value&&p.content&&p.content.group&&(p.content.group.selector||p.content.group.id)){var c=p.content.group.selector;var s;if(c){if(c.idIsLocal){s=f.createId(c.id)}else{s=c.id}}else{s=p.content.group.id}t.setRevertData({groupId:s});var v=p.texts.groupLabel.value;var d=l.getAggregation(o,n.CONTENT_AGGREGATION);var C;var b;if(typeof p.content.group.index==="number"){C=p.content.group.index}else{b=p.content.group.relativeIndex;C=i(l,["sap.ui.core.Title","sap.m.Title","sap.m.Toolbar","sap.m.OverflowToolbar"],d,b)}if(l.bySelector(s,f)){return e.markAsNotApplicable("Control to be created already exists:"+s)}g=l.createControl("sap.ui.core.Title",f,u,s);l.setProperty(g,"text",v);l.insertAggregation(o,"content",g,C,u)}else{r.error("Change does not contain sufficient information to be applied: ["+p.layer+"]"+p.namespace+"/"+p.fileName+"."+p.fileType)}return true};n.completeChangeContent=function(r,n,o){var i=r.getDefinition();var a=o.appComponent;if(n.newLabel){e.setTextInChange(i,"groupLabel",n.newLabel,"XFLD")}else{throw new Error("oSpecificChangeInfo.newLabel attribute required")}if(!i.content){i.content={}}if(!i.content.group){i.content.group={}}if(n.newControlId){i.content.group.selector=t.getSelector(n.newControlId,a)}else{throw new Error("oSpecificChangeInfo.newControlId attribute required")}if(n.index===undefined){throw new Error("oSpecificChangeInfo.index attribute required")}else{i.content.group.relativeIndex=n.index}};n.getControlIdFromChangeContent=function(e){var t;if(e&&e._oDefinition){t=e._oDefinition.content.group.id}return t};n.revertChange=function(e,t,r){var o=r.appComponent;var i=r.view;var a=r.modifier;var l=e.getRevertData().groupId;var u=a.getSelector(l,o);var f=a.bySelector(u,o,i);a.removeAggregation(t,n.CONTENT_AGGREGATION,f);a.destroy(f);e.resetRevertData();return true};return n},true);