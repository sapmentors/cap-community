/*!
 * OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/fl/changeHandler/JsControlTreeModifier","sap/base/Log"],function(e,t){"use strict";var r={};var n=function(e,t){var r=t.getControlType(e);return r==="sap.ui.core.Title"||r==="sap.m.Title"||r==="sap.m.Toolbar"||r==="sap.m.OverflowToolbar"};var i=function(e,t){var r;for(r=0;r<e.length;++r){if(n(e[r],t)){return e[r]}}};r.applyChange=function(e,r,o){try{var a=o.modifier;var l=o.view;var g=o.appComponent;var s=e.getDefinition();var f=a.bySelector(s.content.elementSelector||s.content.sHideId,g,l);var m=a.getAggregation(r,"content");var c=-1;var v=this._getState(r,a,g);e.setRevertData(v);a.removeAllAggregation(r,"content");for(var u=0;u<m.length;++u){a.insertAggregation(r,"content",m[u],u,l)}if(s.changeType==="hideSimpleFormField"){m.some(function(e,t){if(e===f){c=t;a.setVisible(e,false)}if(c>=0&&t>c){if(a.getControlType(e)==="sap.m.Label"||a.getControlType(e)==="sap.ui.comp.smartfield.SmartLabel"||n(e,a)){return true}else{a.setVisible(e,false)}}})}else if(s.changeType==="removeSimpleFormGroup"){var p=i(m,a);var d=p&&!f;m.some(function(e,t){if(!p){a.setVisible(e,false)}else if(d){c=0;a.setVisible(e,false);d=false}else{if(e===f){c=t}if(c>=0&&t>c){if(n(e,a)){if(c===0){a.removeAggregation(r,"content",e,l);a.insertAggregation(r,"content",e,0,l)}return true}else{a.setVisible(e,false)}}}});if(f){a.removeAggregation(r,"content",f,l);a.insertAggregation(r,"dependents",f,0,l)}}return true}catch(r){e.resetRevertData();t.error(r.message||r.name)}};r._getStableElement=function(e){if(e.getMetadata().getName()==="sap.ui.layout.form.FormContainer"){return e.getTitle()||e.getToolbar()}else if(e.getMetadata().getName()==="sap.ui.layout.form.FormElement"){return e.getLabel()}else{return e}};r.completeChangeContent=function(t,r,n){var i=t.getDefinition();if(r.removedElement&&r.removedElement.id){var o=this._getStableElement(sap.ui.getCore().byId(r.removedElement.id));i.content.elementSelector=e.getSelector(o,n.appComponent);t.addDependentControl(o,"elementSelector",n)}else{throw new Error("oSpecificChangeInfo.removedElement.id attribute required")}};r._getState=function(e,t,r){var n=t.getAggregation(e,"content");return{content:n.map(function(e){return{elementSelector:t.getSelector(t.getId(e),r),visible:e.getVisible?e.getVisible():undefined,index:n.indexOf(e)}})}};r.revertChange=function(e,t,r){var n=e.getRevertData();var i=r.appComponent;var o=r.modifier;o.removeAllAggregation(t,"content");n.content.forEach(function(e){var n=o.bySelector(e.elementSelector,i,r.view);var a=o.getAggregation(t,"dependents");a.some(function(e){if(o.getProperty(e,"id")===o.getProperty(n,"id")){o.removeAggregation(t,"dependents",e,r.view);return true}});o.insertAggregation(t,"content",n,e.index,r.view);o.setProperty(n,"visible",e.visible)});e.resetRevertData();return true};return r},true);