/*!
 * OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/Device","sap/ui/core/ResizeHandler","sap/ui/layout/library","./FormLayout","./ColumnLayoutRenderer","sap/ui/thirdparty/jquery"],function(e,t,a,i,s,l){"use strict";var r=i.extend("sap.ui.layout.form.ColumnLayout",{metadata:{library:"sap.ui.layout",properties:{columnsXL:{type:"sap.ui.layout.form.ColumnsXL",group:"Appearance",defaultValue:2},columnsL:{type:"sap.ui.layout.form.ColumnsL",group:"Appearance",defaultValue:2},columnsM:{type:"sap.ui.layout.form.ColumnsM",group:"Appearance",defaultValue:1},labelCellsLarge:{type:"sap.ui.layout.form.ColumnCells",group:"Appearance",defaultValue:4},emptyCellsLarge:{type:"sap.ui.layout.form.EmptyCells",group:"Appearance",defaultValue:0}}}});r.prototype.init=function(){this._iBreakPointTablet=e.media._predefinedRangeSets[e.media.RANGESETS.SAP_STANDARD_EXTENDED].points[0];this._iBreakPointDesktop=e.media._predefinedRangeSets[e.media.RANGESETS.SAP_STANDARD_EXTENDED].points[1];this._iBreakPointLargeDesktop=e.media._predefinedRangeSets[e.media.RANGESETS.SAP_STANDARD_EXTENDED].points[2];this._resizeProxy=l.proxy(n,this)};r.prototype.exit=function(){o.call(this)};r.prototype.onBeforeRendering=function(e){if(this.getColumnsM()>this.getColumnsL()||this.getColumnsL()>this.getColumnsXL()){throw new Error("Column size not correct defined for "+this)}o.call(this)};r.prototype.onAfterRendering=function(e){this._sResizeListener=t.register(this,this._resizeProxy);n.call(this)};r.prototype.toggleContainerExpanded=function(e){e.$().toggleClass("sapUiFormCLContainerColl",!e.getExpanded())};r.prototype.onLayoutDataChange=function(e){this.invalidate()};r.prototype.onsapup=function(e){this.onsapleft(e)};r.prototype.onsapdown=function(e){this.onsapright(e)};r.prototype.getContainerRenderedDomRef=function(e){return e.getDomRef()};r.prototype.getElementRenderedDomRef=function(e){return e.getDomRef()};r.prototype._getContainerSize=function(e){var t=this.getParent();var a=this.getLayoutDataForElement(e,"sap.ui.layout.form.ColumnContainerData");var i=t.getVisibleFormContainers();var s=i.length;var l=this.getColumnsM();var r=this.getColumnsL();var o=this.getColumnsXL();var n={S:{Size:1,Break:false,FirstRow:false},M:{Size:1,Break:false,FirstRow:false},L:{Size:1,Break:false,FirstRow:false},XL:{Size:1,Break:false,FirstRow:false}};var u=function(e,t,a,i,s){if(a<e){t.Size=Math.floor(e/a);if(s&&t.Size*a<e){t.Size=t.Size+e-t.Size*a}}t.Break=e>1&&i>0&&i%e===0;t.FirstRow=a>1&&i<e};if(a){n.M.Size=a.getColumnsM();n.L.Size=a.getColumnsL();n.XL.Size=a.getColumnsXL();if(n.M.Size>l||n.L.Size>r||n.XL.Size>o){throw new Error("More cells defined for FormContainer "+e.getId()+" than columns on "+this)}}if(s===1){if(!a){n.M.Size=l;n.L.Size=r;n.XL.Size=o}n.S.FirstRow=true;n.M.FirstRow=true;n.L.FirstRow=true;n.XL.FirstRow=true}else{var f=0;var g=0;var p=0;var C;var m=false;var L=0;var d=l;var S=r;var h=o;var v=0;for(v=0;v<s;v++){if(e===i[v]){f=v;C=a}else{C=this.getLayoutDataForElement(i[v],"sap.ui.layout.form.ColumnContainerData")}if(!C){var y=i[v].getVisibleFormElements();if(g<y.length){g=y.length;p=v}L++}else{m=true;d=d-C.getColumnsM();S=S-C.getColumnsL();h=h-C.getColumnsXL()}}n.S.FirstRow=s>1&&f===0;n.S.Break=f>0;if(!m){u(l,n.M,s,f,f===p);u(r,n.L,s,f,f===p);u(o,n.XL,s,f,f===p)}else{if(!a){if(L<d){u(d,n.M,L,f,f===p)}if(L<S){u(S,n.L,L,f,f===p)}if(L<h){u(h,n.XL,L,f,f===p)}}var F={M:{rowColumns:0,lineBreak:false,first:true},L:{rowColumns:0,lineBreak:false,first:true},XL:{rowColumns:0,lineBreak:false,first:true}};var k=function(e,t,a){if(a){if(e.rowColumns+a<=t){e.rowColumns=e.rowColumns+a;e.lineBreak=false}else{e.rowColumns=a;if(t>1){e.lineBreak=true}e.first=false}}else{if(e.rowColumns<t){e.rowColumns++;e.lineBreak=false}else{e.rowColumns=1;if(t>1){e.lineBreak=true}e.first=false}}};for(v=0;v<s;v++){if(e===i[v]){C=a}else{C=this.getLayoutDataForElement(i[v],"sap.ui.layout.form.ColumnContainerData")}k(F.M,l,C?C.getColumnsM():0);k(F.L,r,C?C.getColumnsL():0);k(F.XL,o,C?C.getColumnsXL():0);if(e===i[v]){n.M.Break=F.M.lineBreak;n.L.Break=F.L.lineBreak;n.XL.Break=F.XL.lineBreak;n.M.FirstRow=F.M.first;n.L.FirstRow=F.L.first;n.XL.FirstRow=F.XL.first;break}}}}return n};r.prototype._getFieldSize=function(e){var t=12;var a=this.getLayoutDataForElement(e,"sap.ui.layout.form.ColumnElementData");var i={S:{Size:t,Break:false,Space:0},L:{Size:t,Break:false,Space:0}};var s=t;var r=this.getLabelCellsLarge();if(a){i.S.Size=a.getCellsSmall();i.L.Size=a.getCellsLarge()}var o=e.getParent();var n=o.getLabelControl();if(n===e){if(!a){i.S.Size=s;i.L.Size=r}}else{var u=o.getFields();var f=u.length;var g=t;var p=t-this.getEmptyCellsLarge();if(n){var C=this.getLayoutDataForElement(n,"sap.ui.layout.form.ColumnElementData");if(C){s=C.getCellsSmall();r=C.getCellsLarge()}if(s<t){g=g-s}if(r<t){p=p-r}}else{s=0;r=0}if(f===1){if(!a){i.S.Size=g;i.L.Size=p}else if(n){if(i.S.Size>g){i.S.Break=true}if(i.L.Size>p){i.L.Break=true}}}else{var m=0;var L=[];var d=[];var S={availableCells:g,first:0,last:999,firstDefault:-1,defaultFields:0};var h=0;var v=0;var y=0;var F;L.push(l.extend({},S));S.availableCells=p;d.push(l.extend({},S));var k=function(e,t,a,i){e[t].last=a-1;e.push(l.extend({},S));t++;e[t].first=a;e[t].availableCells=i;return t};var D=function(e,a,i,s,l){if(e[a].availableCells-e[a].defaultFields<i){if(i<=s){a=k(e,a,l,s)}else{a=k(e,a,l,t)}}e[a].availableCells=e[a].availableCells-i;return a};var c=function(e,t,a,i){if(e[t].availableCells===e[t].defaultFields){t=k(e,t,i,a)}if(e[t].firstDefault<0){e[t].firstDefault=i}e[t].defaultFields++;return t};for(m=0;m<f;m++){if(e!==u[m]){F=this.getLayoutDataForElement(u[m],"sap.ui.layout.form.ColumnElementData")}else{F=a;y=m}if(F){h=D(L,h,F.getCellsSmall(),g,m);v=D(d,v,F.getCellsLarge(),p,m)}else{h=c(L,h,g,m);v=c(d,v,p,m)}}var z=function(e,a,i,s,l){var r=0;var o;for(m=0;m<e.length;m++){if(a>=e[m].first&&a<=e[m].last){o=e[m];break}}if(!i){s.Size=Math.floor(o.availableCells/o.defaultFields)}if(a===o.first&&a>0){s.Break=true;if(l>0&&l<t&&s.Size<=t-l){s.Space=l}}if(a===o.firstDefault){r=o.availableCells-o.defaultFields*s.Size;if(r>0){s.Size=s.Size+r}}};z(L,y,a,i.S,s);z(d,y,a,i.L,r)}}return i};function o(){if(this._sResizeListener){t.deregister(this._sResizeListener);this._sResizeListener=undefined}}function n(e,t){var a=this.getDomRef();if(!a){o.call(this);return}var i=this.$();if(!i.is(":visible")){return}var s=a.clientWidth;var l=1;if(s<=this._iBreakPointTablet){i.toggleClass("sapUiFormCLMedia-Std-Phone",true);i.toggleClass("sapUiFormCLMedia-Std-Desktop",false).toggleClass("sapUiFormCLMedia-Std-Tablet",false).toggleClass("sapUiFormCLMedia-Std-LargeDesktop",false)}else if(s>this._iBreakPointTablet&&s<=this._iBreakPointDesktop){i.toggleClass("sapUiFormCLMedia-Std-Tablet",true);i.toggleClass("sapUiFormCLMedia-Std-Desktop",false).toggleClass("sapUiFormCLMedia-Std-Phone",false).toggleClass("sapUiFormCLMedia-Std-LargeDesktop",false);l=this.getColumnsM()}else if(s>this._iBreakPointDesktop&&s<=this._iBreakPointLargeDesktop){i.toggleClass("sapUiFormCLMedia-Std-Desktop",true);i.toggleClass("sapUiFormCLMedia-Std-Phone",false).toggleClass("sapUiFormCLMedia-Std-Tablet",false).toggleClass("sapUiFormCLMedia-Std-LargeDesktop",false);l=this.getColumnsL()}else{i.toggleClass("sapUiFormCLMedia-Std-LargeDesktop",true);i.toggleClass("sapUiFormCLMedia-Std-Desktop",false).toggleClass("sapUiFormCLMedia-Std-Phone",false).toggleClass("sapUiFormCLMedia-Std-Tablet",false);l=this.getColumnsXL()}var r=this.getLabelCellsLarge()<12&&s/l>this._iBreakPointTablet;i.toggleClass("sapUiFormCLWideColumns",r);i.toggleClass("sapUiFormCLSmallColumns",!r)}return r});