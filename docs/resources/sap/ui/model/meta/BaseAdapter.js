/*
 * ! OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/base/Object","./AdapterConstants","sap/ui/model/json/JSONModel","sap/ui/base/SyncPromise"],function(t,e,i,n){"use strict";var o=t.extend("sap.ui.model.meta.BaseAdapter",{oMetaModel:undefined,sModelName:undefined,constructor:function(t,i){this.constants=e;this.mMetadataContext=t;this.oModel=t.model;this.oMetaModel=this.oModel.getMetaModel();this.modelName=t.modelName;this.contextName=t.contextName;this.path=t.path;this.metaPath=t.metaPath;this._mProperties={};this._mPropertyBag={};this._mCustomPropertyBag={};this.init();this.enhance(i)},enhance:function(t){if(t){for(var e in t){this.putProperty(e,t[e])}}},init:function(){if(!this.metaPath){this.oMetaContext=this.oMetaModel.getMetaContext(this.path);this.metaPath=this.oMetaContext.getPath()}else{this.oMetaContext=this.oMetaModel.createBindingContext(this.metaPath)}},getModelName:function(){return this.modelName},putProperty:function(t,e,i,o){if(!e){return}if(!o){o=this}Object.defineProperty(this,t,{configurable:true,get:function(){if(this._mCustomPropertyBag[t]){return this._mCustomPropertyBag[t]}if(!this._mPropertyBag.hasOwnProperty(t)){this._mPropertyBag[t]=new n(function(t,n){if(typeof e=="function"){t(e.apply(o,i))}else{t(e)}})}return this._mPropertyBag[t]},set:function(e){this._mCustomPropertyBag[t]=e}})},convertToSimpleBinding:function(t,e){var i="{";if(this.modelName){i=i+"model: '"+this.modelName+"',"}if(this.sContextPath&&t.startsWith(this.sContextPath)){t=t.replace(this.sContextPath,"")}i=i+"path: '"+escape(t)+"'";if(e){i=i+", type: '"+e+"'"}i=i+"}";return i},getContext:function(){return this.contextName},setValue:function(t,e){this.putProperty(t,this._identity,[e],this)},_identity:function(t){return t},parentPromise:function(t,e){return new Promise(function(i,n){sap.ui.require([t],function(t){var n=new t(e);i(n)})})},getAdapterModel:function(){if(!this._oAdapterModel){this._oAdapterModel=new i(this)}return this._oAdapterModel},updateContextPath:function(t){var e=t.getBindingContext(this.model);var i=e?this.removeKeys(e.getPath())+"/":null;if(i&&i!=this.sContextPath){this.sContextPath=i;this._mPropertyBag={}}},removeKeys:function(t){return t},sibling:function(t){if(!t){return null}var e={model:this.oModel,path:t};var i=this.getMetadata().getClass();var n=new i(e);n.sContextPath=this.sContextPath;return n}});return o});