/*!
* OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
*/
sap.ui.define(["./library","sap/ui/core/Core","sap/ui/core/Control","sap/ui/core/library","sap/ui/Device","sap/m/HyphenationSupport","./TextRenderer"],function(e,t,i,n,r,a,o){"use strict";var p=n.TextAlign;var s=n.TextDirection;var h=e.WrappingType;var l=i.extend("sap.m.Text",{metadata:{interfaces:["sap.ui.core.IShrinkable","sap.ui.core.IFormContent","sap.m.IHyphenation"],library:"sap.m",properties:{text:{type:"string",defaultValue:"",bindable:"bindable"},textDirection:{type:"sap.ui.core.TextDirection",group:"Appearance",defaultValue:s.Inherit},wrapping:{type:"boolean",group:"Appearance",defaultValue:true},wrappingType:{type:"sap.m.WrappingType",group:"Appearance",defaultValue:h.Normal},textAlign:{type:"sap.ui.core.TextAlign",group:"Appearance",defaultValue:p.Begin},width:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:null},maxLines:{type:"int",group:"Appearance",defaultValue:null},renderWhitespace:{type:"boolean",group:"Appearance",defaultValue:false}},designtime:"sap/m/designtime/Text.designtime"}});l.prototype.normalLineHeight=1.2;l.prototype.cacheLineHeight=true;l.prototype.ellipsis="...";l.hasNativeLineClamp="webkitLineClamp"in document.documentElement.style;l.setNodeValue=function(e,t){t=t||"";var i=e.childNodes;if(i.length===1&&i[0].nodeType===window.Node.TEXT_NODE){i[0].nodeValue=t}else{e.textContent=t}};l.prototype.getText=function(e){var t=this.getProperty("text");if(e){return t.replace(/\r\n|\n\r|\r/g,"\n")}return t};l.prototype.onAfterRendering=function(){if(this.getVisible()&&this.hasMaxLines()&&!this.canUseNativeLineClamp()){if(t.isThemeApplied()){this.clampHeight()}else{t.attachThemeChanged(this._handleThemeLoad,this)}}};l.prototype._handleThemeLoad=function(){this.clampHeight();t.detachThemeChanged(this._handleThemeLoad,this)};l.prototype.hasMaxLines=function(){return this.getWrapping()&&this.getMaxLines()>1};l.prototype.getTextDomRef=function(){if(!this.getVisible()){return null}if(this.hasMaxLines()){return this.getDomRef("inner")}return this.getDomRef()};l.prototype.canUseNativeLineClamp=function(){if(!l.hasNativeLineClamp){return false}if(this.getTextDirection()==s.RTL){return false}if(this.getTextDirection()==s.Inherit&&t.getConfiguration().getRTL()){return false}return true};l.prototype.getLineHeight=function(e){if(this.cacheLineHeight&&this._fLineHeight){return this._fLineHeight}e=e||this.getTextDomRef();if(!e){return 0}var t=window.getComputedStyle(e),i=t.lineHeight,n;if(/px$/i.test(i)){n=parseFloat(i)}else if(/^normal$/i.test(i)){n=parseFloat(t.fontSize)*this.normalLineHeight}else{n=parseFloat(t.fontSize)*parseFloat(i)}if(!r.browser.firefox){n=Math.floor(n)}if(this.cacheLineHeight&&n){this._fLineHeight=n}return n};l.prototype.getClampHeight=function(e){e=e||this.getTextDomRef();return this.getMaxLines()*this.getLineHeight(e)};l.prototype.clampHeight=function(e){e=e||this.getTextDomRef();if(!e){return 0}var t=this.getClampHeight(e);if(t){e.style.maxHeight=t+"px"}return t};l.prototype.clampText=function(e,t,i){e=e||this.getTextDomRef();if(!e){return}var n;var r=this.getText(true);var a=this.getClampHeight(e);t=t||0;i=i||r.length;l.setNodeValue(e,r.slice(0,i));if(e.scrollHeight>a){var o=e.style,p=o.height,s=this.ellipsis,h=s.length;o.height=a+"px";while(i-t>h){n=t+i>>1;l.setNodeValue(e,r.slice(0,n-h)+s);if(e.scrollHeight>a){i=n}else{t=n}}if(e.scrollHeight>a&&t>0){n=t;e.textContent=r.slice(0,n-h)+s}o.height=p}return n};l.prototype.getAccessibilityInfo=function(){return{description:this.getText()}};l.prototype.getTextsToBeHyphenated=function(){return{main:this.getText(true)}};l.prototype.getDomRefsForHyphenatedTexts=function(){return{main:this.getTextDomRef()}};a.mixInto(l.prototype);return l});