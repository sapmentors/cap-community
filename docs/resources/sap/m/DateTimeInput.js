/*!
 * OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/thirdparty/jquery","sap/ui/core/Control","./library","./DatePicker","./DateTimePicker","./TimePicker","sap/ui/model/type/Date","sap/ui/model/type/Time","sap/ui/model/type/DateTime","sap/ui/model/odata/type/ODataType","sap/ui/core/library","sap/ui/Device","./DateTimeInputRenderer"],function(e,t,a,r,i,s,l,o,u,n,p,h,c){"use strict";var y=a.DateTimeInputType;var g=p.TextDirection;var d=p.TextAlign;var m=p.ValueState;var f=t.extend("sap.m.DateTimeInput",{metadata:{library:"sap.m",designtime:"sap/m/designtime/DateTimeInput.designtime",properties:{value:{type:"string",group:"Data",defaultValue:null,bindable:"bindable"},width:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:"100%"},enabled:{type:"boolean",group:"Behavior",defaultValue:true},editable:{type:"boolean",group:"Behavior",defaultValue:true},valueState:{type:"sap.ui.core.ValueState",group:"Appearance",defaultValue:m.None},valueStateText:{type:"string",group:"Misc",defaultValue:null},showValueStateMessage:{type:"boolean",group:"Misc",defaultValue:true},name:{type:"string",group:"Misc",defaultValue:null},placeholder:{type:"string",group:"Misc",defaultValue:null},textAlign:{type:"sap.ui.core.TextAlign",group:"Appearance",defaultValue:d.Initial},textDirection:{type:"sap.ui.core.TextDirection",group:"Appearance",defaultValue:g.Inherit},type:{type:"sap.m.DateTimeInputType",group:"Data",defaultValue:y.Date},displayFormat:{type:"string",group:"Appearance",defaultValue:null},valueFormat:{type:"string",group:"Data",defaultValue:null},dateValue:{type:"object",group:"Data",defaultValue:null}},aggregations:{_picker:{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"}},associations:{ariaLabelledBy:{type:"sap.ui.core.Control",multiple:true,singularName:"ariaLabelledBy"}},events:{change:{parameters:{value:{type:"string"},dateValue:{type:"object"},valid:{type:"boolean"}}}}}});!function(t,r,i){var s=a.getLocaleData();e.extend(t,{_types:{Date:{valueFormat:s.getDatePattern("short"),displayFormat:s.getDatePattern("medium")},Time:{valueFormat:s.getTimePattern("short"),displayFormat:s.getTimePattern("short")},DateTime:{valueFormat:s.getDateTimePattern("short"),displayFormat:s.getDateTimePattern("short")}}});["Time","Date"].forEach(function(e,a){["valueFormat","displayFormat"].forEach(function(r){var i=t._types;i.DateTime[r]=i.DateTime[r].replace("{"+a+"}",i[e][r])})})}(f.prototype,e,h);f.prototype.init=function(){this.setType(y.Date)};f.prototype.onBeforeRendering=function(){V.call(this)};f.prototype.getFocusDomRef=function(){var e=D.call(this);return e.getFocusDomRef()};f.prototype.getIdForLabel=function(){var e=D.call(this);return e.getIdForLabel()};function v(e){var t;switch(e){case y.DateTime:t=new i(this.getId()+"-Picker");break;case y.Time:t=new s(this.getId()+"-Picker",{localeId:sap.ui.getCore().getConfiguration().getFormatSettings().getFormatLocale().toString()});break;default:t=new r(this.getId()+"-Picker");break}t.setDisplayFormat(this.getDisplayFormat()||this._types[e].displayFormat);t.setValueFormat(this.getValueFormat()||this._types[e].valueFormat);if(this.getDateValue()){t.setDateValue(this.getDateValue())}t.setEnabled(this.getEnabled());t.setEditable(this.getEditable());t.setValueState(this.getValueState());t.setValueStateText(this.getValueStateText());t.setShowValueStateMessage(this.getShowValueStateMessage());t.setName(this.getName());t.setPlaceholder(this.getPlaceholder());t.setTextAlign(this.getTextAlign());t.setTextDirection(this.getTextDirection());t.setWidth("100%");t.attachChange(T,this);var a=this.getAriaLabelledBy();for(var l=0;l<a.length;l++){t.addAriaLabelledBy(a[l])}return t}f.prototype.setType=function(e){if(e==this.getType()&&D.call(this)){return this}this.destroyAggregation("_picker");var t=v.call(this,e);this.setAggregation("_picker",t);this.setProperty("type",e);return this};f.prototype.setWidth=function(e){this.setProperty("width",e);if(this.getDomRef()){e=this.getWidth();this.$().css("width",e)}return this};f.prototype.setValue=function(e){V.call(this);e=this.validateProperty("value",e);if(e.toLowerCase()=="now"){return this.setDateValue(new Date)}if(e===this.getValue()){return this}this.setProperty("value",e,true);var t=D.call(this);t.setValue(e);var a=t.getDateValue();this.setProperty("dateValue",a,true);return this};f.prototype.setDateValue=function(e){if(this._isValidDate(e)){throw new Error("Date must be a JavaScript date object; "+this)}V.call(this);this.setProperty("dateValue",e,true);var t=D.call(this);t.setDateValue(e);var a=t.getValue();this.setProperty("value",a,true);return this};f.prototype.setDisplayFormat=function(e){this.setProperty("displayFormat",e,true);var t=D.call(this);t.setDisplayFormat(e||this._types[this.getType()].displayFormat);return this};f.prototype.setValueFormat=function(e){this.setProperty("valueFormat",e,true);var t=D.call(this);t.setValueFormat(e||this._types[this.getType()].ValueFormat);return this};f.prototype.setEnabled=function(e){this.setProperty("enabled",e,true);var t=D.call(this);t.setEnabled(e);return this};f.prototype.setEditable=function(e){this.setProperty("editable",e,true);var t=D.call(this);t.setEditable(e);return this};f.prototype.setValueState=function(e){this.setProperty("valueState",e,true);var t=D.call(this);t.setValueState(e);return this};f.prototype.setValueStateText=function(e){this.setProperty("valueStateText",e,true);var t=D.call(this);t.setValueStateText(e);return this};f.prototype.setShowValueStateMessage=function(e){this.setProperty("showValueStateMessage",e,true);var t=D.call(this);t.setShowValueStateMessage(e);return this};f.prototype.setName=function(e){this.setProperty("name",e,true);var t=D.call(this);t.setName(e);return this};f.prototype.setPlaceholder=function(e){this.setProperty("placeholder",e,true);var t=D.call(this);t.setPlaceholder(e);return this};f.prototype.setTextAlign=function(e){this.setProperty("textAlign",e,true);var t=D.call(this);t.setTextAlign(e);return this};f.prototype.setTextDirection=function(e){this.setProperty("textDirection",e,true);var t=D.call(this);t.setTextDirection(e);return this};f.prototype.addAriaLabelledBy=function(e){this.addAssociation("ariaLabelledBy",e,true);var t=D.call(this);t.addAriaLabelledBy(e);return this};f.prototype.removeAriaLabelledBy=function(e){this.removeAssociation("ariaLabelledBy",e,true);var t=D.call(this);t.removeAriaLabelledBy(e);return this};f.prototype.removeAllAriaLabelledBy=function(){this.removeAssociation("ariaLabelledBy",true);var e=D.call(this);e.removeAllAriaLabelledBy();return this};f.prototype.getAccessibilityInfo=function(){var e=D.call(this);return e&&e.getAccessibilityInfo?e.getAccessibilityInfo():null};f.prototype._getPickerByTypeAndPattern=function(e,t,a){var r=/[DdYyMLWwGQUur]/,i=/[HhKkmsa]/,s=i.test(a),l=r.test(a),o=s&&!l,u=l&&!s,n=l&&s,p,h;switch(e){case y.Time:case y.Date:case y.DateTime:if(o&&t.getMetadata().getName()!=="sap.m.TimePicker"){p=y.Time}else if(u&&t.getMetadata().getName()!=="sap.m.DatePicker"){p=y.Date}else if(n&&t.getMetadata().getName()!=="sap.m.DateTimePicker"){p=y.DateTime}break;default:{throw"Invalid type: "+e+". Expected is one of the sap.m.DateTimeInputType"}}if(p){this.destroyAggregation("_picker");h=v.call(this,p);this.setAggregation("_picker",h)}return h||t};f.prototype._getBoundValueTypePattern=function(){var e=this.getBinding("value"),t=e&&e.getType()&&e.getType();if(t instanceof l||t instanceof o||t instanceof u){return t.getOutputPattern()}if(t instanceof n&&t.oFormat){return t.oFormat.oFormatOptions.pattern}return undefined};function D(){return this.getAggregation("_picker")}f.prototype._isValidDate=function(t){return t&&e.type(t)!=="date"};function V(){if(this._getBoundValueTypePattern()){var e=this._getBoundValueTypePattern();var t=D.call(this);t=this._getPickerByTypeAndPattern(this.getType(),t,e);if(t.getValueFormat()!=e){t.setValueFormat(e)}if(t.getDisplayFormat()!=e){t.setDisplayFormat(e)}}}function T(e){var t=e.getParameter("value");var a;var r=e.getParameter("valid");this.setProperty("value",t,true);if(r){a=e.oSource.getDateValue();this.setProperty("dateValue",a,true)}this.fireChange({value:t,newValue:t,valid:r,dateValue:a,newDateValue:a})}return f});