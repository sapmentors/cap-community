/*!
 * OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/events/KeyCodes","sap/ui/Device","sap/ui/core/Control","sap/ui/core/InvisibleText","sap/ui/core/LabelEnablement","sap/ui/core/delegate/ItemNavigation","./library","./InstanceManager","./GrowingEnablement","./GroupHeaderListItem","./ListItemBase","./ListBaseRenderer","sap/base/strings/capitalize","sap/ui/thirdparty/jquery","sap/base/Log","sap/ui/dom/jquery/control","sap/ui/dom/jquery/Selectors","sap/ui/dom/jquery/Aria"],function(e,t,i,n,s,o,r,a,u,l,p,h,d,g,c){"use strict";var f=r.ListType;var m=r.ListKeyboardMode;var y=r.ListGrowingDirection;var v=r.SwipeDirection;var I=r.ListSeparators;var _=r.ListMode;var S=r.ListHeaderDesign;var b=r.Sticky;var w=i.extend("sap.m.ListBase",{metadata:{library:"sap.m",dnd:true,properties:{inset:{type:"boolean",group:"Appearance",defaultValue:false},headerText:{type:"string",group:"Misc",defaultValue:null},headerDesign:{type:"sap.m.ListHeaderDesign",group:"Appearance",defaultValue:S.Standard,deprecated:true},footerText:{type:"string",group:"Misc",defaultValue:null},mode:{type:"sap.m.ListMode",group:"Behavior",defaultValue:_.None},width:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:"100%"},includeItemInSelection:{type:"boolean",group:"Behavior",defaultValue:false},showUnread:{type:"boolean",group:"Misc",defaultValue:false},noDataText:{type:"string",group:"Misc",defaultValue:null},showNoData:{type:"boolean",group:"Misc",defaultValue:true},enableBusyIndicator:{type:"boolean",group:"Behavior",defaultValue:true},modeAnimationOn:{type:"boolean",group:"Misc",defaultValue:true},showSeparators:{type:"sap.m.ListSeparators",group:"Appearance",defaultValue:I.All},swipeDirection:{type:"sap.m.SwipeDirection",group:"Misc",defaultValue:v.Both},growing:{type:"boolean",group:"Behavior",defaultValue:false},growingThreshold:{type:"int",group:"Misc",defaultValue:20},growingTriggerText:{type:"string",group:"Appearance",defaultValue:null},growingScrollToLoad:{type:"boolean",group:"Behavior",defaultValue:false},growingDirection:{type:"sap.m.ListGrowingDirection",group:"Behavior",defaultValue:y.Downwards},rememberSelections:{type:"boolean",group:"Behavior",defaultValue:true},keyboardMode:{type:"sap.m.ListKeyboardMode",group:"Behavior",defaultValue:m.Navigation},sticky:{type:"sap.m.Sticky[]",group:"Appearance"}},defaultAggregation:"items",aggregations:{items:{type:"sap.m.ListItemBase",multiple:true,singularName:"item",bindable:"bindable",selector:"#{id} .sapMListItems",dnd:true},swipeContent:{type:"sap.ui.core.Control",multiple:false},headerToolbar:{type:"sap.m.Toolbar",multiple:false},infoToolbar:{type:"sap.m.Toolbar",multiple:false},contextMenu:{type:"sap.ui.core.IContextMenu",multiple:false},_messageStrip:{type:"sap.m.MessageStrip",multiple:false,visibility:"hidden"}},associations:{ariaLabelledBy:{type:"sap.ui.core.Control",multiple:true,singularName:"ariaLabelledBy"}},events:{select:{deprecated:true,parameters:{listItem:{type:"sap.m.ListItemBase"}}},selectionChange:{parameters:{listItem:{type:"sap.m.ListItemBase"},listItems:{type:"sap.m.ListItemBase[]"},selected:{type:"boolean"},selectAll:{type:"boolean"}}},delete:{parameters:{listItem:{type:"sap.m.ListItemBase"}}},swipe:{allowPreventDefault:true,parameters:{listItem:{type:"sap.m.ListItemBase"},swipeContent:{type:"sap.ui.core.Control"},srcControl:{type:"sap.ui.core.Control"},swipeDirection:{type:"sap.m.SwipeDirection"}}},growingStarted:{deprecated:true,parameters:{actual:{type:"int"},total:{type:"int"}}},growingFinished:{deprecated:true,parameters:{actual:{type:"int"},total:{type:"int"}}},updateStarted:{parameters:{reason:{type:"string"},actual:{type:"int"},total:{type:"int"}}},updateFinished:{parameters:{reason:{type:"string"},actual:{type:"int"},total:{type:"int"}}},itemPress:{parameters:{listItem:{type:"sap.m.ListItemBase"},srcControl:{type:"sap.ui.core.Control"}}},beforeOpenContextMenu:{allowPreventDefault:true,parameters:{listItem:{type:"sap.m.ListItemBase"}}}},designtime:"sap/m/designtime/ListBase.designtime"}});w.prototype.bAnnounceDetails=true;w.prototype.bPreventMassSelection=false;w.getInvisibleText=function(){return this.oInvisibleText||(this.oInvisibleText=(new n).toStatic())};w.prototype.sNavItemClass="sapMLIB";w.prototype.init=function(){this._aNavSections=[];this._aSelectedPaths=[];this._iItemNeedsHighlight=0;this._iItemNeedsNavigated=0;this.data("sap-ui-fastnavgroup","true",true)};w.prototype.onBeforeRendering=function(){this._bRendering=true;this._bActiveItem=false;this._aNavSections=[];this._removeSwipeContent()};w.prototype.onAfterRendering=function(){this._bRendering=false;this._sLastMode=this.getMode();if(t.system.desktop){this._startItemNavigation(true)}};w.prototype.exit=function(){this._oSelectedItem=null;this._aNavSections=[];this._aSelectedPaths=[];this._destroyGrowingDelegate();this._destroyItemNavigation()};w.prototype.refreshItems=function(e){if(this._oGrowingDelegate){this._oGrowingDelegate.refreshItems(e)}else{if(!this._bReceivingData){this._updateStarted(e);this._bReceivingData=true}this.refreshAggregation("items")}};w.prototype.updateItems=function(e){if(this._oGrowingDelegate){this._oGrowingDelegate.updateItems(e)}else{if(this._bReceivingData){this._bReceivingData=false}else{this._updateStarted(e)}this.updateAggregation("items");this._updateFinished()}};w.prototype.setBindingContext=function(e,t){var n=(this.getBindingInfo("items")||{}).model;if(n===t){this._resetItemsBinding()}return i.prototype.setBindingContext.apply(this,arguments)};w.prototype._bindAggregation=function(e,t){function n(e,t,i){e.events=e.events||{};if(!e.events[t]){e.events[t]=i}else{var n=e.events[t];e.events[t]=function(){i.apply(this,arguments);n.apply(this,arguments)}}}if(e==="items"){this._resetItemsBinding();n(t,"dataRequested",this._onBindingDataRequestedListener.bind(this));n(t,"dataReceived",this._onBindingDataReceivedListener.bind(this))}i.prototype._bindAggregation.call(this,e,t)};w.prototype._onBindingDataRequestedListener=function(e){this._showBusyIndicator();if(this._dataReceivedHandlerId!=null){clearTimeout(this._dataReceivedHandlerId);delete this._dataReceivedHandlerId}};w.prototype._onBindingDataReceivedListener=function(e){if(this._dataReceivedHandlerId!=null){clearTimeout(this._dataReceivedHandlerId);delete this._dataReceivedHandlerId}this._dataReceivedHandlerId=setTimeout(function(){this._hideBusyIndicator();delete this._dataReceivedHandlerId}.bind(this),0)};w.prototype.destroyItems=function(e){if(!this.getItems(true).length){return this}this._oSelectedItem=null;this.destroyAggregation("items","KeepDom");if(!e){this.invalidate()}return this};w.prototype.removeAllItems=function(e){this._oSelectedItem=null;return this.removeAllAggregation("items")};w.prototype.removeItem=function(e){var t=this.removeAggregation("items",e);if(t&&t===this._oSelectedItem){this._oSelectedItem=null}return t};w.prototype.getItems=function(e){if(e){return this.mAggregations["items"]||[]}return this.getAggregation("items",[])};w.prototype.getId=function(e){var t=this.sId;return e?t+"-"+e:t};w.prototype.setGrowing=function(e){e=!!e;if(this.getGrowing()!=e){this.setProperty("growing",e,!e);if(e){this._oGrowingDelegate=new u(this)}else if(this._oGrowingDelegate){this._oGrowingDelegate.destroy();this._oGrowingDelegate=null}}return this};w.prototype.setGrowingThreshold=function(e){return this.setProperty("growingThreshold",e,true)};w.prototype.setEnableBusyIndicator=function(e){this.setProperty("enableBusyIndicator",e,true);if(!this.getEnableBusyIndicator()){this._hideBusyIndicator()}return this};w.prototype.setNoDataText=function(e){this.setProperty("noDataText",e,true);this.$("nodata-text").text(this.getNoDataText());return this};w.prototype.getNoDataText=function(e){if(e&&this._bBusy){return""}var t=this.getProperty("noDataText");t=t||sap.ui.getCore().getLibraryResourceBundle("sap.m").getText("LIST_NO_DATA");return t};w.prototype.getSelectedItem=function(){var e=this.getItems(true);for(var t=0;t<e.length;t++){if(e[t].getSelected()){return e[t]}}return null};w.prototype.setSelectedItem=function(e,t,i){if(this.indexOfItem(e)<0){c.warning("setSelectedItem is called without valid ListItem parameter on "+this);return}if(this._bSelectionMode){e.setSelected(t===undefined?true:!!t);i&&this._fireSelectionChangeEvent([e])}};w.prototype.getSelectedItems=function(){return this.getItems(true).filter(function(e){return e.getSelected()})};w.prototype.setSelectedItemById=function(e,t){var i=sap.ui.getCore().byId(e);return this.setSelectedItem(i,t)};w.prototype.getSelectedContexts=function(e){var t=this.getBindingInfo("items"),i=(t||{}).model,n=this.getModel(i);if(!t||!n){return[]}if(e&&this.getRememberSelections()){return this._aSelectedPaths.map(function(e){return n.getContext(e)})}return this.getSelectedItems().map(function(e){return e.getBindingContext(i)})};w.prototype.removeSelections=function(e,t,i){var n=[];this._oSelectedItem=null;e&&(this._aSelectedPaths=[]);this.getItems(true).forEach(function(t){if(!t.getSelected()){return}if(i&&t.isSelectedBoundTwoWay()){return}t.setSelected(false,true);n.push(t);!e&&this._updateSelectedPaths(t)},this);if(t&&n.length){this._fireSelectionChangeEvent(n)}return this};w.prototype.selectAll=function(e){if(this.getMode()!="MultiSelect"){return this}var t=[];this.getItems(true).forEach(function(e){if(!e.getSelected()){e.setSelected(true,true);t.push(e);this._updateSelectedPaths(e)}},this);if(e&&t.length){this._fireSelectionChangeEvent(t,e)}return this};w.prototype.getLastMode=function(e){return this._sLastMode};w.prototype.setMode=function(e){e=this.validateProperty("mode",e);var t=this.getMode();if(t==e){return this}this._bSelectionMode=e.indexOf("Select")>-1;if(!this._bSelectionMode){this.removeSelections(true)}else{var i=this.getSelectedItems();if(i.length>1){this.removeSelections(true)}else if(t===_.MultiSelect){this._oSelectedItem=i[0]}}return this.setProperty("mode",e)};w.prototype.getGrowingInfo=function(){return this._oGrowingDelegate?this._oGrowingDelegate.getInfo():null};w.prototype.setRememberSelections=function(e){this.setProperty("rememberSelections",e,true);!this.getRememberSelections()&&(this._aSelectedPaths=[]);return this};w.prototype.setSelectedContextPaths=function(e){this._aSelectedPaths=e||[]};w.prototype.getSelectedContextPaths=function(e){if(!e||e&&this.getRememberSelections()){return this._aSelectedPaths.slice(0)}return this.getSelectedItems().map(function(e){return e.getBindingContextPath()})};w.prototype.isAllSelectableSelected=function(){if(this.getMode()!=_.MultiSelect){return false}var e=this.getItems(true),t=this.getSelectedItems().length,i=e.filter(function(e){return e.isSelectable()}).length;return e.length>0&&t==i};w.prototype.getVisibleItems=function(){return this.getItems(true).filter(function(e){return e.getVisible()})};w.prototype.getActiveItem=function(){return this._bActiveItem};w.prototype.onItemDOMUpdate=function(e){if(!this._bRendering&&this.bOutput){this._startItemNavigation(true)}};w.prototype.onItemActiveChange=function(e,t){this._bActiveItem=t};w.prototype.onItemHighlightChange=function(e,t){this._iItemNeedsHighlight+=t?1:-1;if(this._iItemNeedsHighlight==1&&t){this.$("listUl").addClass("sapMListHighlight")}else if(this._iItemNeedsHighlight==0){this.$("listUl").removeClass("sapMListHighlight")}};w.prototype.onItemNavigatedChange=function(e,t){this._iItemNeedsNavigated+=t?1:-1;if(this._iItemNeedsNavigated==1&&t){this.$("listUl").addClass("sapMListNavigated")}else if(this._iItemNeedsNavigated==0){this.$("listUl").removeClass("sapMListNavigated")}};w.prototype.onItemSelectedChange=function(e,t){if(this.getMode()==_.MultiSelect){this._updateSelectedPaths(e,t);return}if(t){this._aSelectedPaths=[];this._oSelectedItem&&this._oSelectedItem.setSelected(false,true);this._oSelectedItem=e}else if(this._oSelectedItem===e){this._oSelectedItem=null}this._updateSelectedPaths(e,t)};w.prototype.getItemsContainerDomRef=function(){return this.getDomRef("listUl")};w.prototype.checkGrowingFromScratch=function(){};w.prototype.onBeforePageLoaded=function(e,t){this._fireUpdateStarted(t,e);this.fireGrowingStarted(e)};w.prototype.onAfterPageLoaded=function(e,t){this._fireUpdateFinished(e);this.fireGrowingFinished(e)};w.prototype.addNavSection=function(e){this._aNavSections.push(e);return e};w.prototype.getMaxItemsCount=function(){var e=this.getBinding("items");if(e&&e.getLength){return e.getLength()||0}return this.getItems(true).length};w.prototype.shouldRenderItems=function(){return true};w.prototype._resetItemsBinding=function(){if(this.isBound("items")){this._bUpdating=false;this._bReceivingData=false;this.removeSelections(true,false,true);this._oGrowingDelegate&&this._oGrowingDelegate.reset();this._hideBusyIndicator();if(this._oItemNavigation){this._oItemNavigation.iFocusedIndex=-1}}};w.prototype._updateStarted=function(e){if(!this._bReceivingData&&!this._bUpdating){this._bUpdating=true;this._fireUpdateStarted(e)}};w.prototype._fireUpdateStarted=function(e,t){this._sUpdateReason=d(e||"Refresh");this.fireUpdateStarted({reason:this._sUpdateReason,actual:t?t.actual:this.getItems(true).length,total:t?t.total:this.getMaxItemsCount()})};w.prototype.onThemeChanged=function(){if(this._oGrowingDelegate){this._oGrowingDelegate._updateTrigger()}};w.prototype._updateFinished=function(){if(!this._bReceivingData&&this._bUpdating){this._fireUpdateFinished();this._bUpdating=false}};w.prototype._fireUpdateFinished=function(e){this._hideBusyIndicator();setTimeout(function(){this._bItemNavigationInvalidated=true;this.fireUpdateFinished({reason:this._sUpdateReason,actual:e?e.actual:this.getItems(true).length,total:e?e.total:this.getMaxItemsCount()})}.bind(this),0)};w.prototype._showBusyIndicator=function(){if(this.getEnableBusyIndicator()&&!this.getBusy()&&!this._bBusy){this._bBusy=true;this._sBusyTimer=setTimeout(function(){this.$("nodata-text").text("")}.bind(this),this.getBusyIndicatorDelay());this.setBusy(true,"listUl")}};w.prototype._hideBusyIndicator=function(){if(this._bBusy){this._bBusy=false;this.setBusy(false,"listUl");clearTimeout(this._sBusyTimer);if(!this.getItems(true).length){this.$("nodata-text").text(this.getNoDataText())}}};w.prototype.onItemBindingContextSet=function(e){if(!this._bSelectionMode||!this.getRememberSelections()||!this.isBound("items")){return}if(e.isSelectedBoundTwoWay()){return}var t=e.getBindingContextPath();if(t){var i=this._aSelectedPaths.indexOf(t)>-1;e.setSelected(i)}};w.prototype.onItemInserted=function(e,t){if(t){this.onItemSelectedChange(e,true)}if(!this._bSelectionMode||!this._aSelectedPaths.length||!this.getRememberSelections()||!this.isBound("items")||e.isSelectedBoundTwoWay()||e.getSelected()){return}var i=e.getBindingContextPath();if(i&&this._aSelectedPaths.indexOf(i)>-1){e.setSelected(true)}};w.prototype.onItemSelect=function(e,t){var i=this.getMode();if(this._mRangeSelection&&!this.bPreventMassSelection){if(!this._mRangeSelection.selected){this._fireSelectionChangeEvent([e]);this._mRangeSelection.index=this.getVisibleItems().indexOf(e);this._mRangeSelection.selected=t;return}if(!t){e.setSelected(true);return}var n=this.indexOfItem(e),s=this.getItems(),o,r,a=[],u;if(n<this._mRangeSelection.index){o=this._mRangeSelection.index-n;u=-1}else{o=n-this._mRangeSelection.index;u=1}for(var l=1;l<=o;l++){r=s[this._mRangeSelection.index+l*u];if(r.isSelectable()&&r.getVisible()&&!r.getSelected()){r.setSelected(true);a.push(r)}else if(r===e){a.push(r)}}this._fireSelectionChangeEvent(a);return}if(i===_.MultiSelect){this._fireSelectionChangeEvent([e])}else if(this._bSelectionMode&&t){this._fireSelectionChangeEvent([e])}};w.prototype._fireSelectionChangeEvent=function(e,t){var i=e&&e[0];if(!i){return}this.fireSelectionChange({listItem:i,listItems:e,selected:i.getSelected(),selectAll:!!t});this.fireSelect({listItem:i})};w.prototype.onItemDelete=function(e){this.fireDelete({listItem:e})};w.prototype.onItemPress=function(e,t){if(e.getType()==f.Inactive){return}setTimeout(function(){this.fireItemPress({listItem:e,srcControl:t})}.bind(this),0)};w.prototype.onItemKeyDown=function(e,t){if(!t.shiftKey||this.getMode()!==_.MultiSelect||!e.isSelectable()||this.bPreventMassSelection){return}var i=this.getVisibleItems(),n=i.some(function(e){return!!e.getSelected()});if(!n){return}if(!this._mRangeSelection){this._mRangeSelection={index:i.indexOf(e),selected:e.getSelected()}}};w.prototype.onItemKeyUp=function(t,i){if(i.which===e.SHIFT){this._mRangeSelection=null}};w.prototype._updateSelectedPaths=function(e,t){if(!this.getRememberSelections()||!this.isBound("items")){return}var i=e.getBindingContextPath();if(!i){return}t=t===undefined?e.getSelected():t;var n=this._aSelectedPaths.indexOf(i);if(t){n<0&&this._aSelectedPaths.push(i)}else{n>-1&&this._aSelectedPaths.splice(n,1)}};w.prototype._destroyGrowingDelegate=function(){if(this._oGrowingDelegate){this._oGrowingDelegate.destroy();this._oGrowingDelegate=null}};w.prototype._destroyItemNavigation=function(){if(this._oItemNavigation){this.removeEventDelegate(this._oItemNavigation);this._oItemNavigation.destroy();this._oItemNavigation=null}};w.prototype._getTouchBlocker=function(){return this.$().children()};w.prototype._getSwipeContainer=function(){return this._$swipeContainer||(this._$swipeContainer=g("<div>",{id:this.getId("swp"),class:"sapMListSwp"}))};w.prototype._setSwipePosition=function(){if(this._isSwipeActive){return this._getSwipeContainer().css("top",this._swipedItem.$().position().top)}};w.prototype._renderSwipeContent=function(){var e=this._swipedItem.$(),t=this._getSwipeContainer();this.$().prepend(t.css({top:e.position().top,height:e.outerHeight(true)}));if(this._bRerenderSwipeContent){this._bRerenderSwipeContent=false;var i=sap.ui.getCore().createRenderManager();i.render(this.getSwipeContent(),t.empty()[0]);i.destroy()}return this};w.prototype._swipeIn=function(){var e=this,t=e._getTouchBlocker(),i=e._getSwipeContainer();e._isSwipeActive=true;e._renderSwipeContent();a.addDialogInstance(e);window.document.activeElement.blur();g(window).on("resize.swp",function(){e._setSwipePosition()});t.css("pointer-events","none").on("touchstart.swp mousedown.swp",function(e){if(!i[0].firstChild.contains(e.target)){e.preventDefault();e.stopPropagation()}});i.bind("webkitAnimationEnd animationend",function(){g(this).unbind("webkitAnimationEnd animationend");i.css("opacity",1).focus();t.parent().on("touchend.swp touchcancel.swp mouseup.swp",function(t){if(!i[0].firstChild.contains(t.target)){e.swipeOut()}})}).removeClass("sapMListSwpOutAnim").addClass("sapMListSwpInAnim")};w.prototype._onSwipeOut=function(e){this._getSwipeContainer().css("opacity",0).remove();g(window).off("resize.swp");this._getTouchBlocker().css("pointer-events","auto").off("touchstart.swp mousedown.swp");if(typeof e=="function"){e.call(this,this._swipedItem,this.getSwipeContent())}this._isSwipeActive=false;a.removeDialogInstance(this)};w.prototype.swipeOut=function(e){if(!this._isSwipeActive){return this}var t=this,i=this._getSwipeContainer();this._getTouchBlocker().parent().off("touchend.swp touchend.swp touchcancel.swp mouseup.swp");i.bind("webkitAnimationEnd animationend",function(){g(this).unbind("webkitAnimationEnd animationend");t._onSwipeOut(e)}).removeClass("sapMListSwpInAnim").addClass("sapMListSwpOutAnim");return this};w.prototype._removeSwipeContent=function(){if(this._isSwipeActive){this.swipeOut()._onSwipeOut()}};w.prototype.close=w.prototype._removeSwipeContent;w.prototype._onSwipe=function(e,i){var n=this.getSwipeContent(),s=e.srcControl;if(n&&s&&!this._isSwipeActive&&this!==s&&!this._eventHandledByControl&&t.support.touch){for(var o=s;o&&!(o instanceof p);o=o.oParent);if(o instanceof p){this._swipedItem=o;this.fireSwipe({listItem:this._swipedItem,swipeContent:n,srcControl:s,swipeDirection:i},true)&&this._swipeIn()}}};w.prototype.ontouchstart=function(e){this._eventHandledByControl=e.isMarked()};w.prototype.onswipeleft=function(e){var t=sap.ui.getCore().getConfiguration().getRTL();var i=t?v.EndToBegin:v.BeginToEnd;var n=this.getSwipeDirection();if(n===v.LeftToRight){n=v.BeginToEnd}else if(n===v.RightToLeft){n=v.EndToBegin}if(n!=i){if(n==v.Both){n=t?v.BeginToEnd:v.EndToBegin}this._onSwipe(e,n)}};w.prototype.onswiperight=function(e){var t=sap.ui.getCore().getConfiguration().getRTL();var i=t?v.BeginToEnd:v.EndToBegin;var n=this.getSwipeDirection();if(n===v.LeftToRight){n=v.BeginToEnd}else if(n===v.RightToLeft){n=v.EndToBegin}if(n!=i){if(n==v.Both){n=t?v.EndToBegin:v.BeginToEnd}this._onSwipe(e,n)}};w.prototype.setSwipeDirection=function(e){return this.setProperty("swipeDirection",e,true)};w.prototype.getSwipedItem=function(){return this._isSwipeActive?this._swipedItem:null};w.prototype.setSwipeContent=function(e){this._bRerenderSwipeContent=true;this.toggleStyleClass("sapMListSwipable",!!e);return this.setAggregation("swipeContent",e,!this._isSwipeActive)};w.prototype.invalidate=function(e){if(e&&e===this.getSwipeContent()){this._bRerenderSwipeContent=true;this._isSwipeActive&&this._renderSwipeContent();return}return i.prototype.invalidate.apply(this,arguments)};w.prototype.addItemGroup=function(e,t,i){if(!t){t=new l;t.setTitle(e.text||e.key)}t._bGroupHeader=true;this.addAggregation("items",t,i);return t};w.prototype.removeGroupHeaders=function(e){this.getItems(true).forEach(function(t){if(t.isGroupHeader()){t.destroy(e)}})};w.prototype.getAccessibilityType=function(){return sap.ui.getCore().getLibraryResourceBundle("sap.m").getText("ACC_CTR_TYPE_LIST")};w.prototype.getAccessibilityStates=function(){if(!this.getItems(true).length){return""}var e="",t=_,i=this.getMode(),n=sap.ui.getCore().getLibraryResourceBundle("sap.m");if(s.isRequired(this)){e+=n.getText("LIST_REQUIRED")+" "}if(i==t.MultiSelect){e+=n.getText("LIST_MULTISELECTABLE")+" "}else if(i==t.Delete){e+=n.getText("LIST_DELETABLE")+" "}else if(i!=t.None){e+=n.getText("LIST_SELECTABLE")+" "}if(this.isGrouped()){e+=n.getText("LIST_GROUPED")+" "}return e};w.prototype.getAccessibilityInfo=function(){return{description:this.getAccessibilityStates().trim(),focusable:true}};w.prototype.getAccessbilityPosition=function(e){var t=0,i=this.getVisibleItems(),n=i.indexOf(e)+1,s=this.getBinding("items");if(this.getGrowing()&&this.getGrowingScrollToLoad()&&s&&s.isLengthFinal()){t=s.getLength();if(s.isGrouped()){t+=i.filter(function(e){return e.isGroupHeader()&&e.getVisible()}).length}}else{t=i.length}return{setSize:t,posInset:n}};w.prototype.onItemFocusIn=function(e,i){this._handleStickyItemFocus(e.getDomRef());if(e!==i||!sap.ui.getCore().getConfiguration().getAccessibility()){return}var n=e.getDomRef(),s=this.getAccessbilityPosition(e);if(!e.getContentAnnouncement){this.getNavigationRoot().setAttribute("aria-activedescendant",n.id);n.setAttribute("aria-posinset",s.posInset);n.setAttribute("aria-setsize",s.setSize)}else{var o=e.getAccessibilityInfo(),r=sap.ui.getCore().getLibraryResourceBundle("sap.m"),a=o.type+" ";if(!t.browser.chrome||this.isA("sap.m.Table")){a+=r.getText("LIST_ITEM_POSITION",[s.posInset,s.setSize])+" "}else{n.setAttribute("aria-posinset",s.posInset);n.setAttribute("aria-setsize",s.setSize)}a+=o.description;this.updateInvisibleText(a,n);return a}};w.prototype.updateInvisibleText=function(e,t,i){var n=w.getInvisibleText(),s=g(t||document.activeElement);if(this.bAnnounceDetails){this.bAnnounceDetails=false;e=this.getAccessibilityInfo().description+" "+e}n.setText(e.trim());s.addAriaLabelledBy(n.getId(),i)};w.prototype.getNavigationRoot=function(){return this.getDomRef("listUl")};w.prototype.getFocusDomRef=function(){return this.getNavigationRoot()};w.prototype._startItemNavigation=function(e){if(!t.system.desktop){return}var i=this.getKeyboardMode(),n=m;if(i==n.Edit&&!this.getItems(true).length){return}var s=this.getNavigationRoot();var r=i==n.Edit?-1:0;if(e&&s&&!s.contains(document.activeElement)){this._bItemNavigationInvalidated=true;if(!s.getAttribute("tabindex")){s.tabIndex=r}return}if(!this._oItemNavigation){this._oItemNavigation=new o;this._oItemNavigation.setCycling(false);this.addDelegate(this._oItemNavigation);this._setItemNavigationTabIndex(r);this._oItemNavigation.setTableMode(true,true).setColumns(1);this._oItemNavigation.setDisabledModifiers({sapnext:["alt"],sapprevious:["alt"]})}this._oItemNavigation.setPageSize(this.getGrowingThreshold());this._oItemNavigation.setRootDomRef(s);this.setNavigationItems(this._oItemNavigation,s);this._bItemNavigationInvalidated=false};w.prototype.setNavigationItems=function(e,t){var i=g(t).children(".sapMLIB").get();e.setItemDomRefs(i);if(e.getFocusedIndex()==-1){if(this.getGrowing()&&this.getGrowingDirection()==y.Upwards){e.setFocusedIndex(i.length-1)}else{e.setFocusedIndex(0)}}};w.prototype.getItemNavigation=function(){return this._oItemNavigation};w.prototype._setItemNavigationTabIndex=function(e){if(this._oItemNavigation){this._oItemNavigation.iActiveTabIndex=e;this._oItemNavigation.iTabIndex=e}};w.prototype.setKeyboardMode=function(e){this.setProperty("keyboardMode",e,true);if(this.isActive()){var t=e==m.Edit?-1:0;this.$("nodata").prop("tabIndex",~t);this.$("listUl").prop("tabIndex",t);this.$("after").prop("tabIndex",t);this._setItemNavigationTabIndex(t)}return this};w.prototype.setItemFocusable=function(e){if(!this._oItemNavigation){return}var t=this._oItemNavigation.getItemDomRefs();var i=t.indexOf(e.getDomRef());if(i>=0){this._oItemNavigation.setFocusedIndex(i)}};w.prototype.forwardTab=function(e){this._bIgnoreFocusIn=true;this.$(e?"after":"before").focus()};w.prototype.onsaptabnext=function(e){if(e.isMarked()||this.getKeyboardMode()==m.Edit){return}if(e.target.id==this.getId("nodata")){this.forwardTab(true);e.setMarked()}};w.prototype.onsaptabprevious=function(e){if(e.isMarked()||this.getKeyboardMode()==m.Edit){return}var t=e.target.id;if(t==this.getId("nodata")){this.forwardTab(false)}else if(t==this.getId("trigger")){this.focusPrevious();e.preventDefault()}};w.prototype._navToSection=function(e){var t;var i=0;var n=e?1:-1;var s=this._aNavSections.length;this._aNavSections.some(function(e,t){var n=e?window.document.getElementById(e):null;if(n&&n.contains(document.activeElement)){i=t;return true}});var o=this.getItemsContainerDomRef();var r=g(document.getElementById(this._aNavSections[i]));if(r[0]===o&&this._oItemNavigation){r.data("redirect",this._oItemNavigation.getFocusedIndex())}this._aNavSections.some(function(){i=(i+n+s)%s;t=g(document.getElementById(this._aNavSections[i]));if(t[0]===o&&this._oItemNavigation){var e=t.data("redirect");var r=this._oItemNavigation.getItemDomRefs();var a=r[e]||o.children[0];t=g(a)}if(t.is(":focusable")){t.focus();return true}},this);return t};w.prototype.onsapshow=function(t){if(t.isMarked()||t.which==e.F4||t.target.id!=this.getId("trigger")&&!g(t.target).hasClass(this.sNavItemClass)){return}if(this._navToSection(true)){t.preventDefault();t.setMarked()}};w.prototype.onsaphide=function(e){if(e.isMarked()||e.target.id!=this.getId("trigger")&&!g(e.target).hasClass(this.sNavItemClass)){return}if(this._navToSection(false)){e.preventDefault();e.setMarked()}};w.prototype.onkeydown=function(t){var i=t.which==e.A&&(t.metaKey||t.ctrlKey);if(t.isMarked()||!i||!g(t.target).hasClass(this.sNavItemClass)||this.bPreventMassSelection){return}t.preventDefault();if(this.getMode()!==_.MultiSelect){return}if(this.isAllSelectableSelected()){this.removeSelections(false,true)}else{this.selectAll(true)}t.setMarked()};w.prototype.onmousedown=function(e){if(this._bItemNavigationInvalidated){this._startItemNavigation()}if(e.shiftKey&&this._mRangeSelection&&e.srcControl.getId().includes("-selectMulti")){e.preventDefault()}};w.prototype.focusPrevious=function(){if(!this._oItemNavigation){return}var e=this._oItemNavigation.getItemDomRefs();var t=this._oItemNavigation.getFocusedIndex();var i=g(e[t]);var n=i.control(0)||{};var s=n.getTabbables?n.getTabbables():i.find(":sapTabbable");var o=s.eq(-1).add(i).eq(-1);this.bAnnounceDetails=true;o.focus()};w.prototype.onfocusin=function(e){if(this._bIgnoreFocusIn){this._bIgnoreFocusIn=false;e.stopImmediatePropagation(true);return}if(this._bItemNavigationInvalidated){this._startItemNavigation()}var t=e.target;if(t.id==this.getId("nodata")){this.updateInvisibleText(this.getNoDataText(),t)}if(e.isMarked()||!this._oItemNavigation||this.getKeyboardMode()==m.Edit||t.id!=this.getId("after")){return}this.focusPrevious();e.setMarked()};w.prototype.onsapfocusleave=function(e){if(this._oItemNavigation&&!this.bAnnounceDetails&&!this.getNavigationRoot().contains(document.activeElement)){this.bAnnounceDetails=true}};w.prototype.onItemArrowUpDown=function(e,t){var i=this.getItems(true),n=i.indexOf(e)+(t.type=="sapup"?-1:1),s=i[n];if(s&&s.isGroupHeader()){s=i[n+(t.type=="sapup"?-1:1)]}if(!s){return}var o=s.getTabbables(),r=e.getTabbables().index(t.target),a=o.eq(o[r]?r:-1);a[0]?a.focus():s.focus();t.preventDefault();t.setMarked()};w.prototype.onItemContextMenu=function(e,t){var i=this.getContextMenu();if(!i){return}var n=this.fireBeforeOpenContextMenu({listItem:e,column:sap.ui.getCore().byId(g(t.target).closest(".sapMListTblCell",this.getNavigationRoot()).attr("data-sap-ui-column"))});if(n){t.setMarked();t.preventDefault();var s,o=this.getBindingInfo("items");if(o){s=e.getBindingContext(o.model);i.setBindingContext(s,o.model)}i.openAsContextMenu(t,e)}};w.prototype.onItemUpDownModifiers=function(e,t,i){if(!this._mRangeSelection||this.bPreventMassSelection){return}var n=this.getVisibleItems(),s=n.indexOf(e),o=n[s+i];if(!o){if(this._mRangeSelection){this._mRangeSelection=null}t.setMarked();return}var r=o.getSelected();if(this._mRangeSelection.direction===undefined){this._mRangeSelection.direction=i}else if(this._mRangeSelection.direction!==i){if(this._mRangeSelection.index!==n.indexOf(e)){o=e;r=o.getSelected();if(this._mRangeSelection.selected&&r){this.setSelectedItem(o,false,true);return}}else{this._mRangeSelection.direction=i}}if(this._mRangeSelection.selected!==r&&o.isSelectable()){this.setSelectedItem(o,this._mRangeSelection.selected,true)}};w.prototype.isGrouped=function(){var e=this.getBinding("items");return e&&e.isGrouped()};w.prototype.setContextMenu=function(e){this.setAggregation("contextMenu",e,true);return this};w.prototype.destroyContextMenu=function(){this.destroyAggregation("contextMenu",true);return this};w.getStickyBrowserSupport=function(){var e=t.browser;return e.safari||e.chrome||e.firefox&&e.version>=59||e.edge&&e.version>=16};w.prototype.getStickyStyleValue=function(){var e=this.getSticky();if(!e||!e.length||!w.getStickyBrowserSupport()){return this._iStickyValue=0}var t=0,i=this.getHeaderText(),n=this.getHeaderToolbar(),s=i||n&&n.getVisible(),o=this.getInfoToolbar(),r=o&&o.getVisible(),a=false;if(this.isA("sap.m.Table")){a=this.getColumns().some(function(e){return e.getVisible()&&e.getHeader()})}e.forEach(function(e){if(e===b.HeaderToolbar&&s){t+=1}else if(e===b.InfoToolbar&&r){t+=2}else if(e===b.ColumnHeaders&&a){t+=4}});return this._iStickyValue=t};w.prototype._handleStickyItemFocus=function(e){if(!this._iStickyValue||this._sLastFocusedStickyItemId===e.id){return}var t=r.getScrollDelegate(this,true);if(!t){return}var i=0,n=0,s=0,o=0,a=0,u=0;if(this._iStickyValue&4){var l=this.getDomRef("tblHeader").firstChild;var p=l.getBoundingClientRect();n=parseInt(p.bottom);i=parseInt(p.height)}if(this._iStickyValue&2){var h=this.getDomRef().querySelector(".sapMListInfoTBarContainer");if(h){var d=h.getBoundingClientRect();o=parseInt(d.bottom);s=parseInt(d.height)}}if(this._iStickyValue&1){var g=this.getDomRef().querySelector(".sapMListHdr");if(g){var c=g.getBoundingClientRect();u=parseInt(c.bottom);a=parseInt(c.height)}}var f=Math.round(e.getBoundingClientRect().top);if(n>f||o>f||u>f){window.requestAnimationFrame(function(){t.scrollToElement(e,0,[0,-i-s-a])})}this._sLastFocusedStickyItemId=e.id};w.prototype.setHeaderToolbar=function(e){return this._setToolbar("headerToolbar",e)};w.prototype.setInfoToolbar=function(e){return this._setToolbar("infoToolbar",e)};w.prototype._setToolbar=function(e,t){var i=this.getAggregation(e);if(i){i.detachEvent("_change",this._onToolbarPropertyChanged,this)}this.setAggregation(e,t);if(t){t.attachEvent("_change",this._onToolbarPropertyChanged,this)}return this};w.prototype._onToolbarPropertyChanged=function(e){if(e.getParameter("name")!=="visible"){return}var t=this._iStickyValue,i=this.getStickyStyleValue();if(t!==i){var n=this.getDomRef();if(n){var s=n.classList;s.toggle("sapMSticky",!!i);s.remove("sapMSticky"+t);s.toggle("sapMSticky"+i,!!i)}}};return w});