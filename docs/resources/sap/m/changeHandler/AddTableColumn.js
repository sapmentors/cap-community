/*!
 * OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/fl/changeHandler/ChangeHandlerMediator","sap/base/Log"],function(e,n){"use strict";var t={};var r="columns";var i="cells";var a="items";t.applyChange=function(t,o,d){var c=d.modifier;var l=d.view;var g=d.appComponent;var f=t.getDefinition();var p=t.getContent();var u=function(e){return e&&e.content&&e.content.createFunction};var v=function(e,n){return e.newFieldSelector&&e.newFieldIndex!==undefined&&e.bindingPath&&e.oDataServiceVersion&&!!u(n)};return e.getChangeHandlerSettings({scenario:"addODataField",oDataServiceVersion:p.oDataServiceVersion}).then(function(e){if(p&&v(p,e)){var s=c.getBindingTemplate(o,a,l);var h=c.createControl("sap.m.Text",g,l,p.newFieldSelector.id+"--column",{text:"{/#"+p.entityType+"/"+p.bindingPath+"/@sap:label}"});if(s){var w={appComponent:d.appComponent,view:d.view,fieldSelector:p.newFieldSelector.id+"--field",bindingPath:p.bindingPath};var C=u(e);var S=C(c,w);c.insertAggregation(s,i,S,p.newFieldIndex,l);c.updateAggregation(o,a);t.setRevertData(p.newFieldSelector.id+"--field")}var m=c.createControl("sap.m.Column",g,l,p.newFieldSelector);c.insertAggregation(m,"header",h,0,l);c.insertAggregation(o,r,m,p.newFieldIndex,l);return true}else{n.error("Change does not contain sufficient information to be applied or ChangeHandlerMediator could not be retrieved: ["+f.layer+"]"+f.namespace+"/"+f.fileName+"."+f.fileType)}})};t.revertChange=function(e,n,t){var o=t.modifier;var d=t.view;var c=t.appComponent;var l=e.getContent();var g=o.getBindingTemplate(n,a);if(g){o.removeAggregation(g,i,o.bySelector(e.getRevertData(),c,d));o.updateAggregation(n,a)}o.removeAggregation(n,r,o.bySelector(l.newFieldSelector,c,d));e.resetRevertData();return true};t.completeChangeContent=function(e,n,t){var r=t.appComponent;var i=e.getDefinition();if(!i.content){i.content={}}if(n.parentId){e.addDependentControl(n.parentId,"targetTable",t)}else{throw new Error("oSpecificChangeInfo.parentId attribute required")}if(n.bindingPath){i.content.bindingPath=n.bindingPath}else{throw new Error("oSpecificChangeInfo.bindingPath attribute required")}if(n.oDataInformation.entityType){i.content.entityType=n.oDataInformation.entityType}else{throw new Error("oSpecificChangeInfo.entityType attribute required")}if(n.newControlId){i.content.newFieldSelector=t.modifier.getSelector(n.newControlId,r)}else{throw new Error("oSpecificChangeInfo.newControlId attribute required")}if(n.index===undefined){throw new Error("oSpecificChangeInfo.targetIndex attribute required")}else{i.content.newFieldIndex=n.index}if(n.oDataServiceVersion===undefined){throw new Error("oSpecificChangeInfo.oDataServiceVersion attribute required")}else{i.content.oDataServiceVersion=n.oDataServiceVersion}};return t},true);