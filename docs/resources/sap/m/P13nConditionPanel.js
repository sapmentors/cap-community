/*
 * ! OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./library","sap/ui/core/library","sap/ui/core/Control","sap/ui/core/IconPool","sap/ui/Device","sap/ui/core/InvisibleText","sap/ui/core/ResizeHandler","sap/ui/core/Item","sap/ui/core/ListItem","sap/ui/model/odata/type/Boolean","sap/ui/model/type/String","sap/ui/model/odata/type/String","sap/ui/model/type/Date","sap/ui/model/type/Time","sap/ui/model/odata/type/DateTime","sap/ui/model/type/Float","./Button","./OverflowToolbar","./OverflowToolbarLayoutData","./ToolbarSpacer","./Text","./SearchField","./CheckBox","./ComboBox","./Select","./Label","./Input","./DatePicker","./TimePicker","./DateTimePicker","sap/base/Log","sap/ui/thirdparty/jquery"],function(e,t,i,o,n,a,s,r,l,d,p,u,h,g,y,f,_,c,m,C,v,S,T,b,I,F,x,D,L,M,V,O){"use strict";var w=t.ValueState;var P=e.ButtonType;var k=e.ToolbarDesign;var E=t.TextAlign;var A=e.OverflowToolbarPriority;var G;var N;var K;var R;var B=i.extend("sap.m.P13nConditionPanel",{metadata:{library:"sap.m",properties:{maxConditions:{type:"string",group:"Misc",defaultValue:"-1"},exclude:{type:"boolean",group:"Misc",defaultValue:false},containerQuery:{type:"boolean",group:"Misc",defaultValue:false},autoAddNewRow:{type:"boolean",group:"Misc",defaultValue:false},disableFirstRemoveIcon:{type:"boolean",group:"Misc",defaultValue:false},alwaysShowAddIcon:{type:"boolean",group:"Misc",defaultValue:true},usePrevConditionSetting:{type:"boolean",group:"Misc",defaultValue:true},autoReduceKeyFieldItems:{type:"boolean",group:"Misc",defaultValue:false},layoutMode:{type:"string",group:"Misc",defaultValue:null},showLabel:{type:"boolean",group:"Misc",defaultValue:false},displayFormat:{type:"string",group:"Misc",defaultValue:null},validationExecutor:{type:"object",group:"Misc",defaultValue:null}},aggregations:{content:{type:"sap.ui.core.Control",multiple:true,singularName:"content",visibility:"hidden"}},events:{dataChange:{}}},renderer:function(e,t){e.write("<section");e.writeControlData(t);e.addClass("sapMConditionPanel");e.writeClasses();e.writeStyles();e.write(">");e.write("<div");e.addClass("sapMConditionPanelContent");e.addClass("sapMConditionPanelBG");e.writeClasses();e.write(">");var i=t.getAggregation("content");var o=i.length;for(var n=0;n<o;n++){e.renderControl(i[n])}e.write("</div>");e.write("</section>")}});B.prototype.setConditions=function(e){if(!e){V.error("sap.m.P13nConditionPanel : aCondition is not defined")}if(this._bIgnoreSetConditions){return}this._oConditionsMap={};this._aConditionKeys=[];this._iConditions=0;for(var t=0;t<e.length;t++){this._addCondition2Map(e[t])}this._clearConditions();this._fillConditions()};B.prototype.removeAllConditions=function(){this._oConditionsMap={};this._aConditionKeys=[];this._iConditions=0;this._clearConditions();this._fillConditions()};B.prototype.addCondition=function(e){if(this._bIgnoreSetConditions){return}e.index=this._iConditions;this._addCondition2Map(e);this._addCondition(e)};B.prototype.insertCondition=function(e,t){if(this._bIgnoreSetConditions){return}if(t!==undefined){e.index=t}this._addCondition2Map(e);this._addCondition(e)};B.prototype.removeCondition=function(e){this._clearConditions();if(typeof e=="string"){this._removeConditionFromMap(e)}if(typeof e=="object"){this._removeConditionFromMap(e.key)}this._fillConditions()};B.prototype._addCondition2Map=function(e){if(!e.key){e.key="condition_"+this._iConditions;if(this.getExclude()){e.key="x"+e.key}}this._iConditions++;this._oConditionsMap[e.key]=e;this._aConditionKeys.push(e.key)};B.prototype._removeConditionFromMap=function(e){this._iConditions--;delete this._oConditionsMap[e];var t=this._aConditionKeys.indexOf(e);if(t>=0){this._aConditionKeys.splice(t,1)}};B.prototype.getConditions=function(){var e;var t=[];if(this._oConditionsMap){for(var i in this._oConditionsMap){e=this._oConditionsMap[i];var o=e.value;if(!o){o=this._getFormatedConditionText(e.operation,e.value1,e.value2,e.exclude,e.keyField,e.showIfGrouped)}if(!e._oGrid||e._oGrid.select.getSelected()){t.push({key:i,text:o,exclude:e.exclude,operation:e.operation,keyField:e.keyField,value1:e.value1,value2:e.operation===H.BT?e.value2:null,showIfGrouped:e.showIfGrouped})}}}return t};B.prototype.setOperations=function(e,t){t=t||"default";this._oTypeOperations[t]=e;this._updateAllOperations()};B.prototype.setValues=function(e,t){t=t||"default";this._oTypeValues[t]=e};B.prototype.addOperation=function(e,t){t=t||"default";this._oTypeOperations[t].push(e);this._updateAllOperations()};B.prototype.removeAllOperations=function(e){e=e||"default";this._oTypeOperations[e]=[];this._updateAllOperations()};B.prototype.getOperations=function(e){e=e||"default";return this._oTypeOperations[e]};B.prototype.setKeyFields=function(e){this._aKeyFields=e;this._aKeyFields.forEach(function(e){B._createKeyFieldTypeInstance(e)},this);this._updateKeyFieldItems(this._oConditionsGrid,true);this._updateAllConditionsEnableStates();this._createAndUpdateAllKeyFields();this._updateAllOperations()};B.prototype.addKeyField=function(e){this._aKeyFields.push(e);B._createKeyFieldTypeInstance(e);this._updateKeyFieldItems(this._oConditionsGrid,true,true);this._updateAllConditionsEnableStates();this._createAndUpdateAllKeyFields();this._updateAllOperations()};B._createKeyFieldTypeInstance=function(e){var t;if(!e.typeInstance){switch(e.type){case"boolean":e.typeInstance=new d;break;case"numc":if(!(e.formatSettings&&e.formatSettings.isDigitSequence)){V.error("sap.m.P13nConditionPanel","NUMC type support requires isDigitSequence==true!");e.formatSettings=Object.assign({},e.formatSettings,{isDigitSequence:true})}t=e.formatSettings;if(e.maxLength){t=Object.assign({},t,{maxLength:e.maxLength})}if(!t.maxLength){V.error("sap.m.P13nConditionPanel","NUMC type suppport requires maxLength!")}e.typeInstance=new u({},t);break;case"date":e.typeInstance=new h(Object.assign({},e.formatSettings,{strictParsing:true}),{});break;case"time":e.typeInstance=new g(Object.assign({},e.formatSettings,{strictParsing:true}),{});break;case"datetime":e.typeInstance=new y(Object.assign({},e.formatSettings,{strictParsing:true}),{displayFormat:"Date"});var i=e.typeInstance;if(!i.oFormat){i.formatValue(new Date,"string")}if(i.oFormat){i.oFormat.oFormatOptions.UTC=false}break;case"stringdate":sap.ui.getCore().loadLibrary("sap.ui.comp");R=R||sap.ui.requireSync("sap/ui/comp/odata/type/StringDate");e.typeInstance=new R(Object.assign({},e.formatSettings,{strictParsing:true}));break;case"numeric":if(e.precision||e.scale){t={};if(e.precision){t["maxIntegerDigits"]=parseInt(e.precision)}if(e.scale){t["maxFractionDigits"]=parseInt(e.scale)}}e.typeInstance=new f(t);break;default:var o=e.formatSettings;if(e.maxLength){o=Object.assign({},o,{maxLength:e.maxLength})}e.typeInstance=new p({},o);break}}};B.prototype.removeAllKeyFields=function(){this._aKeyFields=[];this._updateKeyFieldItems(this._oConditionsGrid,true)};B.prototype.getKeyFields=function(){return this._aKeyFields};B.prototype.setAlwaysShowAddIcon=function(e){this.setProperty("alwaysShowAddIcon",e);if(this._oConditionsGrid){this._oConditionsGrid.toggleStyleClass("conditionRootGrid",this.getLayoutMode()!=="Desktop")}return this};B.prototype.setLayoutMode=function(e){this.setProperty("layoutMode",e);if(this._oConditionsGrid){this._oConditionsGrid.toggleStyleClass("conditionRootGrid",e!=="Desktop")}this._updateConditionFieldSpans(e);this._clearConditions();this._fillConditions();return this};B.prototype.setContainerQuery=function(e){this._unregisterResizeHandler();this.setProperty("containerQuery",e);this._registerResizeHandler();this._clearConditions();this._fillConditions();return this};B.prototype._updateConditionFieldSpans=function(e){if(this._aConditionsFields){var t=e==="Desktop";if(t){this._aConditionsFields[2].SpanFilter="L3 M3 S3";this._aConditionsFields[4].SpanFilter="L2 M2 S2";this._aConditionsFields[5].SpanFilter="L3 M3 S3";this._aConditionsFields[6].SpanFilter="L2 M2 S2";this._aConditionsFields[7].SpanFilter="L1 M1 S1"}var i=e==="Tablet";if(i){this._aConditionsFields[2].SpanFilter="L5 M5 S5";this._aConditionsFields[4].SpanFilter="L5 M5 S5";this._aConditionsFields[5].SpanFilter="L10 M10 S10";this._aConditionsFields[6].SpanFilter="L10 M10 S10";this._aConditionsFields[7].SpanFilter="L1 M1 S1"}}};B.prototype.init=function(){sap.ui.getCore().loadLibrary("sap.ui.layout");G=G||sap.ui.requireSync("sap/ui/layout/Grid");N=N||sap.ui.requireSync("sap/ui/layout/GridData");K=K||sap.ui.requireSync("sap/ui/layout/HorizontalLayout");this._oRb=sap.ui.getCore().getLibraryResourceBundle("sap.m");this._sFromLabelText=this._oRb.getText("CONDITIONPANEL_LABELFROM");this._sToLabelText=this._oRb.getText("CONDITIONPANEL_LABELTO");this._sValueLabelText=this._oRb.getText("CONDITIONPANEL_LABELVALUE");this._sShowIfGroupedLabelText=this._oRb.getText("CONDITIONPANEL_LABELGROUPING");this._sValidationDialogFieldMessage=this._oRb.getText("CONDITIONPANEL_FIELDMESSAGE");this._oTypeOperations={default:[]};this._oTypeValues={default:[]};this._aKeyFields=[];this._oConditionsMap={};this._aConditionKeys=[];this._iConditions=0;this._sLayoutMode="Desktop";this._sConditionType="Filter";this._sAddRemoveIconTooltip="FILTER";this._iBreakPointTablet=n.media._predefinedRangeSets[n.media.RANGESETS.SAP_STANDARD].points[0];this._iBreakPointDesktop=n.media._predefinedRangeSets[n.media.RANGESETS.SAP_STANDARD].points[1];this._oConditionsGrid=new G({width:"100%",defaultSpan:"L12 M12 S12",hSpacing:0,vSpacing:0}).toggleStyleClass("conditionRootGrid",this.getLayoutMode()!=="Desktop");this._oConditionsGrid.addStyleClass("sapUiRespGridOverflowHidden");this._iFirstConditionIndex=0;this._iConditionPageSize=10;this._oInvisibleTextField=new a({text:this._oRb.getText("CONDITIONPANEL_FIELD_LABEL")});this._oInvisibleTextOperator=new a({text:this._oRb.getText("CONDITIONPANEL_OPERATOR_LABEL")});this.addAggregation("content",this._oInvisibleTextField);this.addAggregation("content",this._oInvisibleTextOperator);this.addAggregation("content",this._oConditionsGrid);this._registerResizeHandler();this._aConditionsFields=[{ID:"select",Label:"",SpanFilter:"L1 M1 S1",SpanSort:"L1 M1 S1",SpanGroup:"L1 M1 S1",Control:"CheckBox",Value:""},{ID:"keyFieldLabel",Text:"Sort By",SpanFilter:"L1 M1 S1",SpanSort:"L1 M1 S1",SpanGroup:"L1 M1 S1",Control:"Label"},{ID:"keyField",Label:"",SpanFilter:"L3 M5 S10",SpanSort:"L5 M5 S12",SpanGroup:"L4 M4 S12",Control:"ComboBox"},{ID:"operationLabel",Text:"Sort Order",SpanFilter:"L1 M1 S1",SpanSort:"L1 M1 S1",SpanGroup:"L1 M1 S1",Control:"Label"},{ID:"operation",Label:"",SpanFilter:"L2 M5 S10",SpanSort:n.system.phone?"L5 M5 S8":"L5 M5 S9",SpanGroup:"L2 M5 S10",Control:"ComboBox"},{ID:"value1",Label:this._sFromLabelText,SpanFilter:"L3 M10 S10",SpanSort:"L3 M10 S10",SpanGroup:"L3 M10 S10",Control:"TextField",Value:""},{ID:"value2",Label:this._sToLabelText,SpanFilter:"L2 M10 S10",SpanSort:"L2 M10 S10",SpanGroup:"L2 M10 S10",Control:"TextField",Value:""},{ID:"showIfGrouped",Label:this._sShowIfGroupedLabelText,SpanFilter:"L1 M10 S10",SpanSort:"L1 M10 S10",SpanGroup:"L3 M4 S9",Control:"CheckBox",Value:"false"}];this._oButtonGroupSpan={SpanFilter:"L2 M2 S2",SpanSort:n.system.phone?"L2 M2 S4":"L2 M2 S3",SpanGroup:"L2 M2 S3"};this._updateConditionFieldSpans(this.getLayoutMode());this._fillConditions()};B.prototype._createPaginatorToolbar=function(){this._bPaginatorButtonsVisible=false;var e=this;this._oPrevButton=new _({icon:o.getIconURI("navigation-left-arrow"),tooltip:this._oRb.getText("WIZARD_FINISH"),visible:true,press:function(t){e._iFirstConditionIndex=Math.max(0,e._iFirstConditionIndex-e._iConditionPageSize);e._clearConditions();e._fillConditions()},layoutData:new m({priority:A.NeverOverflow})});this._oNextButton=new _({icon:o.getIconURI("navigation-right-arrow"),tooltip:this._oRb.getText("WIZARD_NEXT"),visible:true,press:function(t){e._iFirstConditionIndex+=e._iConditionPageSize;e._clearConditions();e._fillConditions()},layoutData:new m({priority:A.NeverOverflow})});this._oRemoveAllButton=new _({text:this._oRb.getText("CONDITIONPANEL_REMOVE_ALL"),visible:true,press:function(t){e._aConditionKeys.forEach(function(e,t){if(t>=0){this.fireDataChange({key:e,index:t,operation:"remove",newData:null})}},e);this._iFirstConditionIndex=0;e.removeAllConditions()},layoutData:new m({priority:A.Low})});this._oAddButton=new _({icon:o.getIconURI("add"),tooltip:this._oRb.getText("CONDITIONPANEL_ADD"+(this._sAddRemoveIconTooltipKey?"_"+this._sAddRemoveIconTooltipKey:"")+"_TOOLTIP"),visible:true,press:function(t){var i=e._createConditionRow(e._oConditionsGrid,undefined,null,0);e._changeField(i);setTimeout(function(){i.keyField.focus()});e._updatePaginatorToolbar()},layoutData:new m({priority:A.Low})});this._oHeaderText=new v({wrapping:false,layoutData:new m({priority:A.NeverOverflow})});this._oPageText=new v({wrapping:false,textAlign:E.Center,layoutData:new m({priority:A.NeverOverflow})});this._oFilterField=new S({width:"12rem",layoutData:new m({priority:A.High})});this._oPaginatorToolbar=new c({height:"3rem",design:k.Transparent,content:[this._oHeaderText,new C,this._oFilterField,this._oPrevButton,this._oPageText,this._oNextButton,this._oRemoveAllButton,this._oAddButton]})};B.prototype._updatePaginatorToolbar=function(){if(this._sConditionType!=="Filter"||this.getMaxConditions()!=="-1"){return}var e=this._aConditionKeys.length;var t=1+Math.floor(Math.max(0,e-1)/this._iConditionPageSize);var i=1+Math.floor(this._iFirstConditionIndex/this._iConditionPageSize);var o=this.getParent();if(!this._oPaginatorToolbar){if(e>this._iConditionPageSize){this._createPaginatorToolbar();this.insertAggregation("content",this._oPaginatorToolbar,0);this._onGridResize()}else{if(o&&o.setHeaderText){if(this._sOrgHeaderText==undefined){this._sOrgHeaderText=o.getHeaderText()}o.setHeaderText(this._sOrgHeaderText+(e>0?" ("+e+")":""))}return}}this._oPrevButton.setEnabled(this._iFirstConditionIndex>0);this._oNextButton.setEnabled(this._iFirstConditionIndex+this._iConditionPageSize<e);if(o&&o.setHeaderToolbar){if(!o.getHeaderToolbar()){this.removeAggregation("content",this._oPaginatorToolbar);o.setHeaderToolbar(this._oPaginatorToolbar);o.attachExpand(function(e){this._setToolbarElementVisibility(e.getSource().getExpanded()&&this._bPaginatorButtonsVisible)}.bind(this))}}if(o&&o.setHeaderText){if(this._sOrgHeaderText==undefined){this._sOrgHeaderText=o.getHeaderText()}var n=this._sOrgHeaderText+(e>0?" ("+e+")":"");o.setHeaderText(n);this._oHeaderText.setText(n)}else{this._oHeaderText.setText(e+" Conditions")}this._oPageText.setText(i+"/"+t);this._bPaginatorButtonsVisible=this._bPaginatorButtonsVisible||t>1;this._setToolbarElementVisibility(this._bPaginatorButtonsVisible);if(i>t){this._iFirstConditionIndex-=Math.max(0,this._iConditionPageSize);this._clearConditions();this._fillConditions()}var a=0;this._oConditionsGrid.getContent().forEach(function(e){if(e.select.getSelected()){a++}},this);if(t==i&&e-this._iFirstConditionIndex>a){this._clearConditions();this._fillConditions()}};B.prototype._setToolbarElementVisibility=function(e){this._oPrevButton.setVisible(e);this._oNextButton.setVisible(e);this._oPageText.setVisible(e);this._oFilterField.setVisible(false);this._oAddButton.setVisible(e);this._oRemoveAllButton.setVisible(e)};B.prototype.exit=function(){this._clearConditions();this._unregisterResizeHandler();this._aConditionsFields=null;this._aKeys=null;this._aKeyFields=null;this._oTypeOperations=null;this._oRb=null;this._sFromLabelText=null;this._sToLabelText=null;this._sValueLabelText=null;this._sValidationDialogFieldMessage=null;this._oConditionsMap=null;this._aConditionKeys=[]};B.prototype._clearConditions=function(){var e=this._oConditionsGrid.getContent();e.forEach(function(e){for(var t in this._aConditionsFields){var i=this._aConditionsFields[t];if(e[i["ID"]]&&e.getContent().indexOf(e[i["ID"]])===-1){e[i["ID"]].destroy()}}},this);this._oConditionsGrid.destroyContent()};B.prototype._fillConditions=function(){var e,t;var i=0,o=this._getMaxConditionsAsNumber(),n=this._aConditionKeys.length;if(this._oConditionsMap){var a=this._sConditionType!=="Filter"||this.getMaxConditions()!=="-1"?9999:this._iConditionPageSize;n=Math.min(n,Math.min(o,this._iFirstConditionIndex+a));for(i=this._iFirstConditionIndex;i<n;i++){t=this._aConditionKeys[i];e=this._oConditionsMap[t];this._createConditionRow(this._oConditionsGrid,e,t)}}this._updatePaginatorToolbar();if((this.getAutoAddNewRow()||this._oConditionsGrid.getContent().length===0)&&this._oConditionsGrid.getContent().length<o){this._createConditionRow(this._oConditionsGrid)}};B.prototype._addCondition=function(e){var t=0;var i=this._getMaxConditionsAsNumber();if(this._oConditionsMap){for(var o in this._oConditionsMap){if(t<i&&e===this._oConditionsMap[o]){this._createConditionRow(this._oConditionsGrid,e,o,t)}t++}}this._updatePaginatorToolbar()};B.prototype._getMaxConditionsAsNumber=function(){return this.getMaxConditions()==="-1"?9999:parseInt(this.getMaxConditions())};B.prototype.onAfterRendering=function(){if(this.getLayoutMode()){this._sLayoutMode=this.getLayoutMode();return}};B.prototype._handleMediaChange=function(e){this._sLayoutMode=e.name;this._updateLayout(e)};B.prototype._unregisterResizeHandler=function(){if(this._sContainerResizeListener){s.deregister(this._sContainerResizeListener);this._sContainerResizeListener=null}n.media.detachHandler(this._handleMediaChange,this,n.media.RANGESETS.SAP_STANDARD)};B.prototype._registerResizeHandler=function(){if(this.getContainerQuery()){this._sContainerResizeListener=s.register(this._oConditionsGrid,this._onGridResize.bind(this));this._onGridResize()}else{n.media.attachHandler(this._handleMediaChange,this,n.media.RANGESETS.SAP_STANDARD)}};B.prototype._getKeyFromConditionGrid=function(e){var t=e.data("_key");if(!t){t=this._createConditionKey()}return t};B.prototype._createConditionKey=function(){var e=0;var t;do{t="condition_"+e;if(this.getExclude()){t="x"+t}e++}while(this._oConditionsMap[t]);return t};B.prototype._createConditionRow=function(e,t,i,n,a){var s=null;var r;var l=this;if(n===undefined){n=e.getContent().length}var d=new G({width:"100%",defaultSpan:"L12 M12 S12",hSpacing:1,vSpacing:0,containerQuery:this.getContainerQuery()}).data("_key",i);d.addStyleClass("sapUiRespGridOverflowHidden");for(var p in this._aConditionsFields){var u;var h=this._aConditionsFields[p];switch(h["Control"]){case"CheckBox":u=new T({enabled:false,visible:false,layoutData:new N({span:h["Span"+this._sConditionType]})});if(h["ID"]==="showIfGrouped"){u.setEnabled(true);u.setText(h["Label"]);u.attachSelect(function(){l._changeField(d)});u.setSelected(t?t.showIfGrouped:true)}else{if(t){u.setSelected(true);u.setEnabled(true)}}break;case"ComboBox":if(h["ID"]==="keyField"){u=new b({width:"100%",ariaLabelledBy:this._oInvisibleTextField});var g=u.setSelectedKey.bind(u);u.setSelectedKey=function(e){g(e);var t=l.getValidationExecutor();if(t){t()}};var y=u.setSelectedItem.bind(u);u.setSelectedItem=function(e){y(e);var t=l.getValidationExecutor();if(t){t()}};u.setLayoutData(new N({span:h["Span"+this._sConditionType]}));this._fillKeyFieldListItems(u,this._aKeyFields);if(u.attachSelectionChange){u.attachSelectionChange(function(t){var i=l.getValidationExecutor();if(i){i()}l._handleSelectionChangeOnKeyField(e,d)})}if(u.attachChange){u.attachChange(function(t){d.keyField.close();l._handleChangeOnKeyField(e,d)})}if(u.setSelectedItem){if(t){u.setSelectedKey(t.keyField);this._aKeyFields.forEach(function(e,i){var o=e.key;if(o===undefined){o=e}if(t.keyField===o){u.setSelectedItem(u.getItems()[i])}},this)}else{if(this.getUsePrevConditionSetting()&&!this.getAutoReduceKeyFieldItems()){if(n>0&&!i&&a){r=e.getContent()[n-1];if(r.keyField.getSelectedKey()){u.setSelectedKey(r.keyField.getSelectedKey())}else{if(!u.getSelectedItem()&&u.getItems().length>0){u.setSelectedItem(u.getItems()[0])}}}else{this._aKeyFields.some(function(e,t){if(e.isDefault){u.setSelectedItem(u.getItems()[t]);return true}if(!u.getSelectedItem()&&e.type!=="boolean"){u.setSelectedItem(u.getItems()[t])}},this);if(!u.getSelectedItem()&&u.getItems().length>0){u.setSelectedItem(u.getItems()[0])}}}else{this._aKeyFields.forEach(function(e,t){if(e.isDefault){u.setSelectedItem(u.getItems()[t])}},this)}}}}if(h["ID"]==="operation"){u=new I({width:"100%",ariaLabelledBy:this._oInvisibleTextOperator,layoutData:new N({span:h["Span"+this._sConditionType]})});u.attachChange(function(){l._handleChangeOnOperationField(e,d)});d[h["ID"]]=u;this._updateOperationItems(e,d);if(t){var f=this._getCurrentKeyFieldItem(d.keyField);var c=this._oTypeOperations["default"];if(f){if(f.type&&this._oTypeOperations[f.type]){c=this._oTypeOperations[f.type]}if(f.operations){c=f.operations}}c.some(function(e,i){if(t.operation===e){u.setSelectedKey(e);return true}},this)}else{if(this.getUsePrevConditionSetting()){if(n>0&&i===null){var r=e.getContent()[n-1];u.setSelectedKey(r.operation.getSelectedKey())}}}}if(u.getSelectedItem&&u.getSelectedItem()){u.setTooltip(u.getSelectedItem().getTooltip()||u.getSelectedItem().getText())}break;case"TextField":var m=this._getCurrentKeyFieldItem(d.keyField);u=this._createValueField(m,h,d);u.oTargetGrid=e;if(t&&t[h["ID"]]!==undefined){var C=t[h["ID"]];if(u instanceof I){if(typeof C==="boolean"){u.setSelectedIndex(C?2:1)}}else if(C!==null&&d.oType){if(typeof C==="string"&&d.oType.getName()==="sap.ui.comp.odata.type.StringDate"){u.setValue(C)}else{if(typeof C==="string"&&["String","sap.ui.model.odata.type.String","sap.ui.model.odata.type.Decimal"].indexOf(d.oType.getName())==-1){try{C=d.oType.parseValue(C,"string");u.setValue(d.oType.formatValue(C,"string"))}catch(e){V.error("sap.m.P13nConditionPanel","Value '"+C+"' does not have the expected type format for "+d.oType.getName()+".parseValue()")}}else{u.setValue(d.oType.formatValue(C,"string"))}}}else{u.setValue(C)}}break;case"Label":u=new F({text:h["Text"]+":",visible:this.getShowLabel(),layoutData:new N({span:h["Span"+this._sConditionType]})}).addStyleClass("conditionLabel");u.oTargetGrid=e;break}d[h["ID"]]=u;d.addContent(u)}s=new K({layoutData:new N({span:this.getLayoutMode()==="Desktop"?"L2 M2 S2":this._oButtonGroupSpan["Span"+this._sConditionType]})}).addStyleClass("floatRight");d.addContent(s);d["ButtonContainer"]=s;var v=new _({type:P.Transparent,icon:o.getIconURI("sys-cancel"),tooltip:this._oRb.getText("CONDITIONPANEL_REMOVE"+(this._sAddRemoveIconTooltipKey?"_"+this._sAddRemoveIconTooltipKey:"")+"_TOOLTIP"),press:function(){l._handleRemoveCondition(this.oTargetGrid,d)},layoutData:new N({span:this.getLayoutMode()==="Desktop"?"L1 M1 S1":"L1 M2 S2"})});v.oTargetGrid=e;s.addContent(v);d["remove"]=v;var S=new _({type:P.Transparent,icon:o.getIconURI("add"),tooltip:this._oRb.getText("CONDITIONPANEL_ADD"+(this._sAddRemoveIconTooltipKey?"_"+this._sAddRemoveIconTooltipKey:"")+"_TOOLTIP"),press:function(){l._handleAddCondition(this.oTargetGrid,d,true)},layoutData:new N({span:this.getLayoutMode()==="Desktop"?"L1 M1 S1":"L1 M10 S10"})});S.oTargetGrid=e;S.addStyleClass("conditionAddBtnFloatRight");s.addContent(S);d["add"]=S;e.insertContent(d,n);this._updateOperationItems(e,d);this._changeOperationValueFields(e,d);this._updateAllConditionsEnableStates();this._updateConditionButtons(e);if(this.getAutoReduceKeyFieldItems()){this._updateKeyFieldItems(e,false)}if(this._sLayoutMode){this._updateLayout({name:this._sLayoutMode})}if(t){var x=this._getFormatedConditionText(t.operation,t.value1,t.value2,t.exclude,t.keyField,t.showIfGrouped);t._oGrid=d;t.value=x;this._oConditionsMap[i]=t}var D=d.operation.getSelectedKey();if(D==="BT"&&d.value1.setMinDate&&d.value2.setMaxDate){var L=d.value1.getDateValue();var M=d.value2.getDateValue();this._updateMinMaxDate(d,L,M)}else{this._updateMinMaxDate(d,null,null)}return d};B.prototype._handleRemoveCondition=function(e,t){var i=e.getContent().indexOf(t);this._removeCondition(e,t);if(this.getAutoReduceKeyFieldItems()){this._updateKeyFieldItems(e,false)}if(i>=0){i=Math.min(i,e.getContent().length-1);var t=e.getContent()[i];setTimeout(function(){t.remove.focus()})}this._updatePaginatorToolbar()};B.prototype._handleAddCondition=function(e,t,i){var o=e.getContent().indexOf(t);var n=this._createConditionRow(e,undefined,null,o+1,i);this._changeField(n);setTimeout(function(){n.keyField.focus()});this._updatePaginatorToolbar()};B.prototype._getCurrentKeyFieldItem=function(e){if(e.getSelectedKey&&e.getSelectedKey()){var t=e.getSelectedKey();var i=this._aKeyFields;for(var o in i){var n=i[o];if(n.key===t){return n}}}return null};B.prototype._createValueField=function(e,t,i){var o;var n;var a=this;var s={value:t["Value"],width:"100%",placeholder:t["Label"],change:function(e){a._validateAndFormatFieldValue(e);a._changeField(i,e)},layoutData:new N({span:t["Span"+this._sConditionType]})};if(e&&e.typeInstance){var l=e.typeInstance;n=this._findConfig(l,"ctrl");if(n==="DateTimePicker"&&l.getMetadata().getName()==="sap.ui.model.odata.type.DateTime"){if(!(l.oConstraints&&l.oConstraints.isDateOnly)){V.error("sap.m.P13nConditionPanel","sap.ui.model.odata.type.DateTime without displayFormat = Date is not supported!");l.oConstraints=Object.assign({},l.oConstraints,{isDateOnly:true})}n="DatePicker"}i.oType=l;if(n=="select"){var d=[];var p=e.values||this._oTypeValues[n]||["",l.formatValue(false,"string"),l.formatValue(true,"string")];p.forEach(function(e,t){d.push(new r({key:t.toString(),text:e.toString()}))});s={width:"100%",items:d,change:function(){a._changeField(i);a._makeFieldValid(o,true)},layoutData:new N({span:t["Span"+this._sConditionType]})};o=new I(s)}else if(n=="TimePicker"){if(l.oFormatOptions&&l.oFormatOptions.style){s.displayFormat=l.oFormatOptions.style}o=new L(s)}else if(n=="DateTimePicker"){if(l.oFormatOptions&&l.oFormatOptions.style){s.displayFormat=l.oFormatOptions.style}o=new M(s)}else if(n==="DatePicker"){if(l.oFormatOptions){s.displayFormat=l.oFormatOptions.style||l.oFormatOptions.pattern;if(l.isA("sap.ui.comp.odata.type.StringDate")){s.valueFormat="yyyyMMdd"}}o=new D(s)}else{o=new x(s);if(this._fSuggestCallback){e=this._getCurrentKeyFieldItem(i.keyField);if(e&&e.key){var u=this._fSuggestCallback(o,e.key);if(u){o._oSuggestProvider=u}}}}}else{i.oType=null;o=new x(s)}if(n!=="boolean"&&n!=="enum"&&o){o.onpaste=function(e){var t;if(window.clipboardData){t=window.clipboardData.getData("Text")}else{t=e.originalEvent.clipboardData.getData("text/plain")}var i=e.srcControl.getParent();var o=t.split(/\r\n|\r|\n/g);var n=i.operation;var s=n.getSelectedKey();if(o&&o.length>1&&s!=="BT"){setTimeout(function(){var e=o?o.length:0;var t=a._getCurrentKeyFieldItem(i.keyField);var n=i.operation;for(var s=0;s<e;s++){if(a._aConditionKeys.length>=a._getMaxConditionsAsNumber()){break}var r=o[s].trim();if(r){var l;if(t.typeInstance){try{l=t.typeInstance.parseValue(r,"string");t.typeInstance.validateValue(l)}catch(e){V.error("sap.m.P13nConditionPanel.onPaste","not able to parse value "+r+" with type "+t.typeInstance.getName());r="";l=null}if(!l){continue}}var d={key:a._createConditionKey(),exclude:a.getExclude(),operation:n.getSelectedKey(),keyField:t.key,value1:l,value2:null};a._addCondition2Map(d);a.fireDataChange({key:d.key,index:d.index,operation:"add",newData:d})}}a._clearConditions();a._fillConditions()},0)}}}if(e&&e.maxLength&&o.setMaxLength){var h=-1;if(typeof e.maxLength==="string"){h=parseInt(e.maxLength)}if(typeof e.maxLength==="number"){h=e.maxLength}if(h>0&&(!o.getShowSuggestion||!o.getShowSuggestion())){o.setMaxLength(h)}}return o};B.prototype._fillOperationListItems=function(e,t,i){if(i==="_STRING_"){i=""}if(i==="_TIME_"||i==="_DATETIME_"){i="_DATE_"}if(i==="_BOOLEAN_"||i==="_NUMC_"){i=""}e.destroyItems();t.forEach(function(t){var o=this._oRb.getText("CONDITIONPANEL_OPTION"+i+t);if(o.startsWith("CONDITIONPANEL_OPTION")){o=this._oRb.getText("CONDITIONPANEL_OPTION"+t)}e.addItem(new l({key:t,text:o,tooltip:o}))}.bind(this))};B.prototype._fillKeyFieldListItems=function(e,t){e.destroyItems();for(var i in t){var o=t[i];e.addItem(new l({key:o.key,text:o.text,tooltip:o.tooltip?o.tooltip:o.text}))}e.setEditable(e.getItems().length>1)};B.prototype._handleChangeOnOperationField=function(e,t){this._changeOperationValueFields(e,t);this._changeField(t)};B.prototype._handleSelectionChangeOnKeyField=function(e,t){if(this._sConditionType==="Filter"){this._updateOperationItems(e,t);this._createAndUpdateValueFields(e,t);this._changeOperationValueFields(e,t)}this._changeField(t)};B.prototype._handleChangeOnKeyField=function(e,t){if(this.getAutoReduceKeyFieldItems()){this._updateKeyFieldItems(e,false,false,t.keyField)}};B.prototype._createAndUpdateAllKeyFields=function(){var e=this._oConditionsGrid.getContent();e.forEach(function(e){this._createAndUpdateValueFields(this._oConditionsGrid,e);this._changeOperationValueFields(this._oConditionsGrid,e)},this)};B.prototype._createAndUpdateValueFields=function(e,t){var i=this._getCurrentKeyFieldItem(t.keyField);var o=function(e,t,o){var n=t.getValue?t.getValue():"";var a=e.indexOfContent(t);e.removeContent(t);if(t._oSuggestProvider){t._oSuggestProvider.destroy();t._oSuggestProvider=null}t.destroy();var s=this._aConditionsFields[o];t=this._createValueField(i,s,e);e[s["ID"]]=t;e.insertContent(t,a===-1?e.indexOfContent(e.operation)+1:a);var r,l;if(e.oType&&n){try{r=e.oType.parseValue(n,"string");e.oType.validateValue(r);l=e.oType.formatValue(r,"string");t.setValue(l)}catch(e){var d=e.message;this._makeFieldValid(t,false,d);t.setValue(n)}}};o.bind(this)(t,t.value1,5);o.bind(this)(t,t.value2,6)};B.prototype._updateAllOperations=function(){var e=this._oConditionsGrid.getContent();e.forEach(function(e){this._updateOperationItems(this._oConditionsGrid,e);this._changeOperationValueFields(this._oConditionsGrid,e)},this)};B.prototype._updateOperationItems=function(e,t){var i="";var o=this._getCurrentKeyFieldItem(t.keyField);var n=t.operation;var a=this._oTypeOperations["default"];var s=n.getSelectedItem();if(o){if(o.type&&o.type!==""&&this._oTypeOperations[o.type]){i=o.type;a=this._oTypeOperations[i]}if(o.operations){a=o.operations}}this._fillOperationListItems(n,a,i?"_"+i.toUpperCase()+"_":"");if(s&&n.getItemByKey(s.getKey())){n.setSelectedKey(s.getKey())}else{n.setSelectedItem(n.getItems()[0])}this._sConditionType="Filter";if(a[0]===H.Ascending||a[0]===H.Descending){this._sConditionType="Sort"}if(a[0]===H.GroupAscending||a[0]===H.GroupDescending){this._sConditionType="Group"}this._adjustValue1Span(t)};B.prototype._updateKeyFieldItems=function(e,t,i,o){var n=e.getContent().length;var a;var s={};if(!t){for(a=0;a<n;a++){var r=e.getContent()[a].keyField;var d=r.getSelectedKey();if(d!=null&&d!==""){s[d]=true}}}for(a=0;a<n;a++){var r=e.getContent()[a].keyField;var p=e.getContent()[a].select;var u=r.getSelectedKey();var h=0;var g=this._aKeyFields;if(r!==o){if(i){h=g.length-1}else{r.destroyItems()}for(h;h<g.length;h++){var y=g[h];if(y.key==null||y.key===""||!s[y.key]||y.key===u){r.addItem(new l({key:y.key,text:y.text,tooltip:y.tooltip?y.tooltip:y.text}))}}r.setEditable(r.getItems().length>1)}if(u){r.setSelectedKey(u)}else if(r.getItems().length>0){r.setSelectedItem(r.getItems()[0])}if(!p.getSelected()){this._aKeyFields.some(function(e,t){if(e.isDefault){r.setSelectedItem(r.getItems()[t]);return true}if(!r.getSelectedItem()){if(e.type!=="boolean"){r.setSelectedItem(r.getItems()[t])}}},this)}if(r.getSelectedItem()){r.setTooltip(r.getSelectedItem().getTooltip()||r.getSelectedItem().getText())}}};B.prototype._changeOperationValueFields=function(e,t){var i=t.operation;var o=i.getSelectedKey();var n=t.value1;var a=t.value2;var s=t.showIfGrouped;if(!o){return}if(o===H.BT){if(n.setPlaceholder&&n.getPlaceholder()!==this._sFromLabelText){n.setPlaceholder(this._sFromLabelText)}if(!n.getVisible()){n.setVisible(true);t.insertContent(n,t.getContent().length-1)}if(a.setPlaceholder&&a.getPlaceholder()!==this._sToLabelText){a.setPlaceholder(this._sToLabelText)}if(!a.getVisible()){a.setVisible(true);t.insertContent(a,t.getContent().length-1)}}else{if(o===H.GroupAscending||o===H.GroupDescending){if(n.getVisible()){n.setVisible(false);t.removeContent(n)}if(a.getVisible()){a.setVisible(false);t.removeContent(a)}if(i.getVisible()){i.setVisible(false);t.removeContent(i)}s.setVisible(this._getMaxConditionsAsNumber()!=1)}else{if(o===H.NotEmpty||o===H.Empty||o===H.Initial||o===H.Ascending||o===H.Descending||o===H.Total||o===H.Average||o===H.Minimum||o===H.Maximum){if(n.getVisible()){n.setVisible(false);t.removeContent(n)}if(a.getVisible()){a.setVisible(false);t.removeContent(a)}t.removeContent(s)}else{if(n.setPlaceholder&&n.getPlaceholder()!==this._sValueLabelText){n.setPlaceholder(this._sValueLabelText)}if(!n.getVisible()){n.setVisible(true);t.insertContent(n,t.getContent().length-1)}if(a.getVisible()){a.setVisible(false);t.removeContent(a)}}}}this._adjustValue1Span(t)};B.prototype._adjustValue1Span=function(e){if(this._sConditionType==="Filter"&&e.value1&&e.operation){var t=e.operation;var i=this._aConditionsFields[5]["Span"+this._sConditionType];if(t.getSelectedKey()!=="BT"){i="L5 M10 S10"}var o=e.value1.getLayoutData();if(o.getSpan()!==i){o.setSpan(i)}}};B.prototype._getIndexOfCondition=function(e){var t=-1;e.getParent().getContent().some(function(i){if(i.select.getSelected()){t++}return i===e},this);return t+this._iFirstConditionIndex};B.prototype._makeFieldValid=function(e,t,i){if(t){e.setValueState(w.None);e.setValueStateText("")}else{e.setValueState(w.Warning);e.setValueStateText(i?i:this._sValidationDialogFieldMessage)}};B.prototype._validateAndFormatFieldValue=function(e){var t=e.oSource;var i=t.getParent();var o;if(t.getDateValue&&e){o=e.getParameter("value");var n=e.getParameter("valid");this._makeFieldValid(t,n);return}else{o=t.getValue&&t.getValue()}if(!i){return}if(this.getDisplayFormat()==="UpperCase"&&o){o=o.toUpperCase();t.setValue(o)}if(i.oType&&o){try{var a=i.oType.parseValue(o,"string");i.oType.validateValue(a);this._makeFieldValid(t,true);o=i.oType.formatValue(a,"string");t.setValue(o)}catch(e){var s=e.message;this._makeFieldValid(t,false,s)}}else{this._makeFieldValid(t,true)}};B.prototype._updateMinMaxDate=function(e,t,i){if(e.value1.setMinDate&&e.value2.setMaxDate){if(e.value1&&e.value1.setMaxDate){e.value1.setMaxDate(i instanceof Date?i:null)}if(e.value2&&e.value2.setMinDate){e.value2.setMinDate(t instanceof Date?t:null)}}};B.prototype._changeField=function(e,t){var i=e.keyField.getSelectedKey();if(e.keyField.getSelectedItem()){e.keyField.setTooltip(e.keyField.getSelectedItem().getTooltip()||e.keyField.getSelectedItem().getText())}else{e.keyField.setTooltip(null)}var o=e.operation.getSelectedKey();if(e.operation.getSelectedItem()){e.operation.setTooltip(e.operation.getSelectedItem().getTooltip()||e.operation.getSelectedItem().getText())}else{e.operation.setTooltip(null)}var n=function(e,i){var o;var n;if(e.getDateValue&&!e.isA("sap.m.TimePicker")&&i.getName()!=="sap.ui.comp.odata.type.StringDate"){n=e.getDateValue();if(i&&n){if(t&&t.getParameter("valid")){o=i.formatValue(n,"string")}else{o=""}}}else{o=this._getValueTextFromField(e);n=o;if(i&&i.getName()==="sap.ui.comp.odata.type.StringDate"){o=i.formatValue(n,"string")}else if(i&&o){try{n=i.parseValue(o,"string");i.validateValue(n)}catch(e){V.error("sap.m.P13nConditionPanel","not able to parse value "+o+" with type "+i.getName());o=""}}}return[n,o]}.bind(this);var a=n(e.value1,e.oType);var s=a[0],r=a[1];a=n(e.value2,e.oType);var l=a[0],d=a[1];if(o==="BT"){this._updateMinMaxDate(e,s,l)}else{this._updateMinMaxDate(e,null,null)}var p=this._getCurrentKeyFieldItem(e.keyField);if(p&&p.type==="numc"){if([H.Contains,H.EndsWith].indexOf(o)!=-1){s=e.oType.formatValue(s,"string")}}var u=e.showIfGrouped.getSelected();var h=this.getExclude();var g=e.select;var y="";var f;if(i===""||i==null){i=null;f=this._getKeyFromConditionGrid(e);this._removeConditionFromMap(f);this._enableCondition(e,false);var _=this._getIndexOfCondition(e);if(g.getSelected()){g.setSelected(false);g.setEnabled(false);this._bIgnoreSetConditions=true;this.fireDataChange({key:f,index:_,operation:"remove",newData:null});this._bIgnoreSetConditions=false}return}this._enableCondition(e,true);y=this._getFormatedConditionText(o,r,d,h,i,u);var c={value:y,exclude:h,operation:o,keyField:i,value1:s,value2:o===H.BT?l:null,showIfGrouped:u};f=this._getKeyFromConditionGrid(e);if(y!==""){g.setSelected(true);g.setEnabled(true);var o="update";if(!this._oConditionsMap[f]){o="add"}this._oConditionsMap[f]=c;if(o==="add"){this._aConditionKeys.splice(this._getIndexOfCondition(e),0,f)}e.data("_key",f);this.fireDataChange({key:f,index:this._getIndexOfCondition(e),operation:o,newData:c})}else if(this._oConditionsMap[f]!==undefined){this._removeConditionFromMap(f);e.data("_key",null);var _=this._getIndexOfCondition(e);if(g.getSelected()){g.setSelected(false);g.setEnabled(false);this._bIgnoreSetConditions=true;this.fireDataChange({key:f,index:_,operation:"remove",newData:null});this._bIgnoreSetConditions=false}}this._updatePaginatorToolbar()};B.prototype._getValueTextFromField=function(e){if(e instanceof I){return e.getSelectedItem()?e.getSelectedItem().getText():""}return e.getValue()};B.prototype._updateAllConditionsEnableStates=function(){var e=this._oConditionsGrid.getContent();e.forEach(function(e){var t=this._getCurrentKeyFieldItem(e.keyField);var i=t&&t.key!==undefined?t.key:t;var o=i!==""&&i!==null;this._enableCondition(e,o)},this)};B.prototype._enableCondition=function(e,t){e.operation.setEnabled(t);e.value1.setEnabled(t);e.value2.setEnabled(t);e.showIfGrouped.setEnabled(t)};B.prototype._removeCondition=function(e,t){var i=this._getKeyFromConditionGrid(t);var o=-1;if(t.select.getSelected()){o=this._getIndexOfCondition(t)}this._removeConditionFromMap(i);t.destroy();if(e.getContent().length<1){this._createConditionRow(e)}else{this._updateConditionButtons(e)}if(o>=0){this.fireDataChange({key:i,index:o,operation:"remove",newData:null})}};B.prototype._updateConditionButtons=function(e){var t=this._getMaxConditionsAsNumber();var i=e.getContent().length;for(var o=0;o<i;o++){var n=e.getContent()[o].add;if(this.getAlwaysShowAddIcon()&&i<t||o===i-1&&o<t-1){n.removeStyleClass("displayNone")}else{n.addStyleClass("displayNone")}var a=e.getContent()[o].remove;if(t===1||o===0&&i===1&&this.getDisableFirstRemoveIcon()){a.addStyleClass("displayNone")}else{a.removeStyleClass("displayNone")}}};B.prototype.validateConditions=function(){var e=this;var t=function(t){var i=true;for(var o=0;o<t.length;o++){var n=t[o];var a=e._checkCondition(n,o===t.length-1);i=i&&a}return i};return t(this._oConditionsGrid.getContent())};B.prototype.removeValidationErrors=function(){this._oConditionsGrid.getContent().forEach(function(e){var t=e.value1;var i=e.value2;t.setValueState(w.None);t.setValueStateText("");i.setValueState(w.None);i.setValueStateText("")},this)};B.prototype.removeInvalidConditions=function(){var e=[];this._oConditionsGrid.getContent().forEach(function(t){if(t.value1.getValueState()!==w.None||t.value2.getValueState()!==w.None){e.push(t)}},this);e.forEach(function(e){this._removeCondition(this._oConditionsGrid,e);if(this.getAutoReduceKeyFieldItems()){this._updateKeyFieldItems(this._oConditionsGrid,false)}},this)};B.prototype._checkCondition=function(e,t){var i=true;var o=e.value1;var n=e.value2;var a=o&&(o.getVisible()&&!this._getValueTextFromField(o));var s=o&&o.getVisible()&&o.getValueState?o.getValueState():w.None;var r=n&&(n.getVisible()&&!this._getValueTextFromField(n));var l=n&&n.getVisible()&&n.getValueState?n.getValueState():w.None;var d=e.operation.getSelectedKey();if(d===H.BT){if(!a?r:!r){if(a){o.setValueState(w.Warning);o.setValueStateText(this._sValidationDialogFieldMessage)}if(r){n.setValueState(w.Warning);n.setValueStateText(this._sValidationDialogFieldMessage)}i=false}else if(s!==w.None||l!==w.None){i=false}else{o.setValueState(w.None);o.setValueStateText("");n.setValueState(w.None);n.setValueStateText("")}}if(o.getVisible()&&o.getValueState&&o.getValueState()!==w.None||n.getVisible()&&n.getValueState&&n.getValueState()!==w.None){i=false}return i};B.prototype._getFormatedConditionText=function(e,t,i,o,n,a){var s=B.getFormatedConditionText(e,t,i,o);if(!s){switch(e){case H.Initial:s="=''";break;case H.NotEmpty:s="!''";break;case H.Ascending:s="ascending";break;case H.GroupAscending:s="ascending";s+=" showIfGrouped:"+a;break;case H.Descending:s="descending";break;case H.GroupDescending:s="descending";s+=" showIfGrouped:"+a;break;case H.Total:s="total";break;case H.Average:s="average";break;case H.Minimum:s="minimum";break;case H.Maximum:s="maximum";break}if(o&&s!==""){s="!("+s+")"}}if(this._aKeyFields&&this._aKeyFields.length>1){var r=null;for(var l=0;l<this._aKeyFields.length;l++){var d=this._aKeyFields[l];if(typeof d!=="string"){if(d.key===n&&d.text){r=d.text}}}if(r&&s!==""){s=r+": "+s}}return s};var H=sap.m.P13nConditionOperation={BT:"BT",EQ:"EQ",Contains:"Contains",StartsWith:"StartsWith",EndsWith:"EndsWith",LT:"LT",LE:"LE",GT:"GT",GE:"GE",Initial:"Initial",Empty:"Empty",NotEmpty:"NotEmpty",Ascending:"Ascending",Descending:"Descending",GroupAscending:"GroupAscending",GroupDescending:"GroupDescending",Total:"Total",Average:"Average",Minimum:"Minimum",Maximum:"Maximum"};B._oConditionMap={EQ:"=$0",GT:">$0",GE:">=$0",LT:"<$0",LE:"<=$0",Contains:"*$0*",StartsWith:"$0*",EndsWith:"*$0",BT:"$0...$1",Empty:"<$r>"};(function(){var e=sap.ui.getCore().getLibraryResourceBundle("sap.m");B._oConditionMap[H.Empty]=B._oConditionMap[H.Empty].replace("$r",e.getText("CONDITIONPANEL_OPTIONEmpty"))})();B._templateReplace=function(e,t){return e.replace(/\$\d/g,function(e){return t[parseInt(e.substr(1))]})};B.getFormatedConditionText=function(e,t,i,o){var n="";switch(e){case H.Empty:n=B._templateReplace(B._oConditionMap[e],[]);break;case H.EQ:case H.GT:case H.GE:case H.LT:case H.LE:case H.Contains:case H.StartsWith:case H.EndsWith:if(t!==""&&t!==undefined){n=B._templateReplace(B._oConditionMap[e],[t])}break;case H.BT:if(t!==""&&t!==undefined){if(i!==""&&i!==undefined){n=B._templateReplace(B._oConditionMap[e],[t,i])}}break;default:break}if(o&&n!==""){n="!("+n+")"}return n};B.prototype._updateLayout=function(e){if(!this._oConditionsGrid){return}var t=this._oConditionsGrid.getContent();var i=this._aConditionsFields.length;var o=i;if(e.name==="Tablet"){o=5}if(e.name==="Phone"){o=3}if(this._sConditionType==="Filter"){for(var n=0;n<t.length;n++){var a=t[n];a.ButtonContainer.removeStyleClass("floatRight");a.removeContent(a.ButtonContainer);a.insertContent(a.ButtonContainer,o);if(!this.getAlwaysShowAddIcon()){if(o!==i){a.ButtonContainer.removeContent(a.add);a.addContent(a.add)}else{a.removeContent(a.add);a.ButtonContainer.addContent(a.add)}}}}};B.prototype._onGridResize=function(){var e;if(this._oPaginatorToolbar&&this._oConditionsGrid&&this._oConditionsGrid.getContent().length>0){var t=this._oConditionsGrid.getContent()[0];if(t.remove&&t.remove.$().position()){e=0;if(this._oPaginatorToolbar.getParent()&&this._oPaginatorToolbar.getParent().getExpandable&&this._oPaginatorToolbar.getParent().getExpandable()){e=48-4}var i=t.remove.$().position().left-e+t.remove.$().width();this._oPaginatorToolbar.setWidth(i+"px")}}var o=this._oConditionsGrid.getDomRef();if(!o){return}if(!O(o).is(":visible")){return}e=o.clientWidth;var n={};if(e<=this._iBreakPointTablet){n.name="Phone"}else if(e>this._iBreakPointTablet&&e<=this._iBreakPointDesktop){n.name="Tablet"}else{n.name="Desktop"}if(n.name==="Phone"&&this._sLayoutMode!==n.name){this._updateLayout(n);this._sLayoutMode=n.name}if(n.name==="Tablet"&&this._sLayoutMode!==n.name){this._updateLayout(n);this._sLayoutMode=n.name}if(n.name==="Desktop"&&this._sLayoutMode!==n.name){this._updateLayout(n);this._sLayoutMode=n.name}};B.prototype._findConfig=function(e,t){if(typeof e==="object"){e=e.getMetadata().getName()}var i;while(e&&!(i=this._getConfig(e,t))){e=this._getParentType(e)}return i};B.prototype._getConfig=function(e,t){var i=this._mOpsForType[e];if(i){return i[t]}};B.prototype._getParentType=function(e){return this._mTypes[e]};B.prototype._mTypes={base:undefined,string:"base",numeric:"base",date:"base",time:"base",boolean:"base",int:"numeric",float:"numeric","sap.ui.model.type.Boolean":"boolean","sap.ui.model.type.Date":"date","sap.ui.model.type.FileSize":"string","sap.ui.model.type.Float":"float","sap.ui.model.type.Integer":"int","sap.ui.model.type.String":"string","sap.ui.model.type.Time":"time","sap.ui.comp.odata.type.StringDate":"date","sap.ui.model.odata.type.Boolean":"boolean","sap.ui.model.odata.type.Byte":"int","sap.ui.model.odata.type.Date":"date","sap.ui.model.odata.type.DateTime":"datetime","sap.ui.model.odata.type.DateTimeOffset":"datetime","sap.ui.model.odata.type.Decimal":"float","sap.ui.model.odata.type.Double":"float","sap.ui.model.odata.type.Single":"float","sap.ui.model.odata.type.Guid":"string","sap.ui.model.odata.type.Int16":"int","sap.ui.model.odata.type.Int32":"int","sap.ui.model.odata.type.Int64":"int","sap.ui.model.odata.type.Raw":"string","sap.ui.model.odata.type.SByte":"int","sap.ui.model.odata.type.String":"string","sap.ui.model.odata.type.Time":"time","sap.ui.model.odata.type.TimeOfDay":"time","Edm.Boolean":"sap.ui.model.odata.type.Boolean","Edm.Byte":"sap.ui.model.odata.type.Byte","Edm.Date":"sap.ui.model.odata.type.Date","Edm.DateTime":"sap.ui.model.odata.type.DateTime","Edm.DateTimeOffset":"sap.ui.model.odata.type.DateTimeOffset","Edm.Decimal":"sap.ui.model.odata.type.Decimal","Edm.Double":"sap.ui.model.odata.type.Double","Edm.Single":"sap.ui.model.odata.type.Single","Edm.Guid":"sap.ui.model.odata.type.Guid","Edm.Int16":"sap.ui.model.odata.type.Int16","Edm.Int32":"sap.ui.model.odata.type.Int32","Edm.Int64":"sap.ui.model.odata.type.Int64","Edm.SByte":"sap.ui.model.odata.type.SByte","Edm.String":"sap.ui.model.odata.type.String","Edm.Time":"sap.ui.model.odata.type.Time","Edm.TimeOfDay":"sap.ui.model.odata.type.TimeOfDay"};B.prototype._mOpsForType={base:{ctrl:"input"},string:{ctrl:"input"},date:{ctrl:"DatePicker"},datetime:{ctrl:"DateTimePicker"},numeric:{ctrl:"input"},time:{ctrl:"TimePicker"},boolean:{ctrl:"select"}};return B});